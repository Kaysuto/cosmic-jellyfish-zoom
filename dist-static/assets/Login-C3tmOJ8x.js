var ne=Object.defineProperty,le=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var H=(r,t,s)=>t in r?ne(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,p=(r,t)=>{for(var s in t||(t={}))ce.call(t,s)&&H(r,s,t[s]);if(U)for(var s of U(t))de.call(t,s)&&H(r,s,t[s]);return r},z=(r,t)=>le(r,oe(t));var T=(r,t,s)=>new Promise((l,c)=>{var a=o=>{try{_(s.next(o))}catch(x){c(x)}},i=o=>{try{_(s.throw(o))}catch(x){c(x)}},_=o=>o.done?l(o.value):Promise.resolve(o.value).then(a,i);_((s=s.apply(r,t)).next())});import{j as e}from"./ui-DslYdUPK.js";import{r as n,c as K,u as me,d as ue,L as ge}from"./router-42GXI50n.js";import{c as xe,d as g,s as w,u as L,B as b,a as fe,m as pe,C as he,n as je,o as we,I as _e,p as be,J as ye,K as P}from"./index-Cw6WSGfP.js";import{A as ve,a as Ne,b as ke}from"./alert-C5VW6aHR.js";import{o as C,s as m,u as O,t as W,F as D,a as y,b as v,c as N,d as k,e as S}from"./form-Ba3HuSxU.js";import{I as A}from"./input-B7M3MPRI.js";import{A as Se}from"./arrow-left-Db81hexG.js";import{L as Ae}from"./loader-circle-BQi2R5hk.js";import"./vendor-aQ18W7Az.js";import"./streaming-fF1zHaJi.js";import"./utils-D-N2hrcs.js";import"./label-BjJg9FZ3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=xe("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),Ce=()=>{const[r,t]=n.useState(!1),s=n.useCallback(c=>T(null,null,function*(){if(!c)return g("Token de vérification manquant"),!1;t(!0);try{const{data:a,error:i}=yield w.functions.invoke("verify-turnstile",{body:{token:c}});return i?(console.error("Erreur de vérification Turnstile:",i),g("Échec de la vérification du captcha"),!1):a!=null&&a.success?!0:(g("Vérification du captcha échouée"),!1)}catch(a){return console.error("Erreur lors de la vérification Turnstile:",a),g("Erreur lors de la vérification du captcha"),!1}finally{t(!1)}}),[]),l=n.useCallback(()=>{t(!1)},[]);return{isVerifying:r,verifyToken:s,resetVerification:l}},G=new RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);C({email:m().regex(G,{message:"Adresse e-mail invalide"}),password:m().min(1,{message:"Le mot de passe est requis."})});const Ee=({onSubmit:r,isLoading:t})=>{const{t:s,i18n:l}=L(),c=n.useMemo(()=>C({email:m().regex(G,{message:s("invalid_email")}),password:m().min(1,{message:s("password_required")})}),[s]),a=O({resolver:W(c),defaultValues:{email:"",password:""}});return n.useEffect(()=>{Object.keys(a.formState.errors).length>0&&a.trigger()},[l.language,a]),e.jsx(D,z(p({},a),{children:e.jsxs("form",{onSubmit:a.handleSubmit(r),className:"space-y-4",children:[e.jsx(y,{control:a.control,name:"email",render:({field:i})=>e.jsxs(v,{children:[e.jsx(N,{children:s("email_address")}),e.jsx(k,{children:e.jsx(A,p({type:"email",placeholder:s("email_placeholder")},i))}),e.jsx(S,{})]})}),e.jsx(y,{control:a.control,name:"password",render:({field:i})=>e.jsxs(v,{children:[e.jsx(N,{children:s("password")}),e.jsx(k,{children:e.jsx(A,p({type:"password",placeholder:s("password_placeholder")},i))}),e.jsx(S,{})]})}),e.jsx(b,{type:"submit",variant:"blueEnhanced",className:"w-full",disabled:t,children:s(t?"saving":"sign_in")})]})}))},J=new RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);C({email:m().regex(J,{message:"Adresse e-mail invalide"}),password:m().min(6,{message:"Le mot de passe doit contenir au moins 6 caractères."}).regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,{message:"Doit contenir une majuscule, une minuscule et un chiffre."}),first_name:m().min(1,{message:"Le prénom est requis."}),last_name:m().min(1,{message:"Le nom de famille est requis."})});const Fe=({onSubmit:r,isLoading:t})=>{const{t:s,i18n:l}=L(),c=n.useMemo(()=>C({email:m().regex(J,{message:s("invalid_email")}),password:m().min(6,{message:s("password_too_short")}).regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,{message:s("password_requirements")}),first_name:m().min(1,{message:s("first_name_required")}),last_name:m().min(1,{message:s("last_name_required")})}),[s]),a=O({resolver:W(c),defaultValues:{email:"",password:"",first_name:"",last_name:""}});return n.useEffect(()=>{Object.keys(a.formState.errors).length>0&&a.trigger()},[l.language,a]),e.jsx(D,z(p({},a),{children:e.jsxs("form",{onSubmit:a.handleSubmit(r),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(y,{control:a.control,name:"first_name",render:({field:i})=>e.jsxs(v,{children:[e.jsx(N,{children:s("first_name")}),e.jsx(k,{children:e.jsx(A,p({},i))}),e.jsx(S,{})]})}),e.jsx(y,{control:a.control,name:"last_name",render:({field:i})=>e.jsxs(v,{children:[e.jsx(N,{children:s("last_name")}),e.jsx(k,{children:e.jsx(A,p({},i))}),e.jsx(S,{})]})})]}),e.jsx(y,{control:a.control,name:"email",render:({field:i})=>e.jsxs(v,{children:[e.jsx(N,{children:s("email_address")}),e.jsx(k,{children:e.jsx(A,p({type:"email"},i))}),e.jsx(S,{})]})}),e.jsx(y,{control:a.control,name:"password",render:({field:i})=>e.jsxs(v,{children:[e.jsx(N,{children:s("password")}),e.jsx(k,{children:e.jsx(A,p({type:"password"},i))}),e.jsx(S,{})]})}),e.jsx(b,{type:"submit",className:"w-full",disabled:t,children:s(t?"saving":"sign_up")})]})}))},Q=new RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);C({email:m().regex(Q,{message:"Adresse e-mail invalide"})});const Re=({onSubmit:r,isLoading:t})=>{const{t:s,i18n:l}=L(),c=n.useMemo(()=>C({email:m().regex(Q,{message:s("invalid_email")})}),[s]),a=O({resolver:W(c),defaultValues:{email:""}});return n.useEffect(()=>{Object.keys(a.formState.errors).length>0&&a.trigger()},[l.language,a]),e.jsx(D,z(p({},a),{children:e.jsxs("form",{onSubmit:a.handleSubmit(r),className:"space-y-4",children:[e.jsx(y,{control:a.control,name:"email",render:({field:i})=>e.jsxs(v,{children:[e.jsx(N,{children:s("email_address")}),e.jsx(k,{children:e.jsx(A,p({type:"email",placeholder:s("email_placeholder")},i))}),e.jsx(S,{})]})}),e.jsx(b,{type:"submit",className:"w-full",disabled:t,children:s(t?"saving":"send_recovery_link")})]})}))},Ve=({siteKey:r,onVerify:t,onExpire:s,onError:l,theme:c="dark",size:a="normal",className:i=""})=>{const{t:_}=L(),o=n.useRef(null),[x,E]=n.useState(null),[F,R]=n.useState(!1);n.useEffect(()=>{if(window.turnstile)R(!0);else{const h=document.createElement("script");h.src="https://challenges.cloudflare.com/turnstile/v0/api.js",h.async=!0,h.defer=!0,h.onload=()=>R(!0),document.head.appendChild(h)}},[]),n.useEffect(()=>{if(F&&o.current&&r){if(o.current.querySelector("[data-turnstile-widget-id]"))return;const $=window.turnstile.render(o.current,{sitekey:r,theme:c,size:a,callback:Z=>{t(Z)},"expired-callback":()=>{s==null||s()},"error-callback":()=>{l==null||l()}});E($)}},[F,r]);const V=()=>{x&&window.turnstile.reset(x)},I=()=>x?window.turnstile.getResponse(x):"";return K.useImperativeHandle(K.forwardRef(()=>null),()=>({reset:V,getResponse:I})),e.jsxs("div",{className:`turnstile-container ${i}`,children:[e.jsx("div",{ref:o,className:"turnstile-widget"}),!F&&e.jsxs("div",{className:"flex items-center justify-center p-4 text-gray-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-400 mr-2"}),_("loading_captcha")]})]})},He=()=>{var M,B;const{t:r}=L(),t=me(),l=((B=(M=ue().state)==null?void 0:M.from)==null?void 0:B.pathname)||"/",{session:c}=fe(),[a,i]=n.useState(!1),[_,o]=n.useState("signin"),[x,E]=n.useState(!1),[F,R]=n.useState(!0),{verifyToken:V}=Ce(),[I,h]=n.useState(""),$="0x4AAAAAABvFFVNpOKr1qGpd";n.useEffect(()=>{T(null,null,function*(){R(!0);const{data:u,error:f}=yield w.from("app_settings").select("value").eq("key","allow_registrations").single();f?(console.error("Error fetching registration status:",f),E(!1)):E(u.value==="true"),R(!1)});const j=w.channel("app-settings-change").on("postgres_changes",{event:"UPDATE",schema:"public",table:"app_settings",filter:"key=eq.allow_registrations"},u=>{const f=u.new;E(f.value==="true")}).subscribe();return()=>{w.removeChannel(j)}},[]),n.useEffect(()=>{c&&t(l,{replace:!0})},[c,t,l]);const Z=d=>T(null,null,function*(){var j;i(!0);try{if(!(yield V(I))){i(!1);return}const{data:f,error:q}=yield w.auth.signInWithPassword({email:d.email,password:d.password});q?(q.message==="Invalid login credentials"?g(r("invalid_login_credentials")):q.message==="Email not confirmed"?(yield w.auth.resend({type:"signup",email:d.email}),g(r("email_not_confirmed"))):g(r("unexpected_login_error")),yield w.from("audit_logs").insert({user_id:((j=f==null?void 0:f.user)==null?void 0:j.id)||null,action:"user_login_failed",details:{email:d.email,error:q.message}})):f.user&&(P(r("login_successful")),yield w.from("audit_logs").insert({user_id:f.user.id,action:"user_login_success",details:{email:f.user.email}}),t(l,{replace:!0}))}catch(u){console.error("Erreur lors de la connexion:",u),g(r("unexpected_login_error"))}finally{i(!1)}}),X=d=>T(null,null,function*(){i(!0);try{if(!(yield V(I))){i(!1);return}const{error:u}=yield w.auth.signUp({email:d.email,password:d.password,options:{data:{first_name:d.first_name,last_name:d.last_name}}});u?g(u.message):P(r("account_created_check_email"))}catch(j){console.error("Erreur lors de l'inscription:",j),g(r("unexpected_signup_error"))}finally{i(!1)}}),Y=d=>T(null,null,function*(){i(!0);try{if(!(yield V(I))){i(!1);return}const{error:u}=yield w.auth.resetPasswordForEmail(d.email,{redirectTo:`${window.location.origin}/update-password`});u?g(u.message):P(r("password_reset_email_sent"))}catch(j){console.error("Erreur lors de la réinitialisation du mot de passe:",j),g(r("unexpected_reset_error"))}finally{i(!1)}}),ee=d=>{h(d)},se=()=>{h("")},re=()=>{h("")},ae=()=>{if(F)return e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx(Ae,{className:"h-8 w-8 animate-spin text-gray-400"})});switch(_){case"signup":return e.jsxs("div",{children:[e.jsx(Fe,{onSubmit:X,isLoading:a}),e.jsxs("div",{className:"text-center text-sm text-gray-400 mt-4",children:[r("already_have_account")," ",e.jsx(b,{variant:"link",className:"p-0 h-auto text-blue-400",onClick:()=>o("signin"),children:r("sign_in")})]})]},"signup");case"forgot_password":return e.jsxs("div",{children:[e.jsx(Re,{onSubmit:Y,isLoading:a}),e.jsx("div",{className:"text-center text-sm text-gray-400 mt-4",children:e.jsx(b,{variant:"link",className:"p-0 h-auto text-blue-400",onClick:()=>o("signin"),children:r("back_to_login")})})]},"forgot_password");case"signin":default:return e.jsxs("div",{children:[e.jsx(Ee,{onSubmit:Z,isLoading:a}),e.jsxs("div",{className:"mt-4 space-y-2 text-center text-sm",children:[e.jsx("div",{children:e.jsx(b,{variant:"link",type:"button",className:"p-0 h-auto text-blue-400",onClick:()=>o("forgot_password"),children:r("forgot_password")})}),x&&e.jsxs("div",{className:"text-gray-400",children:[r("dont_have_account")," ",e.jsx(b,{variant:"link",className:"p-0 h-auto text-blue-400",onClick:()=>o("signup"),children:r("sign_up")})]})]}),!x&&e.jsxs(ve,{className:"mt-6 bg-blue-900/30 border-blue-500/30 text-blue-300",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx(Ne,{children:"Information"}),e.jsx(ke,{children:r("registrations_are_closed")})]})]},"signin")}},te={signin:r("admin_login"),signup:r("sign_up"),forgot_password:r("reset_password_title")},ie={signin:r("access_your_dashboard"),signup:r("create_a_new_account"),forgot_password:r("reset_password_desc")};return e.jsxs("div",{className:"relative min-h-screen flex flex-col bg-gray-900 text-white",children:[e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-black"}),e.jsx("div",{className:"absolute inset-0 bg-[url('/grid.svg')] bg-center opacity-20 [mask-image:linear-gradient(180deg,white,rgba(255,255,255,0))]"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gradient-to-b from-transparent via-gray-900/50 to-gray-900"})]}),e.jsx("div",{className:"absolute top-6 left-6 z-20",children:e.jsx(b,{asChild:!0,variant:"ghost",className:"group relative overflow-hidden rounded-2xl bg-gray-800/30 backdrop-blur-md border border-gray-600/40 text-white hover:bg-gray-700/40 hover:border-gray-500/60 hover:text-white transition-all duration-300 text-base shadow-2xl hover:shadow-gray-900/50",children:e.jsxs(ge,{to:"/",className:"flex items-center px-4 py-2",children:[e.jsx(Se,{className:"mr-3 h-5 w-5 transition-transform duration-300 group-hover:-translate-x-1"}),e.jsx("span",{className:"font-semibold",children:r("return_home")}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"})]})})}),e.jsx("main",{className:"relative z-10 flex-grow flex flex-col items-center justify-center p-6 sm:p-8 lg:p-12",children:e.jsx(pe.div,{initial:{opacity:0,y:-30},animate:{opacity:1,y:0},transition:{duration:1,ease:"easeOut"},className:"w-full max-w-lg lg:max-w-xl xl:max-w-2xl",children:e.jsxs(he,{className:"bg-gray-800/40 backdrop-blur-xl border border-gray-600/30 text-white shadow-2xl",children:[e.jsxs(je,{className:"text-center pb-8",children:[e.jsx(we,{className:"text-4xl lg:text-5xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-b from-white via-gray-200 to-gray-400 mb-4",children:te[_]}),e.jsx(_e,{className:"text-gray-300 text-lg leading-relaxed",children:ie[_]})]}),e.jsxs(be,{className:"px-8 pb-8",children:[ae(),e.jsx("div",{className:"mt-6 space-y-2",children:e.jsx(Ve,{siteKey:$,onVerify:ee,onExpire:se,onError:re,theme:"dark",size:"normal",className:"flex justify-center"})})]})]})})}),e.jsx("footer",{className:"relative z-10 w-full bg-transparent py-8",children:e.jsx(ye,{})})]})};export{He as default};
//# sourceMappingURL=Login-C3tmOJ8x.js.map
