{"version":3,"file":"Catalog-BQBo7n4F.js","sources":["../../src/hooks/useDebounce.ts","../../src/hooks/useContinueWatching.ts","../../src/components/catalog/MediaCardWithPlay.tsx","../../src/components/catalog/ResumePlaybackDialog.tsx","../../src/components/catalog/ContinueWatching.tsx","../../src/components/catalog/JellyfinLibrarySection.tsx","../../src/hooks/useNextUp.ts","../../src/components/catalog/NextUpSection.tsx","../../src/pages/Catalog.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\n\nexport function useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}","import { useState, useEffect, useCallback } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useSession } from '@/contexts/AuthContext';\n\nexport interface ContinueWatchingItem {\n  id: number; // tmdb_id\n  title?: string;\n  name?: string;\n  poster_path?: string | null;\n  media_type: 'movie' | 'tv' | 'anime';\n  progress: number; // as a percentage\n  playback_position_ticks: number;\n  runtime_ticks: number;\n season_number?: number;\n episode_number?: number;\n}\n\nexport const useContinueWatching = () => {\n  const { session } = useSession();\n  const [items, setItems] = useState<ContinueWatchingItem[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const fetchItems = useCallback(async () => {\n    if (!session?.user) {\n      setLoading(false);\n      setItems([]);\n      return;\n    }\n\n    setLoading(true);\n    const { data, error } = await supabase.rpc('get_continue_watching', { p_user_id: session.user.id });\n    \n    if (error) {\n      console.error('Error fetching continue watching items:', error);\n      setItems([]);\n    } else {\n      setItems(data as ContinueWatchingItem[]);\n    }\n    setLoading(false);\n  }, [session]);\n\n  useEffect(() => {\n    fetchItems();\n\n    const handlePlaybackEnded = () => fetchItems();\n    const handlePlaybackSaved = (_e: any) => {\n      try {\n        // When progress is saved we want to refresh the list to avoid stale UI\n        fetchItems();\n      } catch (err) {\n        console.error('Error handling playback-progress-saved in useContinueWatching:', err);\n      }\n    };\n\n    window.addEventListener('playback-ended', handlePlaybackEnded);\n    window.addEventListener('playback-progress-saved', handlePlaybackSaved);\n\n    return () => {\n      window.removeEventListener('playback-ended', handlePlaybackEnded);\n      window.removeEventListener('playback-progress-saved', handlePlaybackSaved);\n    };\n  }, [fetchItems]);\n\n  return { items, loading, refresh: fetchItems };\n};","import React from 'react';\nimport { Link } from 'react-router-dom';\nimport { Card } from '@/components/ui/card';\nimport { Film, Star, Plus, Check, Heart, Bookmark, Hourglass, X } from 'lucide-react';\nimport { useUserList } from '@/hooks/useUserList';\nimport { useSession } from '@/contexts/AuthContext';\nimport { useTranslation } from 'react-i18next';\nimport type { MediaItem } from './MediaGrid';\nimport { useJellyfin } from '@/contexts/JellyfinContext';\nimport { Badge } from '@/components/ui/badge';\nimport { motion } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\n\ninterface MediaCardWithPlayProps {\n  item: MediaItem;\n  showRequestButton?: boolean;\n  onRequest?: (item: MediaItem) => void;\n  searchTerm?: string;\n  progress?: number;\n  playUrl?: string;\n  playbackPositionTicks?: number;\n  runtimeTicks?: number;\n  showRemoveButton?: boolean;\n  onRemove?: (item: MediaItem) => void;\n  onPlayClick?: (e: React.MouseEvent, item: MediaItem) => void;\n}\n  \nconst MediaCardWithPlay: React.FC<MediaCardWithPlayProps> = ({ \n  item, \n  showRequestButton = true, \n  onRequest, \n  searchTerm, \n  progress, \n  playUrl, \n  playbackPositionTicks, \n  showRemoveButton, \n  onRemove,\n  onPlayClick\n}) => {\n  const { t } = useTranslation();\n  const { jellyfinUrl } = useJellyfin();\n  const { session } = useSession();\n  \n  const { addToList: addToFavorites, removeFromList: removeFromFavorites, isInList: isInFavorites } = useUserList('favorite');\n  const { addToList: addToWatchlist, removeFromList: removeFromWatchlist, isInList: isInWatchlist } = useUserList('watchlist');\n  \n  const title = item.title || item.name || 'No title';\n  const releaseDate = item.release_date || item.first_air_date;\n  const year = releaseDate ? new Date(releaseDate).getFullYear() : '';\n  const rating = item.vote_average ?? null;\n  const isAvailable = item.isAvailable;\n  \n  const mediaTypeForLink = item.media_type === 'anime' ? 'tv' : item.media_type;\n  \n  // Construire l'URL de lecture avec le temps de reprise si disponible\n  let linkTo = playUrl;\n  if (!linkTo) {\n    const baseUrl = `/media/${mediaTypeForLink}/${item.id}`;\n    const params = new URLSearchParams();\n    \n    if (searchTerm) {\n      params.append('fromSearch', searchTerm);\n    }\n    \n    // Ajouter le temps de reprise si disponible\n    const resumeTicks = (item as any).playback_position_ticks || playbackPositionTicks;\n    if (resumeTicks && resumeTicks > 0) {\n      const resumeTimeInSeconds = Math.floor(resumeTicks / 10000000);\n      params.append('t', resumeTimeInSeconds.toString());\n    }\n    \n    // Ajouter les paramètres de saison/épisode si disponibles\n    if ((item.media_type === 'tv' || item.media_type === 'anime') && \n        (item as any).season_number && (item as any).episode_number) {\n      params.append('season', (item as any).season_number.toString());\n      params.append('episode', (item as any).episode_number.toString());\n    }\n    \n    const queryString = params.toString();\n    linkTo = queryString ? `${baseUrl}/play?${queryString}` : baseUrl;\n  }\n\n  const getImageUrl = (path: string | null | undefined) => {\n    if (!path) return null;\n    if (path.startsWith('/')) {\n      return `https://image.tmdb.org/t/p/w500${path}`;\n    }\n    if (jellyfinUrl && path.startsWith('Items/')) {\n      return `${jellyfinUrl}/${path}`;\n    }\n    return path;\n  };\n\n  const imageUrl = getImageUrl(item.poster_path);\n  \n  // Compute resume time string\n  let resumeTimeString = '';\n  if ((item as any).playback_position_ticks && (item as any).playback_position_ticks > 0) {\n    const resumeSeconds = Math.floor((item as any).playback_position_ticks / 10000000);\n    const resumeMinutes = Math.floor(resumeSeconds / 60);\n    const resumeSecondsOnly = resumeSeconds % 60;\n    resumeTimeString = `${resumeMinutes}m ${resumeSecondsOnly}s`;\n  }\n\n  const cardVariants = {\n    initial: { opacity: 0, y: 20 },\n    animate: { opacity: 1, y: 0 },\n    hover: { y: -4, scale: 1.01 }\n  };\n\n\n\n  return (\n    <motion.div\n      variants={cardVariants}\n      initial=\"initial\"\n      animate=\"animate\"\n      whileHover=\"hover\"\n      transition={{ duration: 0.3, ease: \"easeOut\" }}\n      className=\"group\"\n    >\n             <Card className=\"relative overflow-hidden rounded-xl bg-card border border-border/50 transition-all duration-300 h-full shadow-sm hover:shadow-md hover:shadow-black/5\">\n                                       <div \n             className=\"block h-full\" \n             aria-label={title}\n           >\n          {/* Image container avec overlay */}\n          <div className=\"relative aspect-media bg-muted flex items-center justify-center overflow-hidden\">\n            {imageUrl ? (\n              <img\n                src={imageUrl}\n                alt={title}\n                className=\"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110\"\n                loading=\"lazy\"\n                decoding=\"async\"\n              />\n            ) : (\n              <div className=\"w-full h-full flex items-center justify-center text-muted-foreground\">\n                <Film className=\"h-12 w-12\" />\n              </div>\n            )}\n            \n            {/* Gradient overlay */}\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n\n\n\n            {/* Progress bar */}\n            {progress !== undefined && progress > 0 && (\n              <div className=\"absolute bottom-0 left-0 right-0 h-1 bg-muted/50\">\n                <div\n                  className=\"h-full bg-primary transition-all duration-300\"\n                  style={{ width: `${progress}%` }}\n                  aria-hidden=\"true\"\n                />\n              </div>\n            )}\n          </div>\n\n          {/* Content overlay */}\n          <div className=\"absolute inset-0 p-4 flex flex-col justify-end bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20\">\n            <h3 className=\"font-semibold text-sm line-clamp-2 mb-2 text-white transition-colors duration-300\">\n              {title}\n            </h3>\n            \n            <div className=\"flex items-center justify-between text-xs text-white/90\">\n              <span className=\"bg-black/30 backdrop-blur-sm px-2 py-1 rounded-md\">\n                {year}\n              </span>\n              {rating !== null && rating > 0 && (\n                <div className=\"flex items-center gap-1 bg-black/30 backdrop-blur-sm px-2 py-1 rounded-md\">\n                  <Star className=\"h-3 w-3 text-yellow-400 fill-current\" />\n                  <span className=\"font-medium\">{rating.toFixed(1)}</span>\n                </div>\n              )}\n            </div>\n\n            {/* Resume badge - affichage du temps de reprise */}\n            {session && ((item as any).playback_position_ticks || playbackPositionTicks) && (\n              <div className=\"mt-2 inline-block bg-primary/90 backdrop-blur-sm text-xs text-primary-foreground px-2 py-1 rounded-md font-medium\">\n                {t('resume_at', { time: resumeTimeString || (() => {\n                  if (playbackPositionTicks && playbackPositionTicks > 0) {\n                    const resumeSeconds = Math.floor(playbackPositionTicks / 10000000);\n                    const resumeMinutes = Math.floor(resumeSeconds / 60);\n                    const resumeSecondsOnly = resumeSeconds % 60;\n                    return `${resumeMinutes}m ${resumeSecondsOnly}s`;\n                  }\n                  return '';\n                })() })}\n              </div>\n            )}\n\n\n                     </div>\n         </div>\n        \n        {/* Status badges */}\n        <div className=\"absolute top-3 left-3 z-30\">\n          {isAvailable && (\n            <Badge className=\"bg-success text-success-foreground border-0 shadow-md hover:bg-success\">\n              <Check className=\"h-3 w-3 mr-1\" />\n              {t('available')}\n            </Badge>\n          )}\n          {item.isRequested && !isAvailable && (\n            <Badge className=\"bg-warning text-warning-foreground border-0 shadow-md hover:bg-warning\">\n              <Hourglass className=\"h-3 w-3 mr-1\" />\n              {t('requested')}\n            </Badge>\n          )}\n        </div>\n        \n        {/* Action buttons */}\n        <div className=\"absolute top-3 right-3 z-30 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-all duration-300\">\n          {showRemoveButton && onRemove && (\n            <motion.button\n              whileHover={{ scale: 1.1 }}\n              whileTap={{ scale: 0.95 }}\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                onRemove(item);\n              }}\n              aria-label={`Retirer ${title} de la liste`}\n              className=\"h-8 w-8 rounded-full bg-destructive/90 backdrop-blur-sm text-destructive-foreground flex items-center justify-center transition-all duration-200 hover:bg-destructive shadow-md\"\n            >\n              <X className=\"h-4 w-4\" />\n            </motion.button>\n          )}\n          \n          {showRequestButton && !isAvailable && !item.isRequested && (\n            <motion.button\n              whileHover={{ scale: 1.1 }}\n              whileTap={{ scale: 0.95 }}\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                if (onRequest) onRequest(item);\n              }}\n              aria-label={`${t('request')} ${title}`}\n              className=\"h-8 w-8 rounded-full bg-primary/90 backdrop-blur-sm text-primary-foreground flex items-center justify-center transition-all duration-200 hover:bg-primary shadow-md\"\n            >\n              <Plus className=\"h-4 w-4\" />\n            </motion.button>\n          )}\n\n          {session && (\n            <>\n              <motion.button\n                whileHover={{ scale: 1.1 }}\n                whileTap={{ scale: 0.95 }}\n                onClick={(e) => {\n                  e.preventDefault(); \n                  e.stopPropagation();\n                  isInFavorites(item.id, item.media_type) \n                    ? removeFromFavorites(item.id, item.media_type) \n                    : addToFavorites(item.id, item.media_type);\n                }}\n                aria-label={isInFavorites(item.id, item.media_type) ? t('remove_from_favorites') : t('add_to_favorites')}\n                className={cn(\n                  \"h-8 w-8 rounded-full backdrop-blur-sm flex items-center justify-center transition-all duration-200 shadow-md\",\n                  isInFavorites(item.id, item.media_type)\n                    ? \"bg-destructive/90 text-destructive-foreground hover:bg-destructive\"\n                    : \"bg-background/90 text-foreground hover:bg-background\"\n                )}\n              >\n                <Heart className={cn(\n                  \"h-4 w-4 transition-all duration-200\",\n                  isInFavorites(item.id, item.media_type) && \"fill-current\"\n                )} />\n              </motion.button>\n              \n              <motion.button\n                whileHover={{ scale: 1.1 }}\n                whileTap={{ scale: 0.95 }}\n                onClick={(e) => {\n                  e.preventDefault(); \n                  e.stopPropagation();\n                  isInWatchlist(item.id, item.media_type) \n                    ? removeFromWatchlist(item.id, item.media_type) \n                    : addToWatchlist(item.id, item.media_type);\n                }}\n                aria-label={isInWatchlist(item.id, item.media_type) ? t('remove_from_watchlist') : t('add_to_watchlist')}\n                className={cn(\n                  \"h-8 w-8 rounded-full backdrop-blur-sm flex items-center justify-center transition-all duration-200 shadow-md\",\n                  isInWatchlist(item.id, item.media_type)\n                    ? \"bg-primary/90 text-primary-foreground hover:bg-primary\"\n                    : \"bg-background/90 text-foreground hover:bg-background\"\n                )}\n              >\n                <Bookmark className={cn(\n                  \"h-4 w-4 transition-all duration-200\",\n                  isInWatchlist(item.id, item.media_type) && \"fill-current\"\n                )} />\n              </motion.button>\n            </>\n          )}\n        </div>\n      </Card>\n    </motion.div>\n  );\n};\n\nexport default MediaCardWithPlay;\n","import {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogClose,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { ContinueWatchingItem } from \"@/hooks/useContinueWatching\";\nimport { useTranslation } from \"react-i18next\";\nimport { X } from 'lucide-react';\n\ninterface ResumePlaybackDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  item: ContinueWatchingItem | null;\n  onResume: () => void;\n  onRestart: () => void;\n  onViewDetails: () => void;\n}\n\nconst ResumePlaybackDialog = ({ open, onOpenChange, item, onResume, onRestart, onViewDetails }: ResumePlaybackDialogProps) => {\n  const { t } = useTranslation();\n\n  if (!item) return null;\n\n  const resumeTimeInSeconds = Math.floor(item.playback_position_ticks / 10000000);\n  const minutes = Math.floor(resumeTimeInSeconds / 60);\n  const seconds = resumeTimeInSeconds % 60;\n  const resumeTimeString = `${minutes}m ${seconds}s`;\n\n  const title = item.title || item.name;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>{title}</DialogTitle>\n          <DialogDescription>\n            {t('resume_or_restart_description')}\n          </DialogDescription>\n        </DialogHeader>\n        <DialogFooter className=\"sm:justify-center gap-2\">\n          <Button variant=\"secondary\" onClick={onViewDetails}>\n            {t('view_details')}\n          </Button>\n          <Button variant=\"outline\" onClick={onRestart}>\n            {t('restart_playback')}\n          </Button>\n          <Button onClick={onResume}>\n            {t('resume_at', { time: resumeTimeString })}\n          </Button>\n        </DialogFooter>\n        <DialogClose asChild className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n          <Button variant=\"ghost\" size=\"icon\">\n            <X className=\"h-4 w-4\" />\n            <span className=\"sr-only\">Close</span>\n          </Button>\n        </DialogClose>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default ResumePlaybackDialog;","import React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Link } from 'react-router-dom';\nimport { useContinueWatching, ContinueWatchingItem } from '@/hooks/useContinueWatching';\nimport { Carousel, CarouselContent, CarouselItem, CarouselNext, CarouselPrevious } from '@/components/ui/carousel';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Button } from '@/components/ui/button';\nimport { ArrowRight } from 'lucide-react';\nimport MediaCardWithPlay from './MediaCardWithPlay';\nimport { useSession } from '@/contexts/AuthContext';\nimport { useNavigate } from 'react-router-dom';\nimport { useJellyfin } from '@/contexts/JellyfinContext';\nimport ResumePlaybackDialog from './ResumePlaybackDialog';\nimport { supabase } from '@/integrations/supabase/client';\n\nconst ContinueWatching = () => {\n  const { t } = useTranslation();\n  const { session } = useSession();\n  const { items, loading } = useContinueWatching();\n  const { error: jellyfinError } = useJellyfin();\n  const navigate = useNavigate();\n\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [selectedItem, setSelectedItem] = useState<ContinueWatchingItem | null>(null);\n  const [nowPlayingId, setNowPlayingId] = useState<number | null>(null);\n  const [lastWatchedId, setLastWatchedId] = useState<number | null>(null);\n\n  useEffect(() => {\n    // Récupérer le dernier média regardé depuis localStorage\n    const stored = localStorage.getItem('lastWatchedMediaId');\n    if (stored) {\n      const id = Number(stored);\n      if (Number.isFinite(id)) setLastWatchedId(id);\n    }\n  }, []);\n\n  useEffect(() => {\n    const onSaved = (e: any) => {\n      const id = Number(e?.detail?.tmdbId);\n      if (Number.isFinite(id)) {\n        setNowPlayingId(id);\n        setLastWatchedId(id);\n        localStorage.setItem('lastWatchedMediaId', id.toString());\n      }\n    };\n    window.addEventListener('playback-progress-saved', onSaved);\n    return () => window.removeEventListener('playback-progress-saved', onSaved);\n  }, []);\n\n  const handleCardClick = (e: React.MouseEvent, item: ContinueWatchingItem) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setSelectedItem(item);\n    setDialogOpen(true);\n  };\n\n  const handlePlayClick = (e: React.MouseEvent, item: ContinueWatchingItem) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    if (!item.id || !item.media_type) {\n      console.error('Attempted to resume playback for an item missing id or media_type', item);\n      return;\n    }\n    \n    const resumeTimeInSeconds = item.playback_position_ticks / 10000000;\n    let url = `/media/${item.media_type}/${item.id}/play?t=${resumeTimeInSeconds}`;\n    if ((item.media_type === 'tv' || item.media_type === 'anime') && item.season_number && item.episode_number) {\n      url += `&season=${item.season_number}&episode=${item.episode_number}`;\n    }\n    navigate(url);\n  };\n\n  const handleResume = () => {\n    if (!selectedItem) return;\n    if (!selectedItem.id || !selectedItem.media_type) {\n      console.error('Attempted to resume playback for an item missing id or media_type', selectedItem);\n      setDialogOpen(false);\n      return;\n    }\n    const resumeTimeInSeconds = selectedItem.playback_position_ticks / 10000000;\n   let url = `/media/${selectedItem.media_type}/${selectedItem.id}/play?t=${resumeTimeInSeconds}`;\n   if ((selectedItem.media_type === 'tv' || selectedItem.media_type === 'anime') && selectedItem.season_number && selectedItem.episode_number) {\n     url += `&season=${selectedItem.season_number}&episode=${selectedItem.episode_number}`;\n   }\n   navigate(url);\n    setDialogOpen(false);\n  };\n\n  const handleRestart = () => {\n    if (!selectedItem) return;\n    if (!selectedItem.id || !selectedItem.media_type) {\n      console.error('Attempted to restart playback for an item missing id or media_type', selectedItem);\n      setDialogOpen(false);\n      return;\n    }\n    navigate(`/media/${selectedItem.media_type}/${selectedItem.id}/play`);\n    setDialogOpen(false);\n  };\n\n  const handleViewDetails = () => {\n    if (!selectedItem) return;\n    if (!selectedItem.id || !selectedItem.media_type) {\n      console.error('Attempted to view details for an item missing id or media_type', selectedItem);\n      setDialogOpen(false);\n      return;\n    }\n    navigate(`/media/${selectedItem.media_type}/${selectedItem.id}`);\n    setDialogOpen(false);\n  };\n\n  const handleRemoveFromContinueWatching = async (item: ContinueWatchingItem) => {\n    if (!session?.user || !item.id || !item.media_type) return;\n    \n    try {\n      // Supprimer toutes les entrées de playback_progress pour ce média\n      const { error } = await supabase\n        .from('playback_progress')\n        .delete()\n        .eq('user_id', session.user.id)\n        .eq('tmdb_id', item.id)\n        .eq('media_type', item.media_type);\n      \n      if (error) {\n        console.error('Error removing from continue watching:', error);\n        return;\n      }\n      \n      // Rafraîchir la liste\n      window.dispatchEvent(new CustomEvent('playback-progress-saved', {\n        detail: { tmdbId: item.id, mediaType: item.media_type }\n      }));\n    } catch (err) {\n      console.error('Error removing from continue watching:', err);\n    }\n  };\n\n  const handleRemoveWrapper = (mediaItem: any) => {\n    // Trouver l'item correspondant dans sortedItems\n    const continueItem = sortedItems.find(item => item.id === mediaItem.id && item.media_type === mediaItem.media_type);\n    if (continueItem) {\n      handleRemoveFromContinueWatching(continueItem);\n    }\n  };\n\n  // Filter out invalid items (missing id or media_type) to avoid generating invalid routes\n  const validItems = useMemo(() => (Array.isArray(items) ? items.filter(i => i && i.id && i.media_type) : []), [items]);\n\n  const sortedItems = useMemo(() => {\n    const proximity = (it: ContinueWatchingItem) => {\n      const rt = Number(it.runtime_ticks || 0);\n      const pp = Number(it.playback_position_ticks || 0);\n      if (rt > 0) return Math.max(0, Math.min(1, pp / rt));\n      return Math.max(0, Math.min(1, Number(it.progress || 0) / 100));\n    };\n    const arr = [...validItems].sort((a, b) => {\n      // Priorité 1: ce qui est en cours de lecture\n      if (nowPlayingId && a.id === nowPlayingId && b.id !== nowPlayingId) return -1;\n      if (nowPlayingId && b.id === nowPlayingId && a.id !== nowPlayingId) return 1;\n      \n      // Priorité 2: le dernier média regardé\n      if (lastWatchedId && a.id === lastWatchedId && b.id !== lastWatchedId) return -1;\n      if (lastWatchedId && b.id === lastWatchedId && a.id !== lastWatchedId) return 1;\n      \n      // Priorité 3: ce qui est le plus proche de la fin (ratio élevé)\n      const aRatio = proximity(a);\n      const bRatio = proximity(b);\n      \n      // Seuil minimum: ne pas prioriser les médias avec < 5% de progression\n      const MIN_PROGRESS = 0.05;\n      if (aRatio < MIN_PROGRESS && bRatio >= MIN_PROGRESS) return 1;\n      if (bRatio < MIN_PROGRESS && aRatio >= MIN_PROGRESS) return -1;\n      \n      return bRatio - aRatio;\n    });\n    return arr;\n  }, [validItems, nowPlayingId, lastWatchedId]);\n\n  if (!session || (!loading && sortedItems.length === 0)) {\n    return null;\n  }\n\n  if (jellyfinError) {\n    return (\n      <section className=\"mb-12\">\n        <h2 className=\"text-2xl font-bold mb-4\">{t('continue_watching')}</h2>\n        <div className=\"text-red-500 p-4 rounded-lg bg-red-500/10 border border-red-500/20\">\n          <p>Erreur de configuration Jellyfin : {jellyfinError}</p>\n        </div>\n      </section>\n    );\n  }\n\n  return (\n    <>\n      <section className=\"mb-12\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-2xl font-bold\">{t('continue_watching')}</h2>\n          <Button asChild variant=\"link\">\n            <Link to=\"/catalog\">\n              {t('view_all')} <ArrowRight className=\"ml-2 h-4 w-4\" />\n            </Link>\n          </Button>\n        </div>\n        {loading ? (\n          <div className=\"flex space-x-4\">\n            {[...Array(6)].map((_, i) => (\n              <div key={i} className=\"w-[16.66%] flex-shrink-0\">\n                <Skeleton className=\"aspect-[2/3] w-full rounded-lg\" />\n              </div>\n            ))}\n          </div>\n        ) : (\n          <Carousel opts={{ align: \"start\", dragFree: true }} className=\"w-full\">\n            <CarouselContent className=\"-ml-4\">\n              {sortedItems.map((item) => {\n                return (\n                  <CarouselItem key={`${item.media_type}-${item.id}`} className=\"basis-1/2 sm:basis-1/3 md:basis-1/4 lg:basis-1/5 xl:basis-1/6 pl-4\">\n                    <div onClick={(e) => handleCardClick(e, item)} className=\"cursor-pointer\">\n                      <MediaCardWithPlay\n                        item={{\n                          ...item,\n                          // Affiche l'épisode en cours si disponible (Sxx Exx)\n                          title:\n                            (item.media_type !== 'movie' && item.season_number && item.episode_number)\n                              ? `${item.title || item.name || ''} • S${String(item.season_number).padStart(2,'0')} E${String(item.episode_number).padStart(2,'0')}`\n                              : item.title || item.name,\n                        } as any}\n                        showRequestButton={false}\n                        showRemoveButton={true}\n                        onRemove={handleRemoveWrapper}\n                        onPlayClick={handlePlayClick}\n                        progress={item.progress}\n                        playbackPositionTicks={item.playback_position_ticks}\n                        runtimeTicks={item.runtime_ticks}\n                      />\n                    </div>\n                  </CarouselItem>\n                );\n              })}\n            </CarouselContent>\n            <CarouselPrevious className=\"hidden sm:flex\" />\n            <CarouselNext className=\"hidden sm:flex\" />\n          </Carousel>\n        )}\n      </section>\n      <ResumePlaybackDialog\n        open={dialogOpen}\n        onOpenChange={setDialogOpen}\n        item={selectedItem}\n        onResume={handleResume}\n        onRestart={handleRestart}\n        onViewDetails={handleViewDetails}\n      />\n    </>\n  );\n};\n\nexport default ContinueWatching;","import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Link } from 'react-router-dom';\nimport { supabase } from '@/integrations/supabase/client';\nimport { showError } from '@/utils/toast';\nimport { Carousel, CarouselContent, CarouselItem, CarouselNext, CarouselPrevious } from '@/components/ui/carousel';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Button } from '@/components/ui/button';\nimport { ArrowRight } from 'lucide-react';\nimport MediaCard from './MediaCard';\nimport { MediaItem } from './MediaGrid';\nimport { useJellyfin } from '@/contexts/JellyfinContext';\n\ninterface JellyfinLibrary {\n  id: string;\n  name: string;\n  collectionType: string;\n}\n\ninterface JellyfinLibrarySectionProps {\n  library: JellyfinLibrary;\n}\n\nconst JellyfinLibrarySection: React.FC<JellyfinLibrarySectionProps> = ({ library }) => {\n  const { t } = useTranslation();\n  const { jellyfinUrl, loading: jellyfinLoading, error: jellyfinError } = useJellyfin();\n  const [items, setItems] = useState<MediaItem[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // Fonction pour déterminer la section appropriée basée sur le nom de la bibliothèque\n  const getAppropriateSection = (libraryName: string, collectionType: string) => {\n    const name = libraryName.toLowerCase();\n    \n    // Correspondances exactes pour les cas spécifiques\n    if (name === 'animés' || name === 'animes') {\n      return 'animes';\n    }\n    \n    // Détecter les bibliothèques d'animés (asiatiques) - PRIORITÉ ÉLEVÉE\n    if (name.includes('anime') || name.includes('japon') || name.includes('japanese') || name.includes('manga') || name.includes('animes') || name.includes('japan') || name.includes('corée') || name.includes('korea') || name.includes('chinese') || name.includes('chinois')) {\n      return 'animes';\n    }\n    \n    // Détecter les bibliothèques d'animations (occidentales)\n    if (name.includes('animation') || name.includes('anim') || name.includes('cartoon') || name.includes('disney') || name.includes('pixar') || name.includes('dreamworks')) {\n      return 'animations';\n    }\n    \n    // Par défaut, utiliser la logique basée sur le type de collection\n    return collectionType === 'movies' ? 'films' : 'series';\n  };\n\n  useEffect(() => {\n    const fetchItems = async () => {\n      setLoading(true);\n      try {\n        const { data, error } = await supabase.functions.invoke('get-jellyfin-library-items', {\n          body: { libraryId: library.id, page: 1, limit: 15 },\n        });\n        if (error) throw error;\n        \n        const itemsWithAvailability = data.items.map((item: any) => ({\n          ...item,\n          isAvailable: true,\n        }));\n        setItems(itemsWithAvailability);\n      } catch (error: any) {\n        showError(error.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchItems();\n  }, [library.id]);\n\n  if (jellyfinError) {\n    return (\n      <section>\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-2xl font-bold\">{library.name}</h2>\n        </div>\n        <div className=\"text-red-500 p-4 rounded-lg bg-red-500/10 border border-red-500/20\">\n          <p>Erreur de configuration Jellyfin : {jellyfinError}</p>\n        </div>\n      </section>\n    );\n  }\n\n  return (\n    <section>\n      <div className=\"flex items-center justify-between mb-4\">\n        <h2 className=\"text-2xl font-bold\">{library.name}</h2>\n        <Button asChild variant=\"link\">\n          <Link to={`/discover/${getAppropriateSection(library.name, library.collectionType)}`} state={{ libraryName: library.name }}>\n            {t('view_all')} <ArrowRight className=\"ml-2 h-4 w-4\" />\n          </Link>\n        </Button>\n      </div>\n      {loading ? (\n        <div className=\"flex space-x-4\">\n          {[...Array(6)].map((_, i) => (\n            <div key={i} className=\"w-full basis-1/2 sm:basis-1/3 md:basis-1/4 lg:basis-1/6\">\n              <Skeleton className=\"aspect-[2/3] w-full\" />\n            </div>\n          ))}\n        </div>\n      ) : (\n        <Carousel opts={{ align: \"start\", dragFree: true }} className=\"w-full\">\n          <CarouselContent className=\"-ml-4\">\n            {items.map((item) => (\n              <CarouselItem key={item.id} className=\"basis-1/2 sm:basis-1/3 md:basis-1/4 lg:basis-1/5 xl:basis-1/6 pl-4\">\n                <MediaCard item={item} showRequestButton={false} />\n              </CarouselItem>\n            ))}\n          </CarouselContent>\n          <CarouselPrevious className=\"hidden sm:flex\" />\n          <CarouselNext className=\"hidden sm:flex\" />\n        </Carousel>\n      )}\n    </section>\n  );\n};\n\nexport default JellyfinLibrarySection;","import { useState, useEffect, useCallback } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useSession } from '@/contexts/AuthContext';\r\n\r\nexport interface NextUpItem {\r\n  id: number; // tmdb_id of the series\r\n  title?: string;\r\n  name?: string;\r\n  poster_path?: string | null;\r\n  media_type: 'tv' | 'anime';\r\n  next_episode_to_watch: {\r\n    season_number: number;\r\n    episode_number: number;\r\n    title: string;\r\n  };\r\n}\r\n\r\nexport const useNextUp = () => {\r\n  const { session } = useSession();\r\n  const [items, setItems] = useState<NextUpItem[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const fetchItems = useCallback(async () => {\r\n    if (!session?.user) {\r\n      setLoading(false);\r\n      setItems([]);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    const { data, error } = await supabase.rpc('get_next_up_episodes', { p_user_id: session.user.id });\r\n    \r\n    if (error) {\r\n      console.error('Error fetching next up items:', error);\r\n      setItems([]);\r\n    } else {\r\n      setItems(data as NextUpItem[]);\r\n    }\r\n    setLoading(false);\r\n  }, [session]);\r\n\r\n  useEffect(() => {\r\n    fetchItems();\r\n\r\n   const handlePlaybackEnded = () => fetchItems();\r\n   window.addEventListener('playback-ended', handlePlaybackEnded);\r\n\r\n   return () => {\r\n     window.removeEventListener('playback-ended', handlePlaybackEnded);\r\n   };\r\n  }, [fetchItems]);\r\n\r\n  return { items, loading, refresh: fetchItems };\r\n};","import React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Link } from 'react-router-dom';\nimport { useNextUp, NextUpItem } from '@/hooks/useNextUp';\nimport { useContinueWatching } from '@/hooks/useContinueWatching';\nimport { Carousel, CarouselContent, CarouselItem, CarouselNext, CarouselPrevious } from '@/components/ui/carousel';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Button } from '@/components/ui/button';\nimport { ArrowRight } from 'lucide-react';\nimport MediaCard from './MediaCard';\nimport { useSession } from '@/contexts/AuthContext';\nimport { supabase } from '@/integrations/supabase/client';\n\nconst NextUpSection = () => {\n  const { t } = useTranslation();\n  const { session } = useSession();\n  const { items, loading } = useNextUp();\n  const { items: continueItems } = useContinueWatching();\n\n  // IDs récemment terminés/sauvegardés pour surfacer immédiatement le prochain\n  const [recentIds, setRecentIds] = useState<Set<number>>(new Set());\n  useEffect(() => {\n    const handler = (e: any) => {\n      const id = Number(e?.detail?.tmdbId);\n      const mediaType = e?.detail?.mediaType;\n      if (!Number.isFinite(id)) return;\n      if (mediaType !== 'tv' && mediaType !== 'anime') return;\n      setRecentIds(prev => {\n        const next = new Set(prev);\n        next.add(id);\n        return next;\n      });\n      // expire après 2 minutes\n      setTimeout(() => {\n        setRecentIds(prev => {\n          const next = new Set(prev);\n          next.delete(id);\n          return next;\n        });\n      }, 120000);\n    };\n    window.addEventListener('playback-progress-saved', handler);\n    return () => window.removeEventListener('playback-progress-saved', handler);\n  }, []);\n\n  const continueById = useMemo(() => new Map<number, { ratio: number }>(\n    (continueItems || []).map(ci => {\n      const rt = Number(ci.runtime_ticks || 0);\n      const pp = Number(ci.playback_position_ticks || 0);\n      const ratio = rt > 0 ? Math.max(0, Math.min(1, pp / rt)) : Math.max(0, Math.min(1, Number(ci.progress || 0) / 100));\n      return [ci.id, { ratio }];\n    })\n  ), [continueItems]);\n\n  // Inclure si ratio >= 0.9 OU si récemment sauvegardé (fin de lecture)\n  const filteredItems = items.filter((it) => {\n    if (it.media_type !== 'tv' && it.media_type !== 'anime') return false;\n    if (recentIds.has(it.id)) return true;\n    const c = continueById.get(it.id);\n    return !!c && c.ratio >= 0.9;\n  });\n\n  // Trier: récents d'abord, puis par ratio décroissant\n  const sortedItems = useMemo(() => {\n    return [...filteredItems].sort((a, b) => {\n      const aRecent = recentIds.has(a.id) ? 1 : 0;\n      const bRecent = recentIds.has(b.id) ? 1 : 0;\n      if (aRecent !== bRecent) return bRecent - aRecent;\n      const ar = continueById.get(a.id)?.ratio ?? 0;\n      const br = continueById.get(b.id)?.ratio ?? 0;\n      return br - ar;\n    });\n  }, [filteredItems, continueById, recentIds]);\n\n  const handleRemoveFromNextUp = async (item: any) => {\n    if (!session?.user || !item.id || !item.media_type) return;\n    \n    try {\n      // Supprimer toutes les entrées de playback_progress pour ce média\n      const { error } = await supabase\n        .from('playback_progress')\n        .delete()\n        .eq('user_id', session.user.id)\n        .eq('tmdb_id', item.id)\n        .eq('media_type', item.media_type);\n      \n      if (error) {\n        console.error('Error removing from next up:', error);\n        return;\n      }\n      \n      // Rafraîchir la liste\n      window.dispatchEvent(new CustomEvent('playback-progress-saved', {\n        detail: { tmdbId: item.id, mediaType: item.media_type }\n      }));\n    } catch (err) {\n      console.error('Error removing from next up:', err);\n    }\n  };\n\n  if (!session || (!loading && sortedItems.length === 0)) {\n    return null;\n  }\n\n  return (\n    <section className=\"mb-12\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h2 className=\"text-2xl font-bold\">{t('next_up')}</h2>\n        <Button asChild variant=\"link\">\n          <Link to=\"/catalog\">\n            {t('view_all')} <ArrowRight className=\"ml-2 h-4 w-4\" />\n          </Link>\n        </Button>\n      </div>\n      {loading ? (\n        <div className=\"flex space-x-4\">\n          {[...Array(6)].map((_, i) => (\n            <div key={i} className=\"w-[16.66%] flex-shrink-0\">\n              <Skeleton className=\"aspect-[2/3] w-full rounded-lg\" />\n            </div>\n          ))}\n        </div>\n      ) : (\n        <Carousel opts={{ align: \"start\", dragFree: true }} className=\"w-full\">\n          <CarouselContent className=\"-ml-4\">\n            {sortedItems.map((item) => {\n              const ep = item.next_episode_to_watch as any;\n              const season = ep?.season_number ?? ep?.seasonNumber;\n              const episode = ep?.episode_number ?? ep?.episodeNumber;\n              const episodeTitle = ep?.title ?? `${item.title} S${season} E${episode}`;\n              const poster = ep?.still_path ?? item.poster_path;\n              const mediaItem = {\n                ...item,\n                title: episodeTitle,\n                poster_path: poster,\n              } as any;\n              const playUrl = `/media/${item.media_type}/${item.id}/play?season=${season}&episode=${episode}`;\n              return (\n                <CarouselItem key={`${item.media_type}-${item.id}`} className=\"basis-1/2 sm:basis-1/3 md:basis-1/4 lg:basis-1/5 xl:basis-1/6 pl-4\">\n                  <MediaCard \n                    item={mediaItem} \n                    showRequestButton={false} \n                    showRemoveButton={true}\n                    onRemove={handleRemoveFromNextUp}\n                    progress={0} \n                    playUrl={playUrl} \n                  />\n                </CarouselItem>\n              );\n            })}\n          </CarouselContent>\n          <CarouselPrevious className=\"hidden sm:flex\" />\n          <CarouselNext className=\"hidden sm:flex\" />\n        </Carousel>\n      )}\n    </section>\n  );\n};\n\nexport default NextUpSection;","import { useState, useEffect, useCallback } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport MediaGrid, { MediaItem } from '../components/catalog/MediaGrid';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Search, Loader2, X } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { showError } from '@/utils/toast';\nimport { useDebounce } from '@/hooks/useDebounce';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { useSession } from '@/contexts/AuthContext';\nimport ContinueWatching from '@/components/catalog/ContinueWatching';\nimport JellyfinLibrarySection from '@/components/catalog/JellyfinLibrarySection';\nimport NextUpSection from '@/components/catalog/NextUpSection';\nimport { useJellyfin } from '@/contexts/JellyfinContext';\n\ninterface JellyfinLibrary {\n  id: string;\n  name: string;\n  collectionType: string;\n}\n\nconst CatalogPage = () => {\n  const { t, i18n } = useTranslation();\n  const { session } = useSession();\n  const { jellyfinUrl, loading: jellyfinLoading, error: jellyfinError } = useJellyfin();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [searchResults, setSearchResults] = useState<MediaItem[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [jellyfinLibraries, setJellyfinLibraries] = useState<JellyfinLibrary[]>([]);\n  const [librariesLoading, setLibrariesLoading] = useState(true);\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\n\n  const fetchJellyfinLibraries = useCallback(async () => {\n    if (!jellyfinUrl) {\n      setLibrariesLoading(false);\n      return;\n    }\n\n    try {\n      const { data: librariesData, error: librariesError } = await supabase.functions.invoke('get-jellyfin-libraries');\n      if (librariesError) throw librariesError;\n      setJellyfinLibraries(librariesData || []);\n    } catch (error: any) {\n      console.error('Error fetching Jellyfin libraries:', error);\n    } finally {\n      setLibrariesLoading(false);\n    }\n  }, [jellyfinUrl]);\n\n  useEffect(() => {\n    fetchJellyfinLibraries();\n  }, [fetchJellyfinLibraries]);\n\n  const handleSearch = useCallback(async (term: string) => {\n    if (!term.trim()) {\n      setSearchResults([]);\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n    \n    try {\n      const { data, error } = await supabase.functions.invoke('search-media', {\n        body: { query: term, language: i18n.language },\n      });\n      \n      if (error) {\n        console.error('Supabase function error:', error);\n        throw error;\n      }\n      \n      setSearchResults(data.results || []);\n    } catch (error: any) {\n      console.error('Search error:', error);\n      showError(error.message);\n      setSearchResults([]);\n    } finally {\n      setLoading(false);\n    }\n  }, [i18n.language]);\n\n  useEffect(() => {\n    handleSearch(debouncedSearchTerm);\n  }, [debouncedSearchTerm, handleSearch]);\n\n  const clearSearch = () => {\n    setSearchTerm('');\n    setSearchResults([]);\n  };\n\n  const LoadingSkeleton = () => (\n    <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4\">\n      {[...Array(12)].map((_, i) => (\n        <div key={i} className=\"space-y-2\">\n          <Skeleton className=\"aspect-[2/3] w-full rounded-lg\" />\n          <Skeleton className=\"h-4 w-3/4\" />\n          <Skeleton className=\"h-4 w-1/2\" />\n        </div>\n      ))}\n    </div>\n  );\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"flex items-center gap-4 mb-8\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n          <Input\n            type=\"text\"\n            placeholder={t('search_placeholder')}\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"pl-10\"\n          />\n          {searchTerm && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={clearSearch}\n              className=\"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          )}\n        </div>\n        {loading && <Loader2 className=\"h-4 w-4 animate-spin\" />}\n      </div>\n\n      <main>\n        {(searchTerm || debouncedSearchTerm) ? (\n          loading ? <LoadingSkeleton /> : (\n            searchResults.length > 0 ? (\n              <div>\n                <div className=\"mb-4 text-sm text-muted-foreground\">\n                  {t('search_results_for', { term: debouncedSearchTerm, count: searchResults.length })}\n                </div>\n                <MediaGrid items={searchResults} showRequestButton={!!session} searchTerm={debouncedSearchTerm} />\n              </div>\n            ) : (\n              <Card>\n                <CardContent>\n                  <div className=\"text-center py-12\">\n                    <Search className=\"h-12 w-12 text-muted-foreground/50 mx-auto mb-4\" />\n                    <h3 className=\"text-lg font-semibold mb-2\">{t('no_results_found')}</h3>\n                    <p className=\"text-muted-foreground mb-4\">\n                      {t('no_results_for', { term: debouncedSearchTerm })}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {t('search_tips')}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            )\n          )\n        ) : (\n          <div className=\"space-y-12\">\n            <ContinueWatching />\n            <NextUpSection />\n            \n            {/* Bibliothèques Jellyfin */}\n            {librariesLoading ? (\n              <>\n                <Skeleton className=\"h-8 w-1/4 mb-4\" />\n                <div className=\"flex space-x-4\">\n                  {[...Array(6)].map((_, i) => (\n                    <div key={i} className=\"w-[16.66%] flex-shrink-0\">\n                      <Skeleton className=\"aspect-[2/3] w-full rounded-lg\" />\n                    </div>\n                  ))}\n                </div>\n              </>\n            ) : (\n              jellyfinLibraries.map(library => (\n                <JellyfinLibrarySection key={library.id} library={library} />\n              ))\n            )}\n          </div>\n        )}\n      </main>\n    </div>\n  );\n};\n\nexport default CatalogPage;"],"names":["useDebounce","value","delay","debouncedValue","setDebouncedValue","useState","useEffect","handler","useContinueWatching","session","useSession","items","setItems","loading","setLoading","fetchItems","useCallback","__async","data","error","supabase","handlePlaybackEnded","handlePlaybackSaved","_e","err","MediaCardWithPlay","item","showRequestButton","onRequest","searchTerm","progress","playUrl","playbackPositionTicks","showRemoveButton","onRemove","onPlayClick","t","useTranslation","jellyfinUrl","useJellyfin","addToFavorites","removeFromFavorites","isInFavorites","useUserList","addToWatchlist","removeFromWatchlist","isInWatchlist","title","releaseDate","year","rating","_a","isAvailable","mediaTypeForLink","linkTo","baseUrl","params","resumeTicks","resumeTimeInSeconds","queryString","imageUrl","path","resumeTimeString","resumeSeconds","resumeMinutes","resumeSecondsOnly","cardVariants","jsx","motion","jsxs","Card","Film","Star","Badge","Check","Hourglass","e","X","Plus","Fragment","cn","Heart","Bookmark","ResumePlaybackDialog","open","onOpenChange","onResume","onRestart","onViewDetails","minutes","seconds","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","DialogFooter","Button","DialogClose","ContinueWatching","jellyfinError","navigate","useNavigate","dialogOpen","setDialogOpen","selectedItem","setSelectedItem","nowPlayingId","setNowPlayingId","lastWatchedId","setLastWatchedId","stored","id","onSaved","handleCardClick","handlePlayClick","url","handleResume","handleRestart","handleViewDetails","handleRemoveFromContinueWatching","handleRemoveWrapper","mediaItem","continueItem","sortedItems","validItems","useMemo","i","proximity","it","rt","pp","a","b","aRatio","bRatio","MIN_PROGRESS","Link","ArrowRight","_","Skeleton","Carousel","CarouselContent","CarouselItem","__spreadProps","__spreadValues","CarouselPrevious","CarouselNext","JellyfinLibrarySection","library","jellyfinLoading","getAppropriateSection","libraryName","collectionType","name","itemsWithAvailability","showError","MediaCard","useNextUp","NextUpSection","continueItems","recentIds","setRecentIds","mediaType","_b","prev","next","continueById","ci","ratio","filteredItems","c","aRecent","bRecent","ar","_d","_c","handleRemoveFromNextUp","ep","season","episode","episodeTitle","poster","CatalogPage","i18n","setSearchTerm","searchResults","setSearchResults","jellyfinLibraries","setJellyfinLibraries","librariesLoading","setLibrariesLoading","debouncedSearchTerm","fetchJellyfinLibraries","librariesData","librariesError","handleSearch","term","clearSearch","LoadingSkeleton","Search","Input","Loader2","MediaGrid","CardContent"],"mappings":"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"}