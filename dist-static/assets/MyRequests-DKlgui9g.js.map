{"version":3,"file":"MyRequests-DKlgui9g.js","sources":["../../src/pages/MyRequests.tsx"],"sourcesContent":["import { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useSession } from '@/contexts/AuthContext';\nimport { useRequestsByUserId, UserMediaRequest } from '@/hooks/useRequestsByUserId';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from '@/components/ui/card';\nimport { Button, buttonVariants } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { format } from 'date-fns';\nimport { fr, enUS } from 'date-fns/locale';\nimport { MailQuestion, Calendar, Tv, Film, Clapperboard } from 'lucide-react';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { showSuccess, showError } from '@/utils/toast';\nimport { motion } from 'framer-motion';\nimport { Link } from 'react-router-dom';\n\nconst MyRequestsPage = () => {\n  const { t, i18n } = useTranslation();\n  const { session } = useSession();\n  const { requests, loading, refreshRequests } = useRequestsByUserId(session?.user?.id);\n  const [requestToDelete, setRequestToDelete] = useState<UserMediaRequest | null>(null);\n\n  const currentLocale = i18n.language === 'fr' ? fr : enUS;\n\n  const statusConfig = {\n    pending: { text: t('status_pending'), className: 'bg-gray-500/20 text-gray-400 border-gray-500/30', ring: 'ring-gray-500/30' },\n    approved: { text: t('status_approved'), className: 'bg-blue-500/20 text-blue-400 border-blue-500/30', ring: 'ring-blue-500/30' },\n    rejected: { text: t('status_rejected'), className: 'bg-red-500/20 text-red-400 border-red-500/30', ring: 'ring-red-500/30' },\n    available: { text: t('status_available'), className: 'bg-green-500/20 text-green-400 border-green-500/30', ring: 'ring-green-500/30' },\n  };\n\n  const mediaTypeIcons = {\n    movie: <Film className=\"h-4 w-4\" />,\n    tv: <Tv className=\"h-4 w-4\" />,\n    anime: <Clapperboard className=\"h-4 w-4\" />,\n  };\n\n  // Suppression directe (une seule action)\n\n  const handleConfirmDelete = async () => {\n    if (!requestToDelete) return;\n    const { error } = await supabase\n      .from('media_requests')\n      .delete()\n      .eq('id', requestToDelete.id);\n    if (error) {\n      showError(t('error_deleting_requests'));\n    } else {\n      showSuccess(t('requests_deleted_successfully'));\n      refreshRequests();\n    }\n    setRequestToDelete(null);\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.5 }}\n      className=\"container mx-auto px-4 py-8\"\n    >\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold tracking-tight flex items-center gap-3\">\n          <MailQuestion className=\"h-8 w-8\" /> \n          {t('my_requests')}\n        </h1>\n        <p className=\"text-muted-foreground\">{t('my_requests_description')}</p>\n      </div>\n\n      {loading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[...Array(6)].map((_, i) => (\n            <Skeleton key={i} className=\"h-64 w-full rounded-lg\" />\n          ))}\n        </div>\n      ) : requests.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {requests.map((request, index) => (\n            <motion.div\n              key={request.id}\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.3, delay: index * 0.05 }}\n            >\n              <Card className={`h-full flex flex-col overflow-hidden ring-2 ring-transparent transition-all ${statusConfig[request.status]?.ring}`}>\n                <CardHeader className=\"flex flex-row items-start gap-4 p-4\">\n                  {request.poster_path ? (\n                    <img\n                      src={`https://image.tmdb.org/t/p/w154${request.poster_path}`}\n                      alt={request.title ?? ''}\n                      className=\"h-28 w-20 rounded-md object-cover\"\n                    />\n                  ) : (\n                    <div className=\"h-28 w-20 rounded-md bg-muted flex items-center justify-center\">\n                      {mediaTypeIcons[request.media_type] || <Clapperboard className=\"h-8 w-8 text-muted-foreground\" />}\n                    </div>\n                  )}\n                  <div className=\"flex-1\">\n                    <Badge variant=\"outline\" className={`mb-2 ${statusConfig[request.status]?.className}`}>\n                      {statusConfig[request.status]?.text}\n                    </Badge>\n                    <Link to={`/media/${request.media_type}/${request.tmdb_id}`} className=\"font-semibold leading-tight hover:underline text-lg\">\n                      {request.title}\n                    </Link>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"p-4 pt-0 flex-grow\">\n                  <div className=\"flex items-center text-sm text-muted-foreground\">\n                    <Calendar className=\"mr-2 h-4 w-4\" />\n                    <span>{format(new Date(request.requested_at), 'd MMMM yyyy', { locale: currentLocale })}</span>\n                  </div>\n                  <div className=\"flex items-center text-sm text-muted-foreground mt-1\">\n                    {mediaTypeIcons[request.media_type]}\n                    <span className=\"ml-2 capitalize\">{t(request.media_type)}</span>\n                  </div>\n                </CardContent>\n                <CardFooter className=\"p-2 bg-muted/30 border-t\">\n                  <Button variant=\"destructive\" size=\"sm\" className=\"w-full\" onClick={() => setRequestToDelete(request)}>\n                    {t('delete')}\n                  </Button>\n                </CardFooter>\n              </Card>\n            </motion.div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-16\">\n          <MailQuestion className=\"mx-auto h-12 w-12 text-muted-foreground\" />\n          <h3 className=\"mt-4 text-lg font-semibold\">{t('no_requests_yet')}</h3>\n          <p className=\"mt-2 text-sm text-muted-foreground\">{t('my_requests_empty_state_desc')}</p>\n          <Button asChild className=\"mt-6\">\n           <Link to=\"/catalog\">{t('go_to_catalog')}</Link>\n          </Button>\n        </div>\n      )}\n\n      {/* Confirmation suppression */}\n\n      <AlertDialog open={!!requestToDelete} onOpenChange={(open) => !open && setRequestToDelete(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t('confirm_delete_title')}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {t('confirm_delete_request', { title: requestToDelete?.title })}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel onClick={() => setRequestToDelete(null)}>{t('cancel')}</AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirmDelete} className={buttonVariants({ variant: \"destructive\" })}>\n              {t('delete')}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </motion.div>\n  );\n};\n\nexport default MyRequestsPage;"],"names":["MyRequestsPage","t","i18n","useTranslation","session","useSession","requests","loading","refreshRequests","useRequestsByUserId","_a","requestToDelete","setRequestToDelete","useState","currentLocale","fr","enUS","statusConfig","mediaTypeIcons","jsx","Film","Tv","Clapperboard","handleConfirmDelete","__async","error","supabase","showError","showSuccess","jsxs","motion","MailQuestion","_","i","Skeleton","request","index","Card","CardHeader","_b","Badge","_c","_d","Link","CardContent","Calendar","format","CardFooter","Button","AlertDialog","open","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","buttonVariants"],"mappings":"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"}