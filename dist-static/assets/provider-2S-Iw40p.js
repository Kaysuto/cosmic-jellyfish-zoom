var w=Object.defineProperty;var m=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var p=(r,t,i)=>t in r?w(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i,T=(r,t)=>{for(var i in t||(t={}))z.call(t,i)&&p(r,i,t[i]);if(m)for(var i of m(t))S.call(t,i)&&p(r,i,t[i]);return r};var d=(r,t,i)=>p(r,typeof t!="symbol"?t+"":t,i);var g=(r,t,i)=>new Promise((s,a)=>{var n=e=>{try{l(i.next(e))}catch(u){a(u)}},h=e=>{try{l(i.throw(e))}catch(u){a(u)}},l=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,h);l((i=i.apply(r,t)).next())});import{p as b,D as o,E as k,l as c,e as L,c as A,T as _,d as q,f as O,L as f,S as R,g as j,I as M,i as y,h as N,o as I,u as C,j as P,k as $,m as v,n as D,q as U,s as x,r as H,t as V}from"./streaming-fF1zHaJi.js";class E{constructor(t){d(this,"xi");this.jf=t}O(){y(this.xi)&&this.yi()}P(){N(this.xi)&&window.cancelAnimationFrame(this.xi),this.xi=void 0}yi(){this.xi=window.requestAnimationFrame(()=>{y(this.xi)||(this.jf(),this.yi())})}}const W=r=>A(r);class X{constructor(t){d(this,"ph");d(this,"za",null);d(this,"qh",null);d(this,"nh",{});d(this,"oh",new Set);this.qa=t}get instance(){return this.za}setup(t,i){this.ph=i;const s=b(i.$store.streamType).includes("live"),a=b(i.$store.streamType).includes("ll-");this.za=new t(T({lowLatencyMode:a,backBufferLength:a?4:s?8:void 0,renderTextTracksNatively:!1},this.nh));const n=this.rh.bind(this);for(const h of Object.values(t.Events))this.za.on(h,n);this.za.on(t.Events.ERROR,this.Wb.bind(this));for(const h of this.oh)h(this.za);i.player.dispatchEvent(new o("hls-instance",{detail:this.za})),this.za.attachMedia(this.qa),this.za.on(t.Events.AUDIO_TRACK_SWITCHED,this.sh.bind(this)),this.za.on(t.Events.LEVEL_SWITCHED,this.th.bind(this)),this.za.on(t.Events.LEVEL_LOADED,this.uh.bind(this)),this.za.on(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,this.vh.bind(this)),this.za.on(t.Events.CUES_PARSED,this.wh.bind(this)),i.qualities[k]=this.xh.bind(this),c(i.qualities,"change",this.Pf.bind(this)),c(i.audioTracks,"change",this.yh.bind(this)),this.qh=L(this.zh.bind(this))}zh(){if(!this.ph.$store.live())return;const t=new E(this.Ah.bind(this));return t.O(),t.P.bind(t)}Ah(){var t,i;this.ph.$store.liveSyncPosition.set((i=(t=this.za)==null?void 0:t.liveSyncPosition)!=null?i:1/0)}rh(t,i){this.ph.player.dispatchEvent(new o(W(t),{detail:i}))}vh(t,i){var n;const s=new o(t,{detail:i});let a=-1;for(let h=0;h<i.tracks.length;h++){const l=i.tracks[h],e=(n=l.subtitleTrack)!=null?n:l.closedCaptions,u=new _({id:`hls-${l.kind}${h}`,src:e==null?void 0:e.url,label:l.label,language:e==null?void 0:e.lang,kind:l.kind});u[q]=2,u[O]=()=>{u.mode==="showing"?(this.za.subtitleTrack=h,a=h):a===h&&(this.za.subtitleTrack=-1,a=-1)},l.default&&u.setMode("showing",s),this.ph.textTracks.add(u,s)}}wh(t,i){const s=this.ph.textTracks.getById(`hls-${i.track}`);if(!s)return;const a=new o(t,{detail:i});for(const n of i.cues)n.positionAlign="auto",s.addCue(n,a)}sh(t,i){const s=this.ph.audioTracks[i.id];s&&this.ph.audioTracks[f](s,!0,new o(t,{detail:i}))}th(t,i){const s=this.ph.qualities[i.level];s&&this.ph.qualities[f](s,!0,new o(t,{detail:i}))}uh(t,i){if(this.ph.$store.canPlay())return;const{type:s,live:a,totalduration:n}=i.details,h=new o(t,{detail:i});this.ph.delegate.p("stream-type-change",{detail:a?s==="EVENT"&&Number.isFinite(n)?"live:dvr":"live":"on-demand",trigger:h}),this.ph.delegate.p("duration-change",{detail:n,trigger:h});const l=this.za.media;this.za.currentLevel===-1&&this.ph.qualities[R](!0,h);for(const e of this.za.audioTracks)this.ph.audioTracks[j]({id:e.id+"",label:e.name,language:e.lang||"",kind:"main"},h);for(const e of this.za.levels)this.ph.qualities[j]({width:e.width,height:e.height,codec:e.codecSet,bitrate:e.bitrate},h);l.dispatchEvent(new o("canplay",{trigger:h}))}Wb(t,i){var s,a,n;if(i.fatal)switch(i.type){case"networkError":(s=this.za)==null||s.startLoad();break;case"mediaError":(a=this.za)==null||a.recoverMediaError();break;default:(n=this.za)==null||n.destroy(),this.za=null;break}}xh(){this.za&&(this.za.currentLevel=-1)}Pf(){const{qualities:t}=this.ph;!this.za||t.auto||(this.za[t.switch+"Level"]=t.selectedIndex,M&&(this.qa.currentTime=this.qa.currentTime))}yh(){const{audioTracks:t}=this.ph;this.za&&this.za.audioTrack!==t.selectedIndex&&(this.za.audioTrack=t.selectedIndex)}Jg(){var t,i;this.ph&&(this.ph.qualities[k]=void 0),(t=this.za)==null||t.destroy(),this.za=null,(i=this.qh)==null||i.call(this),this.qh=null}}class B{constructor(t,i){d(this,"ih",C());d(this,"Nh",!1);d(this,"Qh",!1);d(this,"Rh",!1);d(this,"Oh",new E(this.Wh.bind(this)));d(this,"ni");d(this,"pi");this.q=t,this.ph=i,this.Uh(),L(this.Vh.bind(this)),I(this.Eh.bind(this))}get j(){return this.q.media}get jg(){return this.ph.delegate}Eh(){this.Oh.P(),this.ih.empty()}Wh(){const t=this.q.currentTime;this.ph.$store.currentTime()!==t&&this.Mh(t)}Uh(){this.Lh("loadstart",this.ge),this.Lh("abort",this.Sh),this.Lh("emptied",this.Xh),this.Lh("error",this.Wb)}Yh(){this.Qh||(this.ih.add(this.Lh("loadeddata",this.Zh),this.Lh("loadedmetadata",this._h),this.Lh("canplay",this.Rb),this.Lh("canplaythrough",this.$h),this.Lh("durationchange",this.ai),this.Lh("play",this.bi),this.Lh("progress",this.ci),this.Lh("stalled",this.di),this.Lh("suspend",this.ei)),this.Qh=!0)}fi(){this.Rh||(this.ih.add(this.Lh("pause",this.gi),this.Lh("playing",this.hi),this.Lh("ratechange",this.ii),this.Lh("seeked",this.ji),this.Lh("seeking",this.ki),this.Lh("ended",this.li),this.Lh("volumechange",this.ac),this.Lh("waiting",this.mi)),this.Rh=!0)}Lh(t,i){return c(this.j,t,i.bind(this))}qi(t){}Mh(t,i){this.jg.p("time-update",{detail:{currentTime:Math.min(t,this.ph.$store.seekableEnd()),played:this.j.played},trigger:i})}ge(t){if(this.j.networkState===3){this.Sh(t);return}this.Yh(),this.jg.p("load-start",{trigger:t})}Sh(t){this.jg.p("abort",{trigger:t})}Xh(){this.jg.p("emptied",{trigger:event})}Zh(t){this.jg.p("loaded-data",{trigger:t})}_h(t){this.Th(),this.fi(),this.jg.p("volume-change",{detail:{volume:this.j.volume,muted:this.j.muted}}),this.jg.p("loaded-metadata",{trigger:t}),P&&$(this.ph.$store.source())&&this.jg.lf(this.Ph(),t)}Ph(){return{duration:this.j.duration,buffered:this.j.buffered,seekable:this.j.seekable}}Th(){const t=!Number.isFinite(this.j.duration);this.jg.p("stream-type-change",{detail:t?"live":"on-demand"})}bi(t){this.ph.$store.canPlay&&this.jg.p("play",{trigger:t})}gi(t){this.j.readyState===1&&!this.Nh||(this.Nh=!1,this.Oh.P(),this.jg.p("pause",{trigger:t}))}Rb(t){this.jg.lf(this.Ph(),t)}$h(t){this.ph.$store.started()||this.jg.p("can-play-through",{trigger:t,detail:this.Ph()})}hi(t){this.Nh=!1,this.jg.p("playing",{trigger:t}),this.Oh.O()}di(t){this.jg.p("stalled",{trigger:t}),this.j.readyState<3&&(this.Nh=!0,this.jg.p("waiting",{trigger:t}))}mi(t){this.j.readyState<3&&(this.Nh=!0,this.jg.p("waiting",{trigger:t}))}li(t){this.Oh.P(),this.Mh(this.j.duration,t),this.jg.p("end",{trigger:t}),this.ph.$store.loop()?this.oi():this.jg.p("ended",{trigger:t})}Vh(){this.ph.$store.paused()&&c(this.j,"timeupdate",this.Vb.bind(this))}Vb(t){this.Mh(this.j.currentTime,t)}ai(t){this.Th(),this.ph.$store.ended()&&this.Mh(this.j.duration,t),this.jg.p("duration-change",{detail:this.j.duration,trigger:t})}ac(t){this.jg.p("volume-change",{detail:{volume:this.j.volume,muted:this.j.muted},trigger:t})}ji(t){this.Mh(this.j.currentTime,t),this.jg.p("seeked",{detail:this.j.currentTime,trigger:t}),Math.trunc(this.j.currentTime)===Math.trunc(this.j.duration)&&v(this.j.duration)>v(this.j.currentTime)&&(this.Mh(this.j.duration,t),this.j.ended||this.ph.player.dispatchEvent(new o("media-play-request",{trigger:t})))}ki(t){this.jg.p("seeking",{detail:this.j.currentTime,trigger:t})}ci(t){this.jg.p("progress",{detail:{buffered:this.j.buffered,seekable:this.j.seekable},trigger:t})}oi(){D(this.j.controls)&&(this.j.controls=!1),this.ph.player.dispatchEvent(new o("media-loop-request"))}ei(t){this.jg.p("suspend",{trigger:t})}ii(t){this.jg.p("rate-change",{detail:this.j.playbackRate,trigger:t})}Wb(t){const i=this.j.error;i&&this.jg.p("error",{detail:{message:i.message,code:i.code,mediaError:i},trigger:t})}}class F{constructor(t,i){this.q=t,this.ph=i,this.ri.onaddtrack=this.ti.bind(this),this.ri.onremovetrack=this.ui.bind(this),this.ri.onchange=this.vi.bind(this),c(this.ph.audioTracks,"change",this.wi.bind(this))}get ri(){return this.q.media.audioTracks}ti(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.ph.audioTracks[j](s,t),i.enabled&&(s.selected=!0)}ui(t){const i=this.ph.audioTracks.getById(t.track.id);i&&this.ph.audioTracks[U](i,t)}vi(t){let i=this.si();if(!i)return;const s=this.ph.audioTracks.getById(i.id);s&&this.ph.audioTracks[f](s,!0,t)}si(){return Array.from(this.ri).find(t=>t.enabled)}wi(t){const{current:i}=t.detail;if(!i)return;const s=this.ri.getTrackById(i.id);if(s){const a=this.si();a&&(a.enabled=!1),s.enabled=!0}}}class Y{constructor(t){this.j=t}setup(t){new B(this,t),"audioTracks"in this.media&&new F(this,t)}get type(){return""}get media(){return this.j}get paused(){return this.j.paused}get muted(){return this.j.muted}set muted(t){this.j.muted=t}get volume(){return this.j.volume}set volume(t){this.j.volume=t}get currentTime(){return this.j.currentTime}set currentTime(t){this.j.currentTime=t}get playsinline(){return this.j.hasAttribute("playsinline")}set playsinline(t){x(this.j,"playsinline",t)}get playbackRate(){return this.j.playbackRate}set playbackRate(t){this.j.playbackRate=t}play(){return g(this,null,function*(){return this.j.play()})}pause(){return g(this,null,function*(){return this.j.pause()})}loadSource(s,a){return g(this,arguments,function*({src:t},i){this.j.preload=i,H(t)?this.j.srcObject=t:(this.j.srcObject=null,this.j.src=V(t)?t:window.URL.createObjectURL(t)),this.j.load()})}}export{Y as H,X as a};
//# sourceMappingURL=provider-2S-Iw40p.js.map
