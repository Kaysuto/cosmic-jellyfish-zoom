{"version":3,"file":"FullSectionPage-6Rfi0bo3.js","sources":["../../src/pages/FullSectionPage.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useParams, Link, useNavigate, useLocation } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { supabase } from '@/integrations/supabase/client';\nimport { showError } from '@/utils/toast';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Button } from '@/components/ui/button';\nimport { ArrowLeft, ChevronLeft, ChevronRight, ChevronsUpDown } from 'lucide-react';\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';\nimport MediaGrid, { MediaItem } from '@/components/catalog/MediaGrid';\nimport RequestModal from '@/components/catalog/RequestModal';\nimport { useSession } from '@/contexts/AuthContext';\nimport { useJellyfin } from '@/contexts/JellyfinContext';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\n\ntype CatalogSection = 'animations' | 'animes' | 'films' | 'series';\n\nconst FullSectionPage = () => {\n  const { section } = useParams<{ section: CatalogSection }>();\n  const { t, i18n } = useTranslation();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { session } = useSession();\n  const { error: jellyfinError } = useJellyfin();\n  const [media, setMedia] = useState<MediaItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [page, setPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [sortBy, setSortBy] = useState('popularity.desc');\n  const [availableOnly, setAvailableOnly] = useState(false);\n  const [requestModalOpen, setRequestModalOpen] = useState(false);\n  const [selectedItemForRequest, setSelectedItemForRequest] = useState<MediaItem | null>(null);\n\n  const sortOptions = {\n    'popularity.desc': t('sort_popularity_desc'),\n    'vote_average.desc': t('sort_vote_average_desc'),\n    'release_date.desc': t('sort_release_date_desc'),\n  };\n\n  const fetchMedia = useCallback(async () => {\n    if (!section) return;\n    \n    setLoading(true);\n    try {\n      const { data, error } = await supabase.functions.invoke('discover-media', {\n        body: { section, language: i18n.language, page, sortBy, availableOnly },\n      });\n      if (error) throw error;\n      \n      const tmdbItems = data.results;\n      let items = tmdbItems;\n\n      if (!availableOnly && tmdbItems.length > 0) {\n        const tmdbIds = tmdbItems.map((item: MediaItem) => item.id);\n        const { data: catalogData, error: catalogError } = await supabase\n          .from('catalog_items')\n          .select('tmdb_id')\n          .in('tmdb_id', tmdbIds);\n        \n        if (!catalogError) {\n          const availableIds = new Set(catalogData.map(item => item.tmdb_id));\n          items = tmdbItems.map((item: MediaItem) => ({\n            ...item,\n            isAvailable: availableIds.has(item.id),\n          }));\n        }\n      } else if (availableOnly) {\n        items = tmdbItems.map((item: MediaItem) => ({\n          ...item,\n          isAvailable: true,\n        }));\n      }\n\n      setMedia(items);\n      setTotalPages(Math.min(data.total_pages ?? 1, 500));\n    } catch (error: any) {\n      showError(error.message);\n    } finally {\n      setLoading(false);\n    }\n  }, [section, i18n.language, page, sortBy, availableOnly]);\n\n  useEffect(() => {\n    window.scrollTo(0, 0);\n    fetchMedia();\n  }, [fetchMedia]);\n\n  const handleSortByChange = (value: string) => {\n    setSortBy(value);\n    setPage(1);\n  };\n\n  const handleAvailableOnlyChange = (checked: boolean) => {\n    setAvailableOnly(checked);\n    setPage(1);\n  };\n\n  const openRequestModal = (item: MediaItem) => {\n    setSelectedItemForRequest(item);\n    setRequestModalOpen(true);\n  };\n\n  const pageTitle = useMemo(() => {\n    switch (section) {\n      case 'animations': return t('catalog_section_animations');\n      case 'animes': return t('catalog_section_animes');\n      case 'films': return t('catalog_section_films');\n      case 'series': return t('catalog_section_series');\n      default: return t('catalog');\n    }\n  }, [section, t]);\n\n  const pageDescription = useMemo(() => {\n    switch (section) {\n      case 'animations': return t('catalog_section_animations_desc');\n      case 'animes': return t('catalog_section_animes_desc');\n      case 'films': return t('catalog_section_films_desc');\n      case 'series': return t('catalog_section_series_desc');\n      default: return '';\n    }\n  }, [section, t]);\n\n  const LoadingSkeleton = () => (\n    <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4\">\n      {[...Array(18)].map((_, i) => (\n        <div key={i} className=\"space-y-2\">\n          <Skeleton className=\"aspect-[2/3] w-full rounded-lg\" />\n          <Skeleton className=\"h-4 w-3/4\" />\n          <Skeleton className=\"h-4 w-1/2\" />\n        </div>\n      ))}\n    </div>\n  );\n\n  if (!section) {\n    return <div className=\"container mx-auto px-4 py-8 text-center\">{t('invalid_section')}</div>;\n  }\n\n  if (jellyfinError) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <Button asChild variant=\"outline\" className=\"mb-6\">\n          <Link to=\"/catalog\">\n            <ArrowLeft className=\"mr-2 h-4 w-4\" /> {t('back_to_catalog')}\n          </Link>\n        </Button>\n        <div className=\"text-red-500 p-4 rounded-lg bg-red-500/10 border border-red-500/20\">\n          <p>Erreur de configuration Jellyfin : {jellyfinError}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <Button asChild variant=\"outline\" className=\"mb-4\">\n            <Link to=\"/catalog\">\n              <ArrowLeft className=\"mr-2 h-4 w-4\" /> {t('back_to_catalog')}\n            </Link>\n          </Button>\n          <h1 className=\"text-4xl font-bold tracking-tight mb-2\">{pageTitle}</h1>\n          <p className=\"text-muted-foreground\">{pageDescription}</p>\n        </div>\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 mb-6\">\n        <DropdownMenu modal={false}>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"outline\" className=\"w-full sm:w-[200px] justify-between\">\n              {sortOptions[sortBy as keyof typeof sortOptions]}\n              <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent className=\"w-[200px]\">\n            {Object.entries(sortOptions).map(([value, label]) => (\n              <DropdownMenuItem key={value} onSelect={() => handleSortByChange(value)}>\n                {label}\n              </DropdownMenuItem>\n            ))}\n          </DropdownMenuContent>\n        </DropdownMenu>\n        <div className=\"flex items-center space-x-2\">\n          <Switch\n            id=\"available-only\"\n            checked={availableOnly}\n            onCheckedChange={handleAvailableOnlyChange}\n          />\n          <Label htmlFor=\"available-only\">{t('available_in_catalog')}</Label>\n        </div>\n      </div>\n\n      {loading ? (\n        <LoadingSkeleton />\n      ) : (\n        <>\n          <MediaGrid items={media} showRequestButton={!!session} onRequest={openRequestModal} />\n          \n          {totalPages > 1 && (\n            <div className=\"flex items-center justify-center gap-4 mt-8\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setPage(p => Math.max(1, p - 1))}\n                disabled={page === 1}\n              >\n                <ChevronLeft className=\"mr-2 h-4 w-4\" />\n                {t('previous')}\n              </Button>\n              <span className=\"text-sm text-muted-foreground\">\n                {t('page')} {page} / {totalPages}\n              </span>\n              <Button\n                variant=\"outline\"\n                onClick={() => setPage(p => Math.min(totalPages, p + 1))}\n                disabled={page === totalPages}\n              >\n                {t('next')}\n                <ChevronRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </div>\n          )}\n        </>\n      )}\n\n      <RequestModal \n        open={requestModalOpen} \n        onOpenChange={setRequestModalOpen} \n        item={selectedItemForRequest} \n      />\n    </div>\n  );\n};\n\nexport default FullSectionPage;"],"names":["FullSectionPage","section","useParams","t","i18n","useTranslation","useNavigate","useLocation","session","useSession","jellyfinError","useJellyfin","media","setMedia","useState","loading","setLoading","page","setPage","totalPages","setTotalPages","sortBy","setSortBy","availableOnly","setAvailableOnly","requestModalOpen","setRequestModalOpen","selectedItemForRequest","setSelectedItemForRequest","sortOptions","fetchMedia","useCallback","__async","data","error","supabase","tmdbItems","items","tmdbIds","item","catalogData","catalogError","availableIds","__spreadProps","__spreadValues","_a","showError","useEffect","handleSortByChange","value","handleAvailableOnlyChange","checked","openRequestModal","pageTitle","useMemo","pageDescription","LoadingSkeleton","jsx","_","i","jsxs","Skeleton","Button","Link","ArrowLeft","DropdownMenu","DropdownMenuTrigger","ChevronsUpDown","DropdownMenuContent","label","DropdownMenuItem","Switch","Label","Fragment","MediaGrid","p","ChevronLeft","ChevronRight","RequestModal"],"mappings":"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"}