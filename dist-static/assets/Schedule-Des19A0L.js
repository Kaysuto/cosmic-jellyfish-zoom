var le=Object.defineProperty,de=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var B=(e,a,t)=>a in e?le(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,$=(e,a)=>{for(var t in a||(a={}))he.call(a,t)&&B(e,t,a[t]);if(P)for(var t of P(a))me.call(a,t)&&B(e,t,a[t]);return e},E=(e,a)=>de(e,ue(a));var F=(e,a,t)=>new Promise((n,r)=>{var l=o=>{try{d(t.next(o))}catch(c){r(c)}},i=o=>{try{d(t.throw(o))}catch(c){r(c)}},d=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,i);d((t=t.apply(e,a)).next())});import{j as s}from"./ui-DslYdUPK.js";import{L as xe,r as j}from"./router-42GXI50n.js";import{c as pe,aw as S,ax as A,ay as fe,az as ye,u as Z,C as I,x as q,ah as ge,T as je,q as we,r as be,b as ve,v as Ne,w as De,s as Se,d as ke,p as _e,B as O,t as Ce,S as U,e as Y,M as Me,O as Te}from"./index-Cw6WSGfP.js";import{T as Oe,a as Ae,b as G}from"./tabs-SYysrnpz.js";import{H as $e}from"./hourglass-d_tFP0Ab.js";import{R as Ee,a as Ie,b as Re}from"./index-B-QAuG6e.js";import{s as K,a as V,f}from"./format-ulCIpsJ0.js";import{C as Le}from"./chevron-left-BG9g9Eau.js";import{C as We}from"./chevron-up-3WKbjQ45.js";import{a as He,s as Je}from"./subDays-CB2Qx0DK.js";import"./vendor-aQ18W7Az.js";import"./streaming-fF1zHaJi.js";import"./utils-D-N2hrcs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=pe("CalendarOff",[["path",{d:"M4.2 4.2A2 2 0 0 0 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 1.82-1.18",key:"16swn3"}],["path",{d:"M21 15.5V6a2 2 0 0 0-2-2H9.5",key:"yhw86o"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h7",key:"1wap6i"}],["path",{d:"M21 10h-5.5",key:"quycpq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);function ee(e,a){const t=S(e);if(isNaN(a))return A(e,NaN);if(!a)return t;const n=t.getDate(),r=A(e,t.getTime());r.setMonth(t.getMonth()+a+1,0);const l=r.getDate();return n>=l?r:(t.setFullYear(r.getFullYear(),r.getMonth(),n),t)}function Pe(e,a){const{years:t=0,months:n=0,weeks:r=0,days:l=0,hours:i=0,minutes:d=0,seconds:o=0}=a,c=S(e),u=n||t?ee(c,n+t*12):c,y=l||r?He(u,l+r*7):u,w=d+i*60,v=(o+w*60)*1e3;return A(e,y.getTime()+v)}function Be(e,a){const t=K(e),n=K(a);return+t==+n}function Fe(e,a){const t=S(e.start),n=S(e.end);let r=+t>+n;const l=r?+t:+n,i=r?n:t;i.setHours(0,0,0,0);let d=1;const o=[];for(;+i<=l;)o.push(S(i)),i.setDate(i.getDate()+d),i.setHours(0,0,0,0);return r?o.reverse():o}function Q(e,a){var d,o,c,u,y,w,b,v;const t=fe(),n=(v=(b=(u=(c=a==null?void 0:a.weekStartsOn)!=null?c:(o=(d=a==null?void 0:a.locale)==null?void 0:d.options)==null?void 0:o.weekStartsOn)!=null?u:t.weekStartsOn)!=null?b:(w=(y=t.locale)==null?void 0:y.options)==null?void 0:w.weekStartsOn)!=null?v:0,r=S(e),l=r.getDay(),i=(l<n?-7:0)+6-(l-n);return r.setDate(r.getDate()+i),r.setHours(23,59,59,999),r}function qe(e){return Be(e,ye(e))}function Ue(e,a){return ee(e,-a)}function Ye(e,a){const{years:t=0,months:n=0,weeks:r=0,days:l=0,hours:i=0,minutes:d=0,seconds:o=0}=a,c=Ue(e,n+t*12),u=Je(c,l+r*7),y=d+i*60,b=(o+y*60)*1e3;return A(e,u.getTime()-b)}const X=({item:e,currentMediaType:a})=>{const{t}=Z();let n=e.title||e.name;e.seasonNumber!==void 0&&e.episodeNumber!==void 0&&n&&(n=`${n} • S${String(e.seasonNumber).padStart(2,"0")}E${String(e.episodeNumber).padStart(2,"0")}`);const r=(()=>{const i=e.genre_ids||e.genres||[],d=Array.isArray(i)?i.some(u=>typeof u=="number"&&u===16||typeof u=="object"&&(u==null?void 0:u.id)===16):!1,o=e.origin_country||e.origin_countries||[],c=Array.isArray(o)?o.includes("JP"):!1;return e.media_type==="anime"||d||c})(),l=a==="tv"&&r;return s.jsx(xe,{to:`/media/${e.media_type}/${e.id}`,className:"block group",children:s.jsx(I,{className:`overflow-hidden transition-all duration-300 hover:shadow-md hover:border-primary/50 p-2 ${l?"ring-2 ring-pink-400/60":""}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[e.poster_path?s.jsx("img",{src:`https://image.tmdb.org/t/p/w200${e.poster_path}`,alt:n,className:"w-12 h-[72px] object-cover rounded-md flex-shrink-0",loading:"lazy"}):s.jsx("div",{className:"w-12 h-[72px] bg-muted rounded-md flex-shrink-0"}),s.jsxs("div",{className:"flex-grow min-w-0",children:[s.jsx("h4",{className:"font-semibold text-sm line-clamp-2 group-hover:text-primary",children:n}),s.jsx("div",{className:"flex flex-wrap items-center justify-between gap-x-2 gap-y-1 mt-1 text-xs text-muted-foreground",children:e.isAvailable?s.jsxs(q,{variant:"secondary",className:"bg-green-500/20 text-green-400 border-none px-2 py-0.5",children:[s.jsx(ge,{className:"h-3 w-3 mr-1"}),t("available")]}):e.isSoon?s.jsxs(je,{children:[s.jsx(we,{children:s.jsxs(q,{variant:"secondary",className:"bg-yellow-500/20 text-yellow-400 border-none px-2 py-0.5",children:[s.jsx($e,{className:"h-3 w-3 mr-1"}),t("soon")]})}),s.jsx(be,{children:s.jsx("p",{children:t("soon_available")})})]}):null})]})]})})})},Ge=Ee,Ke=Re,Ve=Ie,hs=()=>{const{t:e,i18n:a}=Z(),{error:t}=ve(),[n,r]=j.useState(new Date),[l,i]=j.useState({}),[d,o]=j.useState(!0),[c,u]=j.useState("tv"),[y,w]=j.useState({}),[b,v]=j.useState({}),M=a.language==="fr"?Ne:De,R=3,se=300*1e3,L=j.useCallback(()=>F(null,null,function*(){o(!0);const m=V(n,{weekStartsOn:1}),p=Q(n,{weekStartsOn:1}),D=`${c}-${f(m,"yyyy-MM-dd")}-${f(p,"yyyy-MM-dd")}-${a.language}`,g=b[D];if(g&&Date.now()-g.timestamp<se){i(g.data),o(!1);return}try{const{data:N,error:k}=yield Se.functions.invoke("get-airing-schedule",{body:{mediaType:c,language:a.language,startDate:f(m,"yyyy-MM-dd"),endDate:f(p,"yyyy-MM-dd")}});if(k)throw k;const _=N,x=h=>{const C=(h.genre_ids||[]).includes(16),ie=(h.origin_country||[]).includes("JP");return h.media_type==="anime"||C||ie},z=_.filter(h=>c==="anime"?x(h):c==="tv"?h.media_type==="tv"&&!x(h):!1).reduce((h,T)=>{const C=T.first_air_date?f(new Date(T.first_air_date),"yyyy-MM-dd"):"";return h[C]||(h[C]=[]),h[C].push(T),h},{});v(h=>E($({},h),{[D]:{data:z,timestamp:Date.now()}})),i(z)}catch(N){ke(N.message)}finally{o(!1)}}),[n,c,a.language]);j.useEffect(()=>{L()},[L]);const W=V(n,{weekStartsOn:1}),H=Q(n,{weekStartsOn:1}),te=Fe({start:W,end:H}),ae=Object.values(l).reduce((m,p)=>m+p.length,0),ne=Object.values(l).filter(m=>m.length>0).length,re=()=>r(Ye(n,{weeks:1})),oe=()=>r(Pe(n,{weeks:1})),ce=()=>r(new Date);return t?s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx(I,{children:s.jsx(_e,{className:"py-8 text-center",children:s.jsxs("div",{className:"text-red-500 mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Erreur de configuration"}),s.jsxs("p",{children:["Impossible de charger les paramètres Jellyfin : ",t]})]})})})}):s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsx("h1",{className:"text-4xl font-bold tracking-tight mb-6",children:e("schedule")}),s.jsx(I,{className:"mb-8 p-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(O,{variant:"outline",size:"icon",onClick:re,"aria-label":"Semaine précédente",children:s.jsx(Le,{className:"h-4 w-4"})}),s.jsx(O,{variant:"outline",size:"icon",onClick:oe,"aria-label":"Semaine suivante",children:s.jsx(Ce,{className:"h-4 w-4"})}),s.jsx(O,{variant:"default",onClick:ce,children:e("today")})]}),s.jsxs("div",{className:"flex flex-col items-center gap-1",children:[s.jsxs("h2",{className:"text-xl font-semibold text-center",children:[f(W,"d MMM",{locale:M})," - ",f(H,"d MMM yyyy",{locale:M})]}),s.jsxs("span",{className:"text-xs text-muted-foreground",children:[e("releases_this_week",{count:ae})," • ",e("days_with_releases",{count:ne})]})]}),s.jsx(Oe,{value:c,onValueChange:m=>u(m),className:"w-full sm:w-auto",children:s.jsxs(Ae,{className:"grid w-full grid-cols-2",children:[s.jsx(G,{value:"tv",children:e("tv_shows")}),s.jsx(G,{value:"anime",children:e("animes")})]})})]})}),d?s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-7 gap-4",children:[...Array(7)].map((m,p)=>s.jsxs("div",{className:"space-y-3",children:[s.jsx(U,{className:"h-8 w-32"}),[...Array(3)].map((D,g)=>s.jsx(U,{className:"h-[88px] w-full"},g))]},p))}):s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-7 gap-2",children:te.map(m=>{const p=f(m,"yyyy-MM-dd"),D=l[p]||[],g=D.slice(0,R),N=D.slice(R),k=qe(m),_=y[p]||!1;return s.jsxs("div",{className:Y("rounded-lg p-3 transition-colors",k&&"bg-primary/10"),children:[s.jsxs("h3",{className:Y("text-lg font-bold mb-4 capitalize flex items-center gap-2",k&&"text-primary"),children:[s.jsx(Me,{className:"h-5 w-5"}),f(m,"EEEE d",{locale:M})]}),s.jsxs("div",{className:"space-y-2",children:[g.length>0?g.map(x=>s.jsx(X,{item:x,currentMediaType:c},`${x.id}-${x.first_air_date}`)):s.jsxs("div",{className:"h-24 flex flex-col items-center justify-center text-center text-muted-foreground bg-muted/30 rounded-md p-2",children:[s.jsx(ze,{className:"h-6 w-6 mb-2"}),s.jsx("p",{className:"text-xs",children:e("no_releases_on_this_day")})]}),N.length>0&&s.jsxs(Ge,{open:_,onOpenChange:x=>w(J=>E($({},J),{[p]:x})),children:[s.jsx(Ve,{className:"space-y-2 animate-in fade-in-0",children:N.map(x=>s.jsx(X,{item:x,currentMediaType:c},`${x.id}-${x.first_air_date}`))}),s.jsx(Ke,{asChild:!0,children:s.jsxs(O,{variant:"ghost",className:"w-full mt-2",children:[_?s.jsx(We,{className:"h-4 w-4 mr-2"}):s.jsx(Te,{className:"h-4 w-4 mr-2"}),_?e("view_less"):e("view_more",{count:N.length})]})})]})]})]},p)})})]})};export{hs as default};
//# sourceMappingURL=Schedule-Des19A0L.js.map
