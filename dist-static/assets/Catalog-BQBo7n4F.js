var me=Object.defineProperty,pe=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var te=(s,i,o)=>i in s?me(s,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[i]=o,B=(s,i)=>{for(var o in i||(i={}))fe.call(i,o)&&te(s,o,i[o]);if(ae)for(var o of ae(i))xe.call(i,o)&&te(s,o,i[o]);return s},H=(s,i)=>pe(s,he(i));var M=(s,i,o)=>new Promise((x,h)=>{var p=n=>{try{c(o.next(n))}catch(v){h(v)}},d=n=>{try{c(o.throw(n))}catch(v){h(v)}},c=n=>n.done?x(n.value):Promise.resolve(n.value).then(p,d);c((o=o.apply(s,i)).next())});import{j as e}from"./ui-DslYdUPK.js";import{r as u,u as ge,L as z}from"./router-42GXI50n.js";import{a as W,s as F,u as q,b as O,m as U,C as oe,F as be,x as re,ah as ye,a1 as V,e as J,ai as ve,B as T,S as R,d as le,p as je}from"./index-Cw6WSGfP.js";import{M as _e}from"./MediaGrid-D_gViZ45.js";import{I as we}from"./input-B7M3MPRI.js";import{C as G,a as X,b as Y,c as K,d as Q}from"./carousel-CxRrSFIV.js";import{a as ne,S as Ne,B as ke,M as ce}from"./RequestModal-Dh-rgp6A.js";import{H as Se}from"./hourglass-d_tFP0Ab.js";import{P as Ce}from"./plus-BCI7Qmoy.js";import{D as Ie,a as $e,b as Ee,c as Le,d as Me,e as Re,f as Te}from"./dialog-DtG0Tqk0.js";import{A as Z}from"./arrow-right-BBRhRddY.js";import{S as ie}from"./search-DTGOIQkO.js";import{L as De}from"./loader-circle-BQi2R5hk.js";import"./vendor-aQ18W7Az.js";import"./streaming-fF1zHaJi.js";import"./utils-D-N2hrcs.js";import"./arrow-left-Db81hexG.js";import"./textarea-BGhclJcN.js";function Fe(s,i){const[o,x]=u.useState(s);return u.useEffect(()=>{const h=setTimeout(()=>{x(s)},i);return()=>{clearTimeout(h)}},[s,i]),o}const de=()=>{const{session:s}=W(),[i,o]=u.useState([]),[x,h]=u.useState(!0),p=u.useCallback(()=>M(null,null,function*(){if(!(s!=null&&s.user)){h(!1),o([]);return}h(!0);const{data:d,error:c}=yield F.rpc("get_continue_watching",{p_user_id:s.user.id});c?(console.error("Error fetching continue watching items:",c),o([])):o(d),h(!1)}),[s]);return u.useEffect(()=>{p();const d=()=>p(),c=n=>{try{p()}catch(v){console.error("Error handling playback-progress-saved in useContinueWatching:",v)}};return window.addEventListener("playback-ended",d),window.addEventListener("playback-progress-saved",c),()=>{window.removeEventListener("playback-ended",d),window.removeEventListener("playback-progress-saved",c)}},[p]),{items:i,loading:x,refresh:p}},Pe=({item:s,showRequestButton:i=!0,onRequest:o,searchTerm:x,progress:h,playUrl:p,playbackPositionTicks:d,showRemoveButton:c,onRemove:n,onPlayClick:v})=>{var ee;const{t:m}=q(),{jellyfinUrl:r}=O(),{session:a}=W(),{addToList:j,removeFromList:w,isInList:N}=ne("favorite"),{addToList:k,removeFromList:S,isInList:_}=ne("watchlist"),C=s.title||s.name||"No title",$=s.release_date||s.first_air_date,y=$?new Date($).getFullYear():"",g=(ee=s.vote_average)!=null?ee:null,t=s.isAvailable,l=s.media_type==="anime"?"tv":s.media_type;let b=p;if(!b){const f=`/media/${l}/${s.id}`,E=new URLSearchParams;x&&E.append("fromSearch",x);const D=s.playback_position_ticks||d;if(D&&D>0){const ue=Math.floor(D/1e7);E.append("t",ue.toString())}(s.media_type==="tv"||s.media_type==="anime")&&s.season_number&&s.episode_number&&(E.append("season",s.season_number.toString()),E.append("episode",s.episode_number.toString()));const se=E.toString();b=se?`${f}/play?${se}`:f}const L=(f=>f?f.startsWith("/")?`https://image.tmdb.org/t/p/w500${f}`:r&&f.startsWith("Items/")?`${r}/${f}`:f:null)(s.poster_path);let P="";if(s.playback_position_ticks&&s.playback_position_ticks>0){const f=Math.floor(s.playback_position_ticks/1e7),E=Math.floor(f/60),D=f%60;P=`${E}m ${D}s`}const A={initial:{opacity:0,y:20},animate:{opacity:1,y:0},hover:{y:-4,scale:1.01}};return e.jsx(U.div,{variants:A,initial:"initial",animate:"animate",whileHover:"hover",transition:{duration:.3,ease:"easeOut"},className:"group",children:e.jsxs(oe,{className:"relative overflow-hidden rounded-xl bg-card border border-border/50 transition-all duration-300 h-full shadow-sm hover:shadow-md hover:shadow-black/5",children:[e.jsxs("div",{className:"block h-full","aria-label":C,children:[e.jsxs("div",{className:"relative aspect-media bg-muted flex items-center justify-center overflow-hidden",children:[L?e.jsx("img",{src:L,alt:C,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:e.jsx(be,{className:"h-12 w-12"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),h!==void 0&&h>0&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-muted/50",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${h}%`},"aria-hidden":"true"})})]}),e.jsxs("div",{className:"absolute inset-0 p-4 flex flex-col justify-end bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-2 mb-2 text-white transition-colors duration-300",children:C}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-white/90",children:[e.jsx("span",{className:"bg-black/30 backdrop-blur-sm px-2 py-1 rounded-md",children:y}),g!==null&&g>0&&e.jsxs("div",{className:"flex items-center gap-1 bg-black/30 backdrop-blur-sm px-2 py-1 rounded-md",children:[e.jsx(Ne,{className:"h-3 w-3 text-yellow-400 fill-current"}),e.jsx("span",{className:"font-medium",children:g.toFixed(1)})]})]}),a&&(s.playback_position_ticks||d)&&e.jsx("div",{className:"mt-2 inline-block bg-primary/90 backdrop-blur-sm text-xs text-primary-foreground px-2 py-1 rounded-md font-medium",children:m("resume_at",{time:P||(()=>{if(d&&d>0){const f=Math.floor(d/1e7),E=Math.floor(f/60),D=f%60;return`${E}m ${D}s`}return""})()})})]})]}),e.jsxs("div",{className:"absolute top-3 left-3 z-30",children:[t&&e.jsxs(re,{className:"bg-success text-success-foreground border-0 shadow-md hover:bg-success",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),m("available")]}),s.isRequested&&!t&&e.jsxs(re,{className:"bg-warning text-warning-foreground border-0 shadow-md hover:bg-warning",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"}),m("requested")]})]}),e.jsxs("div",{className:"absolute top-3 right-3 z-30 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-all duration-300",children:[c&&n&&e.jsx(U.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:f=>{f.preventDefault(),f.stopPropagation(),n(s)},"aria-label":`Retirer ${C} de la liste`,className:"h-8 w-8 rounded-full bg-destructive/90 backdrop-blur-sm text-destructive-foreground flex items-center justify-center transition-all duration-200 hover:bg-destructive shadow-md",children:e.jsx(V,{className:"h-4 w-4"})}),i&&!t&&!s.isRequested&&e.jsx(U.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:f=>{f.preventDefault(),f.stopPropagation(),o&&o(s)},"aria-label":`${m("request")} ${C}`,className:"h-8 w-8 rounded-full bg-primary/90 backdrop-blur-sm text-primary-foreground flex items-center justify-center transition-all duration-200 hover:bg-primary shadow-md",children:e.jsx(Ce,{className:"h-4 w-4"})}),a&&e.jsxs(e.Fragment,{children:[e.jsx(U.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:f=>{f.preventDefault(),f.stopPropagation(),N(s.id,s.media_type)?w(s.id,s.media_type):j(s.id,s.media_type)},"aria-label":N(s.id,s.media_type)?m("remove_from_favorites"):m("add_to_favorites"),className:J("h-8 w-8 rounded-full backdrop-blur-sm flex items-center justify-center transition-all duration-200 shadow-md",N(s.id,s.media_type)?"bg-destructive/90 text-destructive-foreground hover:bg-destructive":"bg-background/90 text-foreground hover:bg-background"),children:e.jsx(ve,{className:J("h-4 w-4 transition-all duration-200",N(s.id,s.media_type)&&"fill-current")})}),e.jsx(U.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:f=>{f.preventDefault(),f.stopPropagation(),_(s.id,s.media_type)?S(s.id,s.media_type):k(s.id,s.media_type)},"aria-label":_(s.id,s.media_type)?m("remove_from_watchlist"):m("add_to_watchlist"),className:J("h-8 w-8 rounded-full backdrop-blur-sm flex items-center justify-center transition-all duration-200 shadow-md",_(s.id,s.media_type)?"bg-primary/90 text-primary-foreground hover:bg-primary":"bg-background/90 text-foreground hover:bg-background"),children:e.jsx(ke,{className:J("h-4 w-4 transition-all duration-200",_(s.id,s.media_type)&&"fill-current")})})]})]})]})})},Ae=({open:s,onOpenChange:i,item:o,onResume:x,onRestart:h,onViewDetails:p})=>{const{t:d}=q();if(!o)return null;const c=Math.floor(o.playback_position_ticks/1e7),n=Math.floor(c/60),v=c%60,m=`${n}m ${v}s`,r=o.title||o.name;return e.jsx(Ie,{open:s,onOpenChange:i,children:e.jsxs($e,{children:[e.jsxs(Ee,{children:[e.jsx(Le,{children:r}),e.jsx(Me,{children:d("resume_or_restart_description")})]}),e.jsxs(Re,{className:"sm:justify-center gap-2",children:[e.jsx(T,{variant:"secondary",onClick:p,children:d("view_details")}),e.jsx(T,{variant:"outline",onClick:h,children:d("restart_playback")}),e.jsx(T,{onClick:x,children:d("resume_at",{time:m})})]}),e.jsx(Te,{asChild:!0,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:e.jsxs(T,{variant:"ghost",size:"icon",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})})]})})},We=()=>{const{t:s}=q(),{session:i}=W(),{items:o,loading:x}=de(),{error:h}=O(),p=ge(),[d,c]=u.useState(!1),[n,v]=u.useState(null),[m,r]=u.useState(null),[a,j]=u.useState(null);u.useEffect(()=>{const t=localStorage.getItem("lastWatchedMediaId");if(t){const l=Number(t);Number.isFinite(l)&&j(l)}},[]),u.useEffect(()=>{const t=l=>{var I;const b=Number((I=l==null?void 0:l.detail)==null?void 0:I.tmdbId);Number.isFinite(b)&&(r(b),j(b),localStorage.setItem("lastWatchedMediaId",b.toString()))};return window.addEventListener("playback-progress-saved",t),()=>window.removeEventListener("playback-progress-saved",t)},[]);const w=(t,l)=>{t.preventDefault(),t.stopPropagation(),v(l),c(!0)},N=(t,l)=>{if(t.preventDefault(),t.stopPropagation(),!l.id||!l.media_type){console.error("Attempted to resume playback for an item missing id or media_type",l);return}const b=l.playback_position_ticks/1e7;let I=`/media/${l.media_type}/${l.id}/play?t=${b}`;(l.media_type==="tv"||l.media_type==="anime")&&l.season_number&&l.episode_number&&(I+=`&season=${l.season_number}&episode=${l.episode_number}`),p(I)},k=()=>{if(!n)return;if(!n.id||!n.media_type){console.error("Attempted to resume playback for an item missing id or media_type",n),c(!1);return}const t=n.playback_position_ticks/1e7;let l=`/media/${n.media_type}/${n.id}/play?t=${t}`;(n.media_type==="tv"||n.media_type==="anime")&&n.season_number&&n.episode_number&&(l+=`&season=${n.season_number}&episode=${n.episode_number}`),p(l),c(!1)},S=()=>{if(n){if(!n.id||!n.media_type){console.error("Attempted to restart playback for an item missing id or media_type",n),c(!1);return}p(`/media/${n.media_type}/${n.id}/play`),c(!1)}},_=()=>{if(n){if(!n.id||!n.media_type){console.error("Attempted to view details for an item missing id or media_type",n),c(!1);return}p(`/media/${n.media_type}/${n.id}`),c(!1)}},C=t=>M(null,null,function*(){if(!(!(i!=null&&i.user)||!t.id||!t.media_type))try{const{error:l}=yield F.from("playback_progress").delete().eq("user_id",i.user.id).eq("tmdb_id",t.id).eq("media_type",t.media_type);if(l){console.error("Error removing from continue watching:",l);return}window.dispatchEvent(new CustomEvent("playback-progress-saved",{detail:{tmdbId:t.id,mediaType:t.media_type}}))}catch(l){console.error("Error removing from continue watching:",l)}}),$=t=>{const l=g.find(b=>b.id===t.id&&b.media_type===t.media_type);l&&C(l)},y=u.useMemo(()=>Array.isArray(o)?o.filter(t=>t&&t.id&&t.media_type):[],[o]),g=u.useMemo(()=>{const t=b=>{const I=Number(b.runtime_ticks||0),L=Number(b.playback_position_ticks||0);return I>0?Math.max(0,Math.min(1,L/I)):Math.max(0,Math.min(1,Number(b.progress||0)/100))};return[...y].sort((b,I)=>{if(m&&b.id===m&&I.id!==m)return-1;if(m&&I.id===m&&b.id!==m)return 1;if(a&&b.id===a&&I.id!==a)return-1;if(a&&I.id===a&&b.id!==a)return 1;const L=t(b),P=t(I),A=.05;return L<A&&P>=A?1:P<A&&L>=A?-1:P-L})},[y,m,a]);return!i||!x&&g.length===0?null:h?e.jsxs("section",{className:"mb-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s("continue_watching")}),e.jsx("div",{className:"text-red-500 p-4 rounded-lg bg-red-500/10 border border-red-500/20",children:e.jsxs("p",{children:["Erreur de configuration Jellyfin : ",h]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"mb-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s("continue_watching")}),e.jsx(T,{asChild:!0,variant:"link",children:e.jsxs(z,{to:"/catalog",children:[s("view_all")," ",e.jsx(Z,{className:"ml-2 h-4 w-4"})]})})]}),x?e.jsx("div",{className:"flex space-x-4",children:[...Array(6)].map((t,l)=>e.jsx("div",{className:"w-[16.66%] flex-shrink-0",children:e.jsx(R,{className:"aspect-[2/3] w-full rounded-lg"})},l))}):e.jsxs(G,{opts:{align:"start",dragFree:!0},className:"w-full",children:[e.jsx(X,{className:"-ml-4",children:g.map(t=>e.jsx(Y,{className:"basis-1/2 sm:basis-1/3 md:basis-1/4 lg:basis-1/5 xl:basis-1/6 pl-4",children:e.jsx("div",{onClick:l=>w(l,t),className:"cursor-pointer",children:e.jsx(Pe,{item:H(B({},t),{title:t.media_type!=="movie"&&t.season_number&&t.episode_number?`${t.title||t.name||""} • S${String(t.season_number).padStart(2,"0")} E${String(t.episode_number).padStart(2,"0")}`:t.title||t.name}),showRequestButton:!1,showRemoveButton:!0,onRemove:$,onPlayClick:N,progress:t.progress,playbackPositionTicks:t.playback_position_ticks,runtimeTicks:t.runtime_ticks})})},`${t.media_type}-${t.id}`))}),e.jsx(K,{className:"hidden sm:flex"}),e.jsx(Q,{className:"hidden sm:flex"})]})]}),e.jsx(Ae,{open:d,onOpenChange:c,item:n,onResume:k,onRestart:S,onViewDetails:_})]})},qe=({library:s})=>{const{t:i}=q(),{jellyfinUrl:o,loading:x,error:h}=O(),[p,d]=u.useState([]),[c,n]=u.useState(!0),v=(m,r)=>{const a=m.toLowerCase();return a==="animés"||a==="animes"||a.includes("anime")||a.includes("japon")||a.includes("japanese")||a.includes("manga")||a.includes("animes")||a.includes("japan")||a.includes("corée")||a.includes("korea")||a.includes("chinese")||a.includes("chinois")?"animes":a.includes("animation")||a.includes("anim")||a.includes("cartoon")||a.includes("disney")||a.includes("pixar")||a.includes("dreamworks")?"animations":r==="movies"?"films":"series"};return u.useEffect(()=>{M(null,null,function*(){n(!0);try{const{data:r,error:a}=yield F.functions.invoke("get-jellyfin-library-items",{body:{libraryId:s.id,page:1,limit:15}});if(a)throw a;const j=r.items.map(w=>H(B({},w),{isAvailable:!0}));d(j)}catch(r){le(r.message)}finally{n(!1)}})},[s.id]),h?e.jsxs("section",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"text-2xl font-bold",children:s.name})}),e.jsx("div",{className:"text-red-500 p-4 rounded-lg bg-red-500/10 border border-red-500/20",children:e.jsxs("p",{children:["Erreur de configuration Jellyfin : ",h]})})]}):e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.name}),e.jsx(T,{asChild:!0,variant:"link",children:e.jsxs(z,{to:`/discover/${v(s.name,s.collectionType)}`,state:{libraryName:s.name},children:[i("view_all")," ",e.jsx(Z,{className:"ml-2 h-4 w-4"})]})})]}),c?e.jsx("div",{className:"flex space-x-4",children:[...Array(6)].map((m,r)=>e.jsx("div",{className:"w-full basis-1/2 sm:basis-1/3 md:basis-1/4 lg:basis-1/6",children:e.jsx(R,{className:"aspect-[2/3] w-full"})},r))}):e.jsxs(G,{opts:{align:"start",dragFree:!0},className:"w-full",children:[e.jsx(X,{className:"-ml-4",children:p.map(m=>e.jsx(Y,{className:"basis-1/2 sm:basis-1/3 md:basis-1/4 lg:basis-1/5 xl:basis-1/6 pl-4",children:e.jsx(ce,{item:m,showRequestButton:!1})},m.id))}),e.jsx(K,{className:"hidden sm:flex"}),e.jsx(Q,{className:"hidden sm:flex"})]})]})},Ue=()=>{const{session:s}=W(),[i,o]=u.useState([]),[x,h]=u.useState(!0),p=u.useCallback(()=>M(null,null,function*(){if(!(s!=null&&s.user)){h(!1),o([]);return}h(!0);const{data:d,error:c}=yield F.rpc("get_next_up_episodes",{p_user_id:s.user.id});c?(console.error("Error fetching next up items:",c),o([])):o(d),h(!1)}),[s]);return u.useEffect(()=>{p();const d=()=>p();return window.addEventListener("playback-ended",d),()=>{window.removeEventListener("playback-ended",d)}},[p]),{items:i,loading:x,refresh:p}},Be=()=>{const{t:s}=q(),{session:i}=W(),{items:o,loading:x}=Ue(),{items:h}=de(),[p,d]=u.useState(new Set);u.useEffect(()=>{const r=a=>{var N,k;const j=Number((N=a==null?void 0:a.detail)==null?void 0:N.tmdbId),w=(k=a==null?void 0:a.detail)==null?void 0:k.mediaType;Number.isFinite(j)&&(w!=="tv"&&w!=="anime"||(d(S=>{const _=new Set(S);return _.add(j),_}),setTimeout(()=>{d(S=>{const _=new Set(S);return _.delete(j),_})},12e4)))};return window.addEventListener("playback-progress-saved",r),()=>window.removeEventListener("playback-progress-saved",r)},[]);const c=u.useMemo(()=>new Map((h||[]).map(r=>{const a=Number(r.runtime_ticks||0),j=Number(r.playback_position_ticks||0),w=a>0?Math.max(0,Math.min(1,j/a)):Math.max(0,Math.min(1,Number(r.progress||0)/100));return[r.id,{ratio:w}]})),[h]),n=o.filter(r=>{if(r.media_type!=="tv"&&r.media_type!=="anime")return!1;if(p.has(r.id))return!0;const a=c.get(r.id);return!!a&&a.ratio>=.9}),v=u.useMemo(()=>[...n].sort((r,a)=>{var S,_,C,$;const j=p.has(r.id)?1:0,w=p.has(a.id)?1:0;if(j!==w)return w-j;const N=(_=(S=c.get(r.id))==null?void 0:S.ratio)!=null?_:0;return(($=(C=c.get(a.id))==null?void 0:C.ratio)!=null?$:0)-N}),[n,c,p]),m=r=>M(null,null,function*(){if(!(!(i!=null&&i.user)||!r.id||!r.media_type))try{const{error:a}=yield F.from("playback_progress").delete().eq("user_id",i.user.id).eq("tmdb_id",r.id).eq("media_type",r.media_type);if(a){console.error("Error removing from next up:",a);return}window.dispatchEvent(new CustomEvent("playback-progress-saved",{detail:{tmdbId:r.id,mediaType:r.media_type}}))}catch(a){console.error("Error removing from next up:",a)}});return!i||!x&&v.length===0?null:e.jsxs("section",{className:"mb-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s("next_up")}),e.jsx(T,{asChild:!0,variant:"link",children:e.jsxs(z,{to:"/catalog",children:[s("view_all")," ",e.jsx(Z,{className:"ml-2 h-4 w-4"})]})})]}),x?e.jsx("div",{className:"flex space-x-4",children:[...Array(6)].map((r,a)=>e.jsx("div",{className:"w-[16.66%] flex-shrink-0",children:e.jsx(R,{className:"aspect-[2/3] w-full rounded-lg"})},a))}):e.jsxs(G,{opts:{align:"start",dragFree:!0},className:"w-full",children:[e.jsx(X,{className:"-ml-4",children:v.map(r=>{var C,$,y,g;const a=r.next_episode_to_watch,j=(C=a==null?void 0:a.season_number)!=null?C:a==null?void 0:a.seasonNumber,w=($=a==null?void 0:a.episode_number)!=null?$:a==null?void 0:a.episodeNumber,N=(y=a==null?void 0:a.title)!=null?y:`${r.title} S${j} E${w}`,k=(g=a==null?void 0:a.still_path)!=null?g:r.poster_path,S=H(B({},r),{title:N,poster_path:k}),_=`/media/${r.media_type}/${r.id}/play?season=${j}&episode=${w}`;return e.jsx(Y,{className:"basis-1/2 sm:basis-1/3 md:basis-1/4 lg:basis-1/5 xl:basis-1/6 pl-4",children:e.jsx(ce,{item:S,showRequestButton:!1,showRemoveButton:!0,onRemove:m,progress:0,playUrl:_})},`${r.media_type}-${r.id}`)})}),e.jsx(K,{className:"hidden sm:flex"}),e.jsx(Q,{className:"hidden sm:flex"})]})]})},ls=()=>{const{t:s,i18n:i}=q(),{session:o}=W(),{jellyfinUrl:x,loading:h,error:p}=O(),[d,c]=u.useState(""),[n,v]=u.useState([]),[m,r]=u.useState(!1),[a,j]=u.useState([]),[w,N]=u.useState(!0),k=Fe(d,500),S=u.useCallback(()=>M(null,null,function*(){if(!x){N(!1);return}try{const{data:y,error:g}=yield F.functions.invoke("get-jellyfin-libraries");if(g)throw g;j(y||[])}catch(y){console.error("Error fetching Jellyfin libraries:",y)}finally{N(!1)}}),[x]);u.useEffect(()=>{S()},[S]);const _=u.useCallback(y=>M(null,null,function*(){if(!y.trim()){v([]),r(!1);return}r(!0);try{const{data:g,error:t}=yield F.functions.invoke("search-media",{body:{query:y,language:i.language}});if(t)throw console.error("Supabase function error:",t),t;v(g.results||[])}catch(g){console.error("Search error:",g),le(g.message),v([])}finally{r(!1)}}),[i.language]);u.useEffect(()=>{_(k)},[k,_]);const C=()=>{c(""),v([])},$=()=>e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:[...Array(12)].map((y,g)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"aspect-[2/3] w-full rounded-lg"}),e.jsx(R,{className:"h-4 w-3/4"}),e.jsx(R,{className:"h-4 w-1/2"})]},g))});return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(we,{type:"text",placeholder:s("search_placeholder"),value:d,onChange:y=>c(y.target.value),className:"pl-10"}),d&&e.jsx(T,{variant:"ghost",size:"sm",onClick:C,className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",children:e.jsx(V,{className:"h-4 w-4"})})]}),m&&e.jsx(De,{className:"h-4 w-4 animate-spin"})]}),e.jsx("main",{children:d||k?m?e.jsx($,{}):n.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 text-sm text-muted-foreground",children:s("search_results_for",{term:k,count:n.length})}),e.jsx(_e,{items:n,showRequestButton:!!o,searchTerm:k})]}):e.jsx(oe,{children:e.jsx(je,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("no_results_found")}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s("no_results_for",{term:k})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("search_tips")})]})})}):e.jsxs("div",{className:"space-y-12",children:[e.jsx(We,{}),e.jsx(Be,{}),w?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-8 w-1/4 mb-4"}),e.jsx("div",{className:"flex space-x-4",children:[...Array(6)].map((y,g)=>e.jsx("div",{className:"w-[16.66%] flex-shrink-0",children:e.jsx(R,{className:"aspect-[2/3] w-full rounded-lg"})},g))})]}):a.map(y=>e.jsx(qe,{library:y},y.id))]})})]})};export{ls as default};
//# sourceMappingURL=Catalog-BQBo7n4F.js.map
