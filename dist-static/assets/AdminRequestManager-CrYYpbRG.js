var Be=Object.defineProperty,Le=Object.defineProperties;var He=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var ie=(s,r,a)=>r in s?Be(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,_=(s,r)=>{for(var a in r||(r={}))le.call(r,a)&&ie(s,a,r[a]);if(X)for(var a of X(r))oe.call(r,a)&&ie(s,a,r[a]);return s},y=(s,r)=>Le(s,He(r));var F=(s,r)=>{var a={};for(var i in s)le.call(s,i)&&r.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&X)for(var i of X(s))r.indexOf(i)<0&&oe.call(s,i)&&(a[i]=s[i]);return a};var G=(s,r,a)=>new Promise((i,o)=>{var p=n=>{try{l(a.next(n))}catch(u){o(u)}},m=n=>{try{l(a.throw(n))}catch(u){o(u)}},l=n=>n.done?i(n.value):Promise.resolve(n.value).then(p,m);l((a=a.apply(s,r)).next())});import{j as e,c as $e,a as Fe,P as ae,f as Oe,u as ye,g as ce,K as Ge}from"./ui-DslYdUPK.js";import{r as d,L as Q}from"./router-42GXI50n.js";import{c as Se,e as de,ah as W,u as Ue,v as Ke,w as Ve,s as O,m as me,aj as ue,B as C,ak as Xe,a1 as q,V as he,W as xe,Y as pe,a0 as T,_ as ee,S as Qe,A as We,f as Ye,g as Je,h as Ze,i as qe,j as es,k as ss,l as ts,d as se,D as fe,E as je,G as ge,H as be,x as ve,$ as as,C as rs,n as ns,p as is,al as ls,K as ke}from"./index-Cw6WSGfP.js";import{T as os,a as cs,b as _e,c as B,d as ds,e as L}from"./table-BD6NPv27.js";import{S as ms,a as us,b as hs,c as xs,d as U}from"./select-NjfxA5eB.js";import{u as ps}from"./index-Cco2FRbQ.js";import{A as fs}from"./index-BvRroZ3g.js";import{E as we}from"./ellipsis-pwK6sJe6.js";import{H as Ce}from"./hourglass-d_tFP0Ab.js";import{f as Ne}from"./format-ulCIpsJ0.js";import"./vendor-aQ18W7Az.js";import"./streaming-fF1zHaJi.js";import"./utils-D-N2hrcs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=Se("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=Se("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);var J="Checkbox",[gs,Ts]=$e(J),[bs,re]=gs(J);function vs(s){const{__scopeCheckbox:r,checked:a,children:i,defaultChecked:o,disabled:p,form:m,name:l,onCheckedChange:n,required:u,value:j="on",internal_do_not_use_render:v}=s,[N,k]=Oe({prop:a,defaultProp:o!=null?o:!1,onChange:n,caller:J}),[g,z]=d.useState(null),[E,w]=d.useState(null),b=d.useRef(!1),x=g?!!m||!!g.closest("form"):!0,f={checked:N,disabled:p,setChecked:k,control:g,setControl:z,name:l,form:m,value:j,hasConsumerStoppedPropagationRef:b,required:u,defaultChecked:R(o)?!1:o,isFormControl:x,bubbleInput:E,setBubbleInput:w};return e.jsx(bs,y(_({scope:r},f),{children:ks(v)?v(f):i}))}var Ee="CheckboxTrigger",Me=d.forwardRef((p,o)=>{var m=p,{__scopeCheckbox:s,onKeyDown:r,onClick:a}=m,i=F(m,["__scopeCheckbox","onKeyDown","onClick"]);const{control:l,value:n,disabled:u,checked:j,required:v,setControl:N,setChecked:k,hasConsumerStoppedPropagationRef:g,isFormControl:z,bubbleInput:E}=re(Ee,s),w=ye(o,N),b=d.useRef(j);return d.useEffect(()=>{const x=l==null?void 0:l.form;if(x){const f=()=>k(b.current);return x.addEventListener("reset",f),()=>x.removeEventListener("reset",f)}},[l,k]),e.jsx(ae.button,y(_({type:"button",role:"checkbox","aria-checked":R(j)?"mixed":j,"aria-required":v,"data-state":Ie(j),"data-disabled":u?"":void 0,disabled:u,value:n},i),{ref:w,onKeyDown:ce(r,x=>{x.key==="Enter"&&x.preventDefault()}),onClick:ce(a,x=>{k(f=>R(f)?!0:!f),E&&z&&(g.current=x.isPropagationStopped(),g.current||x.stopPropagation())})}))});Me.displayName=Ee;var ne=d.forwardRef((s,r)=>{const N=s,{__scopeCheckbox:a,name:i,checked:o,defaultChecked:p,required:m,disabled:l,value:n,onCheckedChange:u,form:j}=N,v=F(N,["__scopeCheckbox","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]);return e.jsx(vs,{__scopeCheckbox:a,checked:o,defaultChecked:p,disabled:l,required:m,onCheckedChange:u,name:i,form:j,value:n,internal_do_not_use_render:({isFormControl:k})=>e.jsxs(e.Fragment,{children:[e.jsx(Me,y(_({},v),{ref:r,__scopeCheckbox:a})),k&&e.jsx(Ae,{__scopeCheckbox:a})]})})});ne.displayName=J;var De="CheckboxIndicator",Re=d.forwardRef((s,r)=>{const m=s,{__scopeCheckbox:a,forceMount:i}=m,o=F(m,["__scopeCheckbox","forceMount"]),p=re(De,a);return e.jsx(Fe,{present:i||R(p.checked)||p.checked===!0,children:e.jsx(ae.span,y(_({"data-state":Ie(p.checked),"data-disabled":p.disabled?"":void 0},o),{ref:r,style:_({pointerEvents:"none"},s.style)}))})});Re.displayName=De;var ze="CheckboxBubbleInput",Ae=d.forwardRef((i,a)=>{var o=i,{__scopeCheckbox:s}=o,r=F(o,["__scopeCheckbox"]);const{control:p,hasConsumerStoppedPropagationRef:m,checked:l,defaultChecked:n,required:u,disabled:j,name:v,value:N,form:k,bubbleInput:g,setBubbleInput:z}=re(ze,s),E=ye(a,z),w=ps(l),b=Ge(p);d.useEffect(()=>{const f=g;if(!f)return;const Z=window.HTMLInputElement.prototype,K=Object.getOwnPropertyDescriptor(Z,"checked").set,$=!m.current;if(w!==l&&K){const V=new Event("click",{bubbles:$});f.indeterminate=R(l),K.call(f,R(l)?!1:l),f.dispatchEvent(V)}},[g,w,l,m]);const x=d.useRef(R(l)?!1:l);return e.jsx(ae.input,y(_({type:"checkbox","aria-hidden":!0,defaultChecked:n!=null?n:x.current,required:u,disabled:j,name:v,value:N,form:k},r),{tabIndex:-1,ref:E,style:y(_(_({},r.style),b),{position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"})}))});Ae.displayName=ze;function ks(s){return typeof s=="function"}function R(s){return s==="indeterminate"}function Ie(s){return R(s)?"indeterminate":s?"checked":"unchecked"}const Y=d.forwardRef((i,a)=>{var o=i,{className:s}=o,r=F(o,["className"]);return e.jsx(ne,y(_({ref:a,className:de("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s)},r),{children:e.jsx(Re,{className:de("flex items-center justify-center text-current"),children:e.jsx(W,{className:"h-4 w-4"})})}))});Y.displayName=ne.displayName;const Bs=()=>{const{t:s,i18n:r}=Ue(),[a,i]=d.useState([]),[o,p]=d.useState(!0),[m,l]=d.useState("all"),[n,u]=d.useState(new Set),[j,v]=d.useState("list"),[N,k]=d.useState(!1),[g,z]=d.useState(null),E=r.language==="fr"?Ke:Ve,w=()=>G(null,null,function*(){p(!0);try{let t=O.from("media_requests").select("*");m!=="all"&&(t=t.eq("status",m));const{data:c,error:h}=yield t.order("requested_at",{ascending:!1});if(h)throw h;if(!c||c.length===0){i([]);return}const M=[...new Set(c.map(S=>S.user_id).filter(Boolean))];if(M.length===0){i(c.map(S=>y(_({},S),{profiles:null})));return}const{data:A,error:D}=yield O.from("profiles").select("*").in("id",M);if(D)throw D;const I=new Map(A.map(S=>[S.id,S])),P=c.map(S=>y(_({},S),{profiles:I.get(S.user_id)||null}));i(P)}catch(t){se(s("error_fetching_requests")+": "+t.message),i([])}finally{p(!1)}});d.useEffect(()=>{w();const t=O.channel("media_requests").on("postgres_changes",{event:"*",schema:"public",table:"media_requests"},w).subscribe();return()=>{O.removeChannel(t)}},[m]);const b=(t,c)=>G(null,null,function*(){const{error:h}=yield O.from("media_requests").update({status:c,updated_at:new Date().toISOString()}).in("id",t);h?se(s("error_updating_status")):(ke(s("status_updated_successfully")),w())}),x=t=>G(null,null,function*(){const{error:c}=yield O.from("media_requests").delete().in("id",t);c?se(s("error_deleting_requests")):(ke(s("requests_deleted_successfully")),w(),u(new Set))}),f=t=>{u(c=>{const h=new Set(c);return h.has(t)?h.delete(t):h.add(t),h})},Z=()=>{n.size===a.length?u(new Set):u(new Set(a.map(t=>t.id)))},H=t=>{z(t),k(!0)},K=()=>G(null,null,function*(){if(!g||n.size===0)return;const t=Array.from(n);if(g==="delete")yield x(t);else if(g){const c=g.replace("set_","");yield b(t,c)}k(!1),u(new Set)}),$={pending:{text:s("status_pending"),className:"bg-gray-500/20 text-gray-400 border-gray-500/30"},approved:{text:s("status_approved"),className:"bg-blue-500/20 text-blue-400 border-blue-500/30"},rejected:{text:s("status_rejected"),className:"bg-red-500/20 text-red-400 border-red-500/30"},available:{text:s("status_available"),className:"bg-green-500/20 text-green-400 border-green-500/30"}},V=t=>{var c,h;return(h=(c=t.poster_path)!=null?c:t.media_poster_path)!=null?h:""};d.useEffect(()=>{const t=()=>{window.innerWidth<768?v("grid"):v("list")};return window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)},[]);const Pe=()=>e.jsxs(os,{children:[e.jsx(cs,{children:e.jsxs(_e,{children:[e.jsx(B,{className:"w-12",children:e.jsx(Y,{checked:n.size===a.length&&a.length>0,onCheckedChange:Z})}),e.jsx(B,{className:"w-16",children:s("poster")}),e.jsx(B,{children:s("title")}),e.jsx(B,{children:s("requester")}),e.jsx(B,{children:s("date")}),e.jsx(B,{children:s("status")}),e.jsx(B,{className:"text-right",children:s("actions")})]})}),e.jsx(ds,{children:a.map(t=>{var c,h,M,A,D,I,P;return e.jsxs(_e,{className:n.has(t.id)?"bg-muted/50":"",children:[e.jsx(L,{children:e.jsx(Y,{checked:n.has(t.id),onCheckedChange:()=>f(t.id)})}),e.jsx(L,{children:e.jsx("img",{src:`https://image.tmdb.org/t/p/w92${V(t)}`,alt:"",className:"h-12 w-9 rounded-md object-cover"})}),e.jsx(L,{children:e.jsx(Q,{to:`/media/${t.media_type}/${t.media_tmdb_id}`,className:"font-medium hover:underline",children:t.title})}),e.jsx(L,{children:e.jsxs(Q,{to:`/profile/${t.user_id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsxs(fe,{className:"h-8 w-8",children:[e.jsx(je,{src:((c=t.profiles)==null?void 0:c.avatar_url)||ge((h=t.profiles)==null?void 0:h.email)}),e.jsx(be,{children:((A=(M=t.profiles)==null?void 0:M.first_name)==null?void 0:A[0])||"U"})]}),(D=t.profiles)==null?void 0:D.first_name," ",(I=t.profiles)==null?void 0:I.last_name]})}),e.jsx(L,{children:Ne(new Date(t.requested_at),"d MMM yyyy",{locale:E})}),e.jsx(L,{children:e.jsx(ve,{variant:"outline",className:(P=$[t.status])==null?void 0:P.className,children:$[t.status].text})}),e.jsx(L,{className:"text-right",children:e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"icon",children:e.jsx(we,{className:"h-4 w-4"})})}),e.jsxs(pe,{align:"end",children:[e.jsxs(T,{onClick:()=>b([t.id],"approved"),children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," ",s("status_approved")]}),e.jsxs(T,{onClick:()=>b([t.id],"available"),children:[e.jsx(te,{className:"mr-2 h-4 w-4"})," ",s("status_available")]}),e.jsxs(T,{onClick:()=>b([t.id],"rejected"),children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," ",s("status_rejected")]}),e.jsxs(T,{onClick:()=>b([t.id],"pending"),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"})," ",s("status_pending")]}),e.jsx(as,{}),e.jsxs(T,{className:"text-red-500",onClick:()=>x([t.id]),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"})," ",s("delete")]})]})]})})]},t.id)})})]}),Te=()=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:a.map(t=>{var c,h,M,A,D,I,P;return e.jsxs(rs,{className:`overflow-hidden transition-all ${n.has(t.id)?"border-primary ring-2 ring-primary":""}`,children:[e.jsx(ns,{className:"p-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{checked:n.has(t.id),onCheckedChange:()=>f(t.id),className:"absolute top-2 left-2 z-10 bg-background/50 border-white/50"}),e.jsx("img",{src:`https://image.tmdb.org/t/p/w500${V(t)}`,alt:"",className:"aspect-[2/3] object-cover w-full"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-black/80 to-transparent"}),e.jsx(ve,{variant:"outline",className:`absolute top-2 right-2 ${(c=$[t.status])==null?void 0:c.className}`,children:$[t.status].text}),e.jsx(Q,{to:`/media/${t.media_type}/${t.media_tmdb_id}`,className:"absolute bottom-2 left-3 right-3 font-bold text-white hover:underline text-lg",children:t.title})]})}),e.jsxs(is,{className:"p-3",children:[e.jsxs(Q,{to:`/profile/${t.user_id}`,className:"flex items-center gap-2 hover:underline text-sm",children:[e.jsxs(fe,{className:"h-7 w-7",children:[e.jsx(je,{src:((h=t.profiles)==null?void 0:h.avatar_url)||ge((M=t.profiles)==null?void 0:M.email)}),e.jsx(be,{children:((D=(A=t.profiles)==null?void 0:A.first_name)==null?void 0:D[0])||"U"})]}),(I=t.profiles)==null?void 0:I.first_name," ",(P=t.profiles)==null?void 0:P.last_name]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Ne(new Date(t.requested_at),"d MMM yyyy, HH:mm",{locale:E})})]}),e.jsx(ls,{className:"p-2 bg-muted/30 border-t",children:e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx(C,{title:s("approve"),size:"sm",className:"flex-1",variant:"outline",onClick:()=>b([t.id],"approved"),children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(C,{title:s("reject"),size:"sm",className:"flex-1",variant:"outline",onClick:()=>b([t.id],"rejected"),children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx(C,{title:s("set_available"),size:"sm",className:"flex-1",variant:"outline",onClick:()=>b([t.id],"available"),children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(C,{title:s("delete"),size:"sm",className:"flex-1 text-red-500",variant:"outline",onClick:()=>x([t.id]),children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},t.id)})});return e.jsxs(me.div,{initial:{opacity:0},animate:{opacity:1},className:"p-4 sm:p-6",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(ue,{className:"h-7 w-7"}),s("admin_manage_requests")]}),e.jsx("p",{className:"text-muted-foreground",children:s("my_requests_description")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ms,{value:m,onValueChange:l,children:[e.jsx(us,{className:"w-full sm:w-[160px]",children:e.jsx(hs,{})}),e.jsxs(xs,{children:[e.jsx(U,{value:"all",children:s("all_statuses")}),e.jsx(U,{value:"pending",children:s("status_pending")}),e.jsx(U,{value:"approved",children:s("status_approved")}),e.jsx(U,{value:"rejected",children:s("status_rejected")}),e.jsx(U,{value:"available",children:s("status_available")})]})]}),e.jsxs("div",{className:"hidden md:flex p-1 bg-muted rounded-lg",children:[e.jsx(C,{variant:j==="list"?"secondary":"ghost",size:"sm",onClick:()=>v("list"),children:e.jsx(js,{className:"h-4 w-4"})}),e.jsx(C,{variant:j==="grid"?"secondary":"ghost",size:"sm",onClick:()=>v("grid"),children:e.jsx(Xe,{className:"h-4 w-4"})})]})]})]}),e.jsx(fs,{children:n.size>0&&e.jsxs(me.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-muted/50 border rounded-lg p-3 mb-4 flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:s("items_selected",{count:n.size})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>H("approve"),children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," ",s("approve")]}),e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>H("reject"),children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," ",s("reject")]}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"sm",children:e.jsx(we,{className:"h-4 w-4"})})}),e.jsxs(pe,{align:"end",children:[e.jsxs(T,{onClick:()=>H("set_available"),children:[e.jsx(te,{className:"mr-2 h-4 w-4"})," ",s("status_available")]}),e.jsxs(T,{onClick:()=>H("set_pending"),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"})," ",s("status_pending")]})]})]}),e.jsxs(C,{size:"sm",variant:"destructive",className:"ml-2",onClick:()=>H("delete"),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"})," ",s("delete")]})]})]})}),o?e.jsx(Qe,{className:"h-96 w-full"}):a.length>0?e.jsx("div",{children:j==="list"?Pe():Te()}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx(ue,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold",children:s("no_requests_to_display")}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:s("no_requests_for_status")})]}),e.jsx(We,{open:N,onOpenChange:k,children:e.jsxs(Ye,{children:[e.jsxs(Je,{children:[e.jsx(Ze,{children:s("confirm_action")}),e.jsx(qe,{children:s("confirm_action_on_selected",{count:n.size})})]}),e.jsxs(es,{children:[e.jsx(ss,{children:s("cancel")}),e.jsx(ts,{onClick:K,children:s("confirm")})]})]})})]})};export{Bs as default};
//# sourceMappingURL=AdminRequestManager-CrYYpbRG.js.map
