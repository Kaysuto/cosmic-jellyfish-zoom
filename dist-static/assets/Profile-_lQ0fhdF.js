var ke=Object.defineProperty,De=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var ne=(s,t,a)=>t in s?ke(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,p=(s,t)=>{for(var a in t||(t={}))ce.call(t,a)&&ne(s,a,t[a]);if(V)for(var a of V(t))oe.call(t,a)&&ne(s,a,t[a]);return s},z=(s,t)=>De(s,Me(t));var W=(s,t)=>{var a={};for(var i in s)ce.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&V)for(var i of V(s))t.indexOf(i)<0&&oe.call(s,i)&&(a[i]=s[i]);return a};var y=(s,t,a)=>new Promise((i,r)=>{var l=o=>{try{c(a.next(o))}catch(h){r(h)}},n=o=>{try{c(a.throw(o))}catch(h){r(h)}},c=o=>o.done?i(o.value):Promise.resolve(o.value).then(l,n);c((a=a.apply(s,t)).next())});import{j as e,P as Ae}from"./ui-DslYdUPK.js";import{r as d}from"./router-42GXI50n.js";import{c as ie,e as Fe,u as G,a as K,C as u,n as f,o as j,I as le,p as g,B as N,s as x,d as T,K as H,S as I,A as Ee,f as Ie,g as Te,h as Pe,i as Le,j as Re,k as Ve,l as ze,ae as Ue,Q as qe,v as Oe,w as Be,m as $e,D as He,E as Qe,G as Ge,H as Ke,x as J,M as Ze,a2 as X,ai as U,aj as We,P as Je}from"./index-Cw6WSGfP.js";import{u as de}from"./useUserListDetails-BSyEjQrH.js";import{u as Xe}from"./useRequestsByUserId-BfTEvivC.js";import{T as Ye,a as es,b as q,c as O}from"./tabs-SYysrnpz.js";import{M as me}from"./MediaGrid-D_gViZ45.js";import{S as ss,U as as}from"./UpdateProfileForm-BcaR0493.js";import{o as fe,s as Y,u as je,t as ge,F as pe,a as ee,b as se,c as ae,d as te,e as re}from"./form-Ba3HuSxU.js";import{I as Q}from"./input-B7M3MPRI.js";import{M as Ne}from"./mail-_uYRG5vJ.js";import{D as ts,a as rs,b as is,c as ls,d as ns,e as cs}from"./dialog-DtG0Tqk0.js";import{S as xe}from"./settings-Bv5hbbbn.js";import{B}from"./RequestModal-Dh-rgp6A.js";import{R as $}from"./refresh-cw-vuD0gYMD.js";import{f as he}from"./format-ulCIpsJ0.js";import"./vendor-aQ18W7Az.js";import"./streaming-fF1zHaJi.js";import"./utils-D-N2hrcs.js";import"./label-BjJg9FZ3.js";import"./hourglass-d_tFP0Ab.js";import"./plus-BCI7Qmoy.js";import"./textarea-BGhclJcN.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=ie("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=ie("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=ie("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);var xs="Separator",ue="horizontal",hs=["horizontal","vertical"],ve=d.forwardRef((s,t)=>{const o=s,{decorative:a,orientation:i=ue}=o,r=W(o,["decorative","orientation"]),l=us(i)?i:ue,c=a?{role:"none"}:{"aria-orientation":l==="vertical"?l:void 0,role:"separator"};return e.jsx(Ae.div,z(p(p({"data-orientation":l},c),r),{ref:t}))});ve.displayName=xs;function us(s){return hs.includes(s)}var we=ve;const _e=d.forwardRef((l,r)=>{var n=l,{className:s,orientation:t="horizontal",decorative:a=!0}=n,i=W(n,["className","orientation","decorative"]);return e.jsx(we,p({ref:r,decorative:a,orientation:t,className:Fe("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s)},i))});_e.displayName=we.displayName;const fs=new RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),js=({profile:s})=>{const{t,i18n:a}=G(),{session:i}=K(),r=d.useMemo(()=>fe({email:Y().regex(fs,{message:t("invalid_email")})}),[t]),l=je({resolver:ge(r),values:{email:s.email||""}});d.useEffect(()=>{Object.keys(l.formState.errors).length>0&&l.trigger()},[a.language,l]);const n=c=>y(null,null,function*(){const{error:o}=yield x.auth.updateUser({email:c.email});o?T(t("error_updating_email")):(H(t("email_update_confirmation_sent")),i!=null&&i.user&&(yield x.from("audit_logs").insert({user_id:i.user.id,action:"user_email_change_request",details:{new_email:c.email}})))});return e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"})," ",t("change_email")]}),e.jsx(le,{children:t("update_your_email_address")})]}),e.jsx(g,{children:e.jsx(pe,z(p({},l),{children:e.jsxs("form",{onSubmit:l.handleSubmit(n),className:"space-y-4",children:[e.jsx(ee,{control:l.control,name:"email",render:({field:c})=>e.jsxs(se,{children:[e.jsx(ae,{children:t("email_address")}),e.jsx(te,{children:e.jsx(Q,p({type:"email"},c))}),e.jsx(re,{})]})}),e.jsx(N,{type:"submit",disabled:l.formState.isSubmitting,children:t("update_email")})]})}))})]})},gs=()=>{const{t:s,i18n:t}=G(),{session:a}=K(),i=d.useMemo(()=>fe({password:Y().min(6,{message:s("password_too_short")}).regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,{message:s("password_requirements")}),confirmPassword:Y()}).refine(n=>n.password===n.confirmPassword,{message:s("passwords_do_not_match"),path:["confirmPassword"]}),[s]),r=je({resolver:ge(i),defaultValues:{password:"",confirmPassword:""}});d.useEffect(()=>{Object.keys(r.formState.errors).length>0&&r.trigger()},[t.language,r]);const l=n=>y(null,null,function*(){const{error:c}=yield x.auth.updateUser({password:n.password});c?T(s("error_updating_password")):(H(s("password_updated_successfully")),a!=null&&a.user&&(yield x.from("audit_logs").insert({user_id:a.user.id,action:"user_password_updated",details:{email:a.user.email}})),r.reset())});return e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-5 w-5"})," ",s("change_password")]}),e.jsx(le,{children:s("update_your_password")})]}),e.jsx(g,{children:e.jsx(pe,z(p({},r),{children:e.jsxs("form",{onSubmit:r.handleSubmit(l),className:"space-y-4",children:[e.jsx(ee,{control:r.control,name:"password",render:({field:n})=>e.jsxs(se,{children:[e.jsx(ae,{children:s("new_password")}),e.jsx(te,{children:e.jsx(Q,p({type:"password"},n))}),e.jsx(re,{})]})}),e.jsx(ee,{control:r.control,name:"confirmPassword",render:({field:n})=>e.jsxs(se,{children:[e.jsx(ae,{children:s("confirm_new_password")}),e.jsx(te,{children:e.jsx(Q,p({type:"password"},n))}),e.jsx(re,{})]})}),e.jsx(N,{type:"submit",disabled:r.formState.isSubmitting,children:s("update_password")})]})}))})]})},ps=()=>{const{t:s}=G(),{session:t}=K(),[a,i]=d.useState([]),[r,l]=d.useState(!0),[n,c]=d.useState(!1),[o,h]=d.useState(!1),[P,b]=d.useState(null),[C,Z]=d.useState(null),[k,L]=d.useState(""),[D,v]=d.useState(null),[M,w]=d.useState(!1),_=a.find(m=>m.status==="verified"),A=d.useCallback(()=>y(null,null,function*(){l(!0);const{data:m,error:S}=yield x.auth.mfa.listFactors();S?(T(s("error_fetching_mfa_status")),i([])):i(m.all),l(!1)}),[s]);d.useEffect(()=>{A()},[A]);const ye=()=>y(null,null,function*(){try{const{data:m,error:S}=yield x.auth.mfa.listFactors();if(S)throw S;const F=m.all.find(Ce=>Ce.status==="unverified");F&&(yield x.auth.mfa.unenroll({factorId:F.id}));const{data:E,error:R}=yield x.auth.mfa.enroll({factorType:"totp"});if(R)throw R;b(E.totp.qr_code),Z(E.totp.secret),c(!0),yield A()}catch(m){T(m.message)}}),be=()=>y(null,null,function*(){if(!_){w(!0),v(null);const m=a.find(R=>R.status==="unverified");if(!m){v("Aucun facteur à vérifier. Veuillez réessayer."),w(!1);return}const{data:S,error:F}=yield x.auth.mfa.challenge({factorId:m.id});if(F){v(F.message),w(!1);return}const{error:E}=yield x.auth.mfa.verify({factorId:m.id,challengeId:S.id,code:k});E?v(E.message):(H(s("mfa_enabled_successfully")),t!=null&&t.user&&(yield x.from("audit_logs").insert({user_id:t.user.id,action:"user_mfa_enabled",details:{email:t.user.email}})),c(!1),L(""),A()),w(!1)}}),Se=()=>y(null,null,function*(){if(!_)return;const{error:m}=yield x.auth.mfa.unenroll({factorId:_.id});m?T(m.message):(H(s("mfa_disabled_successfully")),t!=null&&t.user&&(yield x.from("audit_logs").insert({user_id:t.user.id,action:"user_mfa_disabled",details:{email:t.user.email}})),A()),h(!1)});return e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-5 w-5"})," ",s("mfa_title")]}),e.jsx(le,{children:s("mfa_description")})]}),e.jsx(g,{children:r?e.jsx(I,{className:"h-10 w-32"}):_?e.jsx(N,{variant:"destructive",onClick:()=>h(!0),children:s("disable_mfa")}):e.jsx(N,{onClick:ye,children:s("enable_mfa")})})]}),e.jsx(ts,{open:n,onOpenChange:c,children:e.jsxs(rs,{children:[e.jsxs(is,{children:[e.jsx(ls,{children:s("enable_mfa")}),e.jsx(ns,{children:s("scan_qr_code")})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4 py-4",children:[P&&e.jsx("img",{src:P,alt:"QR Code",className:"bg-white p-2 rounded-lg"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("or_use_secret")}),e.jsx("code",{className:"bg-muted p-2 rounded font-mono text-sm",children:C}),e.jsx(Q,{placeholder:s("verification_code_placeholder"),value:k,onChange:m=>L(m.target.value),className:"text-center tracking-widest",maxLength:6}),D&&e.jsx("p",{className:"text-sm text-destructive",children:D})]}),e.jsx(cs,{children:e.jsx(N,{onClick:be,disabled:M||k.length<6,children:s(M?"verifying":"verify_and_enable")})})]})}),e.jsx(Ee,{open:o,onOpenChange:h,children:e.jsxs(Ie,{children:[e.jsxs(Te,{children:[e.jsx(Pe,{children:s("confirm_disable_mfa_title")}),e.jsx(Le,{children:s("confirm_disable_mfa_own_account")})]}),e.jsxs(Re,{children:[e.jsx(Ve,{children:s("cancel")}),e.jsx(ze,{onClick:Se,className:Ue({variant:"destructive"}),children:s("disable_mfa")})]})]})})]})},Bs=()=>{var D,v,M,w,_;const{t:s,i18n:t}=G(),{profile:a,loading:i}=qe(),{session:r}=K(),[l,n]=d.useState("overview"),c=t.language==="fr"?Oe:Be,{list:o,loading:h,refetch:P}=de(((D=r==null?void 0:r.user)==null?void 0:D.id)||"","favorite"),{list:b,loading:C,refetch:Z}=de(((v=r==null?void 0:r.user)==null?void 0:v.id)||"","watchlist"),{requests:k}=Xe(((M=r==null?void 0:r.user)==null?void 0:M.id)||""),L=()=>e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(I,{className:"h-24 w-24 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"h-8 w-48"}),e.jsx(I,{className:"h-4 w-32"})]})]}),e.jsx(I,{className:"h-96 w-full"})]});return i||!a?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(L,{})}):e.jsxs($e.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-6 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(He,{className:"h-24 w-24 border-4 border-background shadow-lg",children:[e.jsx(Qe,{src:a.avatar_url||Ge(a.email,160)}),e.jsxs(Ke,{className:"text-3xl",children:[(w=a.first_name)==null?void 0:w.charAt(0),(_=a.last_name)==null?void 0:_.charAt(0)]})]}),e.jsx(N,{size:"icon",variant:"outline",className:"absolute -bottom-2 -right-2 h-8 w-8 rounded-full bg-background",title:s("change_avatar"),children:e.jsx(os,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-bold tracking-tight",children:[a.first_name," ",a.last_name]}),e.jsx("p",{className:"text-muted-foreground text-lg",children:a.email}),e.jsxs(J,{variant:"secondary",className:"mt-2",children:[e.jsx(Ze,{className:"h-3 w-3 mr-1"}),s("member_since")," ",he(new Date(a.updated_at),"MMMM yyyy",{locale:c})]})]})]})}),e.jsxs(Ye,{value:l,onValueChange:n,className:"space-y-6",children:[e.jsxs(es,{className:"grid w-full grid-cols-4",children:[e.jsxs(q,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),s("overview")]}),e.jsxs(q,{value:"settings",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),s("settings")]}),e.jsxs(q,{value:"favorites",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),s("favorites")]}),e.jsxs(q,{value:"watchlist",className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),s("watchlist")]})]}),e.jsx(O,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),s("profile_information")]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("first_name")}),e.jsx("p",{className:"text-sm",children:a.first_name||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("last_name")}),e.jsx("p",{className:"text-sm",children:a.last_name||"-"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:s("email")}),e.jsx("p",{className:"text-sm",children:a.email})]}),e.jsx(_e,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:s("account_created")}),e.jsx("span",{className:"text-sm",children:he(new Date(a.updated_at),"PPP",{locale:c})})]})]})]}),e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),s("quick_stats")]})}),e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx(U,{className:"h-8 w-8 mx-auto mb-2 text-red-500"}),e.jsx("div",{className:"text-2xl font-bold",children:o.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s("favorites")})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx(B,{className:"h-8 w-8 mx-auto mb-2 text-blue-500"}),e.jsx("div",{className:"text-2xl font-bold",children:b.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s("watchlist")})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx(We,{className:"h-8 w-8 mx-auto mb-2 text-green-500"}),e.jsx("div",{className:"text-2xl font-bold",children:k.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s("requests")})]})]})})]})]})}),e.jsx(O,{value:"settings",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),s("personal_information")]})}),e.jsx(g,{children:e.jsx(as,{profile:a})})]}),e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5"}),s("security")]})}),e.jsx(g,{className:"space-y-6",children:e.jsx(ps,{})})]}),e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"}),s("email_settings")]})}),e.jsx(g,{children:e.jsx(js,{profile:a})})]}),e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-5 w-5"}),s("password_settings")]})}),e.jsx(g,{children:e.jsx(gs,{})})]})]})}),e.jsx(O,{value:"favorites",className:"space-y-6",children:e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),e.jsx(j,{children:s("favorites")}),e.jsx(J,{variant:"secondary",children:o.length})]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:P,disabled:h,className:"flex items-center gap-2",children:[e.jsx($,{className:`h-4 w-4 ${h?"animate-spin":""}`}),s("refresh")]})]})}),e.jsx(g,{children:h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):o.length>0?e.jsx(me,{items:o,showRequestButton:!1}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(U,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg",children:s("no_favorites_yet")}),e.jsx("p",{className:"text-sm",children:s("start_adding_favorites")})]})})]})}),e.jsx(O,{value:"watchlist",className:"space-y-6",children:e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),e.jsx(j,{children:s("watchlist")}),e.jsx(J,{variant:"secondary",children:b.length})]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:Z,disabled:C,className:"flex items-center gap-2",children:[e.jsx($,{className:`h-4 w-4 ${C?"animate-spin":""}`}),s("refresh")]})]})}),e.jsx(g,{children:C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):b.length>0?e.jsx(me,{items:b,showRequestButton:!1}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(B,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg",children:s("no_watchlist_yet")}),e.jsx("p",{className:"text-sm",children:s("start_adding_watchlist")})]})})]})})]})]})};export{Bs as default};
//# sourceMappingURL=Profile-_lQ0fhdF.js.map
