{"version":3,"file":"provider-4ZxKCpH7.js","sources":["../../node_modules/vidstack/dist/prod/providers/hls/lib-loader.js","../../node_modules/vidstack/dist/prod/providers/hls/provider.js"],"sourcesContent":["import { isUndefined, isString, DOMEvent, isFunction } from 'maverick.js/std';\nimport { Q as coerceToError, R as loadScript } from '../../media-core.js';\n\nclass HLSLibLoader {\n  constructor(_lib, _context, _callback) {\n    this.Bh = _lib;\n    this.ph = _context;\n    this.jf = _callback;\n    this.Ch();\n  }\n  async Ch() {\n    const callbacks = {\n      onLoadStart: this.ge.bind(this),\n      onLoaded: this.ue.bind(this),\n      onLoadError: this.Dh.bind(this)\n    };\n    let ctor = await loadHLSScript(this.Bh, callbacks);\n    if (isUndefined(ctor) && !isString(this.Bh))\n      ctor = await importHLS(this.Bh, callbacks);\n    if (!ctor)\n      return null;\n    if (!ctor.isSupported()) {\n      const message = \"[vidstack]: `hls.js` is not supported in this environment\";\n      this.ph.player.dispatchEvent(new DOMEvent(\"hls-unsupported\"));\n      this.ph.delegate.p(\"error\", { detail: { message, code: 4 } });\n      return null;\n    }\n    return ctor;\n  }\n  ge() {\n    this.ph.player.dispatchEvent(new DOMEvent(\"hls-lib-load-start\"));\n  }\n  ue(ctor) {\n    this.ph.player.dispatchEvent(\n      new DOMEvent(\"hls-lib-loaded\", {\n        detail: ctor\n      })\n    );\n    this.jf(ctor);\n  }\n  Dh(e) {\n    const error = coerceToError(e);\n    this.ph.player.dispatchEvent(\n      new DOMEvent(\"hls-lib-load-error\", {\n        detail: error\n      })\n    );\n    this.ph.delegate.p(\"error\", {\n      detail: { message: error.message, code: 4 }\n    });\n  }\n}\nasync function importHLS(loader, callbacks = {}) {\n  if (isUndefined(loader))\n    return void 0;\n  callbacks.onLoadStart?.();\n  if (loader.prototype && loader.prototype !== Function) {\n    callbacks.onLoaded?.(loader);\n    return loader;\n  }\n  try {\n    const ctor = (await loader())?.default;\n    if (ctor && !!ctor.isSupported) {\n      callbacks.onLoaded?.(ctor);\n    } else {\n      throw Error(\n        false ? \"[vidstack] failed importing `hls.js`. Dynamic import returned invalid constructor.\" : \"\"\n      );\n    }\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\nasync function loadHLSScript(src, callbacks = {}) {\n  if (!isString(src))\n    return void 0;\n  callbacks.onLoadStart?.();\n  try {\n    await loadScript(src);\n    if (!isFunction(window.Hls)) {\n      throw Error(\n        false ? \"[vidstack] failed loading `hls.js`. Could not find a valid `Hls` constructor on window\" : \"\"\n      );\n    }\n    const ctor = window.Hls;\n    callbacks.onLoaded?.(ctor);\n    return ctor;\n  } catch (err) {\n    callbacks.onLoadError?.(err);\n  }\n  return void 0;\n}\n\nexport { HLSLibLoader as H };\n","import { peek } from 'maverick.js';\nimport { isString } from 'maverick.js/std';\nimport { U as isHLSSupported, p as preconnect } from '../../media-core.js';\nimport { VideoProvider } from '../video/provider.js';\nimport { H as HLSController } from './hls.js';\nimport { H as HLSLibLoader } from './lib-loader.js';\nimport 'maverick.js/element';\nimport '../type-check.js';\nimport '../audio/loader.js';\nimport 'maverick.js/dom';\nimport './loader.js';\nimport '../video/loader.js';\nimport '../html/provider.js';\nimport '../html/htmlâ€“media-events.js';\nimport '../../media-ui.js';\nimport '../../icons/icon.js';\nimport 'media-captions';\nimport '../html/native-audio-tracks.js';\nimport '../video/native-hls-text-tracks.js';\nimport '../video/picture-in-picture.js';\nimport '../video/presentation/video-presentation.js';\n\nconst JS_DELIVR_CDN = \"https://cdn.jsdelivr.net\";\nclass HLSProvider extends VideoProvider {\n  $$PROVIDER_TYPE = \"HLS\";\n  mh = null;\n  od = new HLSController(this.video);\n  /**\n   * The `hls.js` constructor.\n   */\n  get ctor() {\n    return this.mh;\n  }\n  /**\n   * The current `hls.js` instance.\n   */\n  get instance() {\n    return this.od.instance;\n  }\n  /**\n   * Whether `hls.js` is supported in this environment.\n   */\n  static supported = isHLSSupported();\n  get type() {\n    return \"hls\";\n  }\n  get canLiveSync() {\n    return true;\n  }\n  lh = `${JS_DELIVR_CDN}/npm/hls.js@^1.0.0/dist/hls${\".min.js\"}`;\n  /**\n   * The `hls.js` configuration object.\n   *\n   * @see {@link https://github.com/video-dev/hls.js/blob/master/docs/API.md#fine-tuning}\n   */\n  get config() {\n    return this.od.nh;\n  }\n  set config(config) {\n    this.od.nh = config;\n  }\n  /**\n   * The `hls.js` constructor (supports dynamic imports) or a URL of where it can be found.\n   *\n   * @defaultValue `https://cdn.jsdelivr.net/npm/hls.js@^1.0.0/dist/hls.min.js`\n   */\n  get library() {\n    return this.lh;\n  }\n  set library(library) {\n    this.lh = library;\n  }\n  preconnect() {\n    if (!isString(this.lh))\n      return;\n    preconnect(this.lh);\n  }\n  setup(context) {\n    super.setup(context);\n    new HLSLibLoader(this.lh, context, (ctor) => {\n      this.mh = ctor;\n      this.od.setup(ctor, context);\n      context.delegate.p(\"provider-setup\", { detail: this });\n      const src = peek(context.$store.source);\n      if (src)\n        this.loadSource(src);\n    });\n  }\n  async loadSource({ src }) {\n    if (!isString(src))\n      return;\n    this.od.instance?.loadSource(src);\n  }\n  /**\n   * The given callback is invoked when a new `hls.js` instance is created and right before it's\n   * attached to media.\n   */\n  onInstance(callback) {\n    const instance = this.od.instance;\n    if (instance)\n      callback(instance);\n    this.od.oh.add(callback);\n    return () => this.od.oh.delete(callback);\n  }\n  destroy() {\n    this.od.Jg();\n  }\n}\n\nexport { HLSProvider };\n"],"names":["HLSLibLoader","_lib","_context","_callback","__async","callbacks","ctor","loadHLSScript","isUndefined","isString","importHLS","message","DOMEvent","e","error","coerceToError","_0","loader","_a","_b","_c","_d","err","_e","src","loadScript","isFunction","JS_DELIVR_CDN","HLSProvider","VideoProvider","__publicField","HLSController","config","library","preconnect","context","peek","callback","instance","isHLSSupported"],"mappings":"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","x_google_ignoreList":[0,1]}