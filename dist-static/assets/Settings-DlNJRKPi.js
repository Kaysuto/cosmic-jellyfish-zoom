var M=Object.defineProperty,$=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var w=(n,s,a)=>s in n?M(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a,j=(n,s)=>{for(var a in s||(s={}))J.call(s,a)&&w(n,a,s[a]);if(y)for(var a of y(s))K.call(s,a)&&w(n,a,s[a]);return n},C=(n,s)=>$(n,G(s));var _=(n,s,a)=>new Promise((t,r)=>{var u=i=>{try{c(a.next(i))}catch(d){r(d)}},o=i=>{try{c(a.throw(i))}catch(d){r(d)}},c=i=>i.done?t(i.value):Promise.resolve(i.value).then(u,o);c((a=a.apply(n,s)).next())});import{j as e}from"./ui-DslYdUPK.js";import{u as p,a as D,C as T,n as I,o as E,I as R,p as L,S as O,B as Q,A as q,f as z,g as W,h as X,i as Y,j as Z,k as ee,l as se,s as x,d as V,K as P,P as te,Q as ae,R as ne,m as ie}from"./index-Cw6WSGfP.js";import{o as re,f as le,s as oe,u as ce,F as de,a as b,b as v,c as F,d as k,e as N,g as ge,t as ue}from"./form-Ba3HuSxU.js";import{I as me}from"./input-B7M3MPRI.js";import{S as xe,a as he,b as fe,c as je,d as A}from"./select-NjfxA5eB.js";import{r as m}from"./router-42GXI50n.js";import{S as _e}from"./settings-Bv5hbbbn.js";import{S as pe}from"./switch-goiC7JOz.js";import{L as Se}from"./label-BjJg9FZ3.js";import"./vendor-aQ18W7Az.js";import"./streaming-fF1zHaJi.js";import"./utils-D-N2hrcs.js";import"./index-Cco2FRbQ.js";const ye=({settings:n,loading:s,onUpdate:a})=>{const{t}=p(),{session:r}=D(),[u,o]=m.useState(!1),[c,i]=m.useState(null),d=m.useMemo(()=>re({site_title:oe().min(1,{message:t("site_title_empty_error")}),default_language:le(["fr","en"])}),[t]),g=ce({resolver:ue(d),defaultValues:{site_title:"",default_language:"fr"}});m.useEffect(()=>{if(!s){const l=(h,f="")=>{var S;return((S=n.find(H=>H.key===h))==null?void 0:S.value)||f};g.reset({site_title:l("site_title","Statut des Services Jelly"),default_language:l("default_language","fr")})}},[s,n,g]);const U=l=>{i(l),o(!0)},B=()=>_(null,null,function*(){if(!c||!(r!=null&&r.user))return;const l=[{key:"site_title",value:c.site_title},{key:"default_language",value:c.default_language}],{error:h}=yield x.from("app_settings").upsert(l,{onConflict:"key"});if(h)V(t("error_updating_setting"));else{P(t("settings_updated_successfully"));for(const f of l)yield x.from("audit_logs").insert({user_id:r.user.id,action:"setting_updated",details:f});a()}o(!1),i(null)});return e.jsxs(e.Fragment,{children:[e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),t("general_settings")]}),e.jsx(R,{children:t("general_settings_desc")})]}),e.jsx(L,{children:s?e.jsx(O,{className:"h-48 w-full"}):e.jsx(de,C(j({},g),{children:e.jsxs("form",{onSubmit:g.handleSubmit(U),className:"space-y-6",children:[e.jsx(b,{control:g.control,name:"site_title",render:({field:l})=>e.jsxs(v,{children:[e.jsx(F,{children:t("site_title_label")}),e.jsx(k,{children:e.jsx(me,j({},l))}),e.jsx(N,{})]})}),e.jsx(b,{control:g.control,name:"default_language",render:({field:l})=>e.jsxs(v,{children:[e.jsx(F,{children:t("default_language")}),e.jsxs(xe,{onValueChange:l.onChange,defaultValue:l.value,children:[e.jsx(k,{children:e.jsx(he,{children:e.jsx(fe,{})})}),e.jsxs(je,{children:[e.jsx(A,{value:"fr",children:"FranÃ§ais"}),e.jsx(A,{value:"en",children:"English"})]})]}),e.jsx(ge,{children:t("default_language_desc")}),e.jsx(N,{})]})}),e.jsx(Q,{type:"submit",disabled:g.formState.isSubmitting,children:t("save_changes")})]})}))})]}),e.jsx(q,{open:u,onOpenChange:o,children:e.jsxs(z,{children:[e.jsxs(W,{children:[e.jsx(X,{children:t("confirm_global_changes_title")}),e.jsx(Y,{children:t("confirm_global_changes_desc")})]}),e.jsxs(Z,{children:[e.jsx(ee,{onClick:()=>i(null),children:t("cancel")}),e.jsx(se,{onClick:B,children:t("save_changes")})]})]})})]})},we=({settings:n,loading:s,onUpdate:a})=>{const{t}=p(),{session:r}=D(),[u,o]=m.useState(!0);m.useEffect(()=>{if(!s){const i=n.find(d=>d.key==="allow_registrations");o(i?i.value==="true":!0)}},[s,n]);const c=i=>_(null,null,function*(){if(!(r!=null&&r.user))return;const d=u;o(i);const{error:g}=yield x.from("app_settings").upsert({key:"allow_registrations",value:i.toString()},{onConflict:"key"});g?(V(t("error_updating_setting")),o(d)):(P(t(i?"registrations_enabled":"registrations_disabled")),yield x.from("audit_logs").insert({user_id:r.user.id,action:"setting_updated",details:{key:"allow_registrations",value:i.toString()}}),a())});return e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),t("registration_settings")]}),e.jsx(R,{children:t("allow_new_registrations_desc")})]}),e.jsx(L,{children:s?e.jsx(O,{className:"h-6 w-52"}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"allow-registrations",checked:u,onCheckedChange:c}),e.jsx(Se,{htmlFor:"allow-registrations",children:t("allow_new_registrations")})]})})]})},Ve=()=>{const{t:n}=p(),{profile:s}=ae(),{settings:a,loading:t,refreshSettings:r}=ne();return e.jsx(ie.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeInOut"},children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:n("settings")}),e.jsx("p",{className:"text-muted-foreground",children:n("settings_description")})]}),(s==null?void 0:s.role)==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{settings:a,loading:t,onUpdate:r}),e.jsx(we,{settings:a,loading:t,onUpdate:r})]})]})})};export{Ve as default};
//# sourceMappingURL=Settings-DlNJRKPi.js.map
