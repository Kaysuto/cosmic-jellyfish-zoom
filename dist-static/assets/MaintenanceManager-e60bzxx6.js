var re=Object.defineProperty,ae=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var B=(s,a,t)=>a in s?re(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,m=(s,a)=>{for(var t in a||(a={}))ne.call(a,t)&&B(s,t,a[t]);if(V)for(var t of V(a))le.call(a,t)&&B(s,t,a[t]);return s},L=(s,a)=>ae(s,ie(a));var k=(s,a,t)=>new Promise((u,c)=>{var n=r=>{try{o(t.next(r))}catch(l){c(l)}},h=r=>{try{o(t.throw(r))}catch(l){c(l)}},o=r=>r.done?u(r.value):Promise.resolve(r.value).then(n,h);o((t=t.apply(s,a)).next())});import{j as e}from"./ui-DslYdUPK.js";import{r as p}from"./router-42GXI50n.js";import{u as oe}from"./useMaintenances-55czmzqe.js";import{u as ce}from"./useServices-CHToQZU2.js";import{u as G,B as M,a as de,v as me,w as ue,C as z,n as R,S as K,p as U,m as he,o as xe,V as je,W as pe,Y as fe,a0 as W,_ as _e,A as ge,f as De,g as we,h as Ce,i as ve,j as Se,k as be,l as ye,d as F,s as j,K as O}from"./index-Cw6WSGfP.js";import{u as Te,t as Fe,F as Me,a as f,b as _,c as g,d as D,e as w,o as Ne,s as C}from"./form-Ba3HuSxU.js";import{I as H}from"./input-B7M3MPRI.js";import{T as Ie}from"./textarea-BGhclJcN.js";import{S as Ae,a as Le,b as ke,c as Oe,d as Y}from"./select-NjfxA5eB.js";import{f as q}from"./format-ulCIpsJ0.js";import{T as He,a as qe,b as $,c as v,d as Ee,e as S}from"./table-BD6NPv27.js";import{D as Pe,a as Ve,b as Be,c as ze,d as Re}from"./dialog-DtG0Tqk0.js";import{C as Ke}from"./circle-plus-CGDpU3lh.js";import{E as Ue}from"./ellipsis-pwK6sJe6.js";import{S as We}from"./square-pen-ltNotjoP.js";import"./vendor-aQ18W7Az.js";import"./streaming-fF1zHaJi.js";import"./utils-D-N2hrcs.js";import"./label-BjJg9FZ3.js";import"./index-Cco2FRbQ.js";const Ye=Ne({title:C().min(1,{message:"Le titre est requis"}),description:C().optional(),service_id:C().nullable(),start_time:C().min(1,{message:"La date de début est requise"}),end_time:C().min(1,{message:"La date de fin est requise"})}),$e=({maintenance:s,services:a,onSubmit:t,onCancel:u,isSubmitting:c})=>{const{t:n}=G(),h=r=>r?q(new Date(r),"yyyy-MM-dd'T'HH:mm"):"",o=Te({resolver:Fe(Ye),defaultValues:{title:(s==null?void 0:s.title)||"",description:(s==null?void 0:s.description)||"",service_id:(s==null?void 0:s.service_id)||null,start_time:h(s==null?void 0:s.start_time),end_time:h(s==null?void 0:s.end_time)}});return e.jsx(Me,L(m({},o),{children:e.jsxs("form",{onSubmit:o.handleSubmit(t),className:"space-y-4",children:[e.jsx(f,{control:o.control,name:"title",render:({field:r})=>e.jsxs(_,{children:[e.jsx(g,{children:n("title")}),e.jsx(D,{children:e.jsx(H,m({},r))}),e.jsx(w,{})]})}),e.jsx(f,{control:o.control,name:"description",render:({field:r})=>e.jsxs(_,{children:[e.jsx(g,{children:n("description")}),e.jsx(D,{children:e.jsx(Ie,m({},r))}),e.jsx(w,{})]})}),e.jsx(f,{control:o.control,name:"service_id",render:({field:r})=>e.jsxs(_,{children:[e.jsx(g,{children:n("service")}),e.jsxs(Ae,{onValueChange:l=>r.onChange(l==="null"?null:l),defaultValue:r.value||"null",children:[e.jsx(D,{children:e.jsx(Le,{children:e.jsx(ke,{placeholder:n("service")})})}),e.jsxs(Oe,{children:[e.jsx(Y,{value:"null",children:n("all_services")}),a.map(l=>e.jsx(Y,{value:l.id,children:n(l.name.toLowerCase().replace(/ /g,"_"))},l.id))]})]}),e.jsx(w,{})]})}),e.jsx(f,{control:o.control,name:"start_time",render:({field:r})=>e.jsxs(_,{children:[e.jsx(g,{children:n("start_time")}),e.jsx(D,{children:e.jsx(H,m({type:"datetime-local"},r))}),e.jsx(w,{})]})}),e.jsx(f,{control:o.control,name:"end_time",render:({field:r})=>e.jsxs(_,{children:[e.jsx(g,{children:n("end_time")}),e.jsx(D,{children:e.jsx(H,m({type:"datetime-local"},r))}),e.jsx(w,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(M,{type:"button",variant:"ghost",onClick:u,disabled:c,children:n("cancel")}),e.jsx(M,{type:"submit",disabled:c,children:n(c?"saving":"save")})]})]})}))},fs=()=>{const{t:s,i18n:a}=G(),{session:t}=de(),{maintenances:u,loading:c,refreshMaintenances:n}=oe(),{services:h,loading:o}=ce(),[r,l]=p.useState(!1),[J,E]=p.useState(!1),[x,N]=p.useState(null),[Q,I]=p.useState(!1),[b,A]=p.useState(null),P=a.language==="fr"?me:ue,X=i=>k(null,null,function*(){if(!(t!=null&&t.user)){F("Vous devez être connecté pour effectuer cette action.");return}E(!0);const y=L(m({},i),{author_id:t.user.id,updated_at:new Date().toISOString()});if(x){const{error:d}=yield j.from("scheduled_maintenances").update(y).eq("id",x.id);d?(F(s("error_saving_maintenance")),console.error(d)):(O(s("maintenance_saved_successfully")),yield j.from("audit_logs").insert({user_id:t.user.id,action:"maintenance_updated",details:{maintenance_id:x.id,title:i.title}}),n())}else{const{data:d,error:T}=yield j.from("scheduled_maintenances").insert(y).select().single();T?(F(s("error_saving_maintenance")),console.error(T)):(O(s("maintenance_saved_successfully")),d&&(yield j.from("audit_logs").insert({user_id:t.user.id,action:"maintenance_created",details:{maintenance_id:d.id,title:i.title}})),n())}l(!1),N(null),E(!1)}),Z=i=>{A(i),I(!0)},ee=()=>k(null,null,function*(){var d;if(!b||!(t!=null&&t.user))return;const i=(d=u.find(T=>T.id===b))==null?void 0:d.title,{error:y}=yield j.from("scheduled_maintenances").delete().eq("id",b);y?F(s("error_deleting_maintenance")):(O(s("maintenance_deleted_successfully")),yield j.from("audit_logs").insert({user_id:t.user.id,action:"maintenance_deleted",details:{maintenance_id:b,title:i}}),n()),I(!1),A(null)}),se=()=>{N(null),l(!0)},te=i=>{N(i),l(!0)};return c||o?e.jsxs(z,{children:[e.jsx(R,{children:e.jsx(K,{className:"h-8 w-48"})}),e.jsx(U,{children:e.jsx(K,{className:"h-96 w-full"})})]}):e.jsxs(he.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeInOut"},children:[e.jsxs(z,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between",children:[e.jsx(xe,{children:s("manage_maintenance")}),e.jsxs(M,{onClick:se,children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),s("schedule_maintenance")]})]}),e.jsx(U,{children:e.jsxs(He,{children:[e.jsx(qe,{children:e.jsxs($,{children:[e.jsx(v,{children:s("title")}),e.jsx(v,{children:s("service")}),e.jsx(v,{children:s("start_time")}),e.jsx(v,{children:s("end_time")}),e.jsx(v,{className:"text-right",children:s("actions")})]})}),e.jsx(Ee,{children:u.map(i=>e.jsxs($,{children:[e.jsx(S,{className:"font-medium",children:i.title}),e.jsx(S,{children:i.services?s(i.services.name.toLowerCase().replace(/ /g,"_")):s("all_services")}),e.jsx(S,{children:q(new Date(i.start_time),"PPpp",{locale:P})}),e.jsx(S,{children:q(new Date(i.end_time),"PPpp",{locale:P})}),e.jsx(S,{className:"text-right",children:e.jsxs(je,{modal:!1,children:[e.jsx(pe,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",children:e.jsx(Ue,{className:"h-4 w-4"})})}),e.jsxs(fe,{align:"end",children:[e.jsxs(W,{onClick:()=>te(i),children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:s("edit")})]}),e.jsxs(W,{onClick:()=>Z(i.id),className:"text-destructive",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:s("delete")})]})]})]})})]},i.id))})]})})]}),e.jsx(Pe,{open:r,onOpenChange:l,children:e.jsxs(Ve,{className:"sm:max-w-lg w-full",children:[e.jsxs(Be,{children:[e.jsx(ze,{children:s(x?"edit_maintenance":"schedule_maintenance")}),e.jsx(Re,{children:s(x?"edit_maintenance_desc":"schedule_maintenance_desc")})]}),e.jsx($e,{maintenance:x,services:h,onSubmit:X,onCancel:()=>l(!1),isSubmitting:J})]})}),e.jsx(ge,{open:Q,onOpenChange:I,children:e.jsxs(De,{children:[e.jsxs(we,{children:[e.jsx(Ce,{children:s("confirm_delete_title")}),e.jsx(ve,{children:s("confirm_delete_maintenance")})]}),e.jsxs(Se,{children:[e.jsx(be,{onClick:()=>A(null),children:s("cancel")}),e.jsx(ye,{onClick:ee,className:"bg-destructive hover:bg-destructive/90",children:s("delete")})]})]})})]})};export{fs as default};
//# sourceMappingURL=MaintenanceManager-e60bzxx6.js.map
