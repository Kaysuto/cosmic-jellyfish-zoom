var v=(e,a,t)=>new Promise((n,o)=>{var u=i=>{try{d(t.next(i))}catch(l){o(l)}},c=i=>{try{d(t.throw(i))}catch(l){o(l)}},d=i=>i.done?n(i.value):Promise.resolve(i.value).then(u,c);d((t=t.apply(e,a)).next())});import{j as s}from"./ui-DslYdUPK.js";import{r as x,L as P}from"./router-42GXI50n.js";import{c as U,a as L,u as W,s as j,d as g,K as C,b as J,m as w,C as K,F as X,x as T,ah as Y,a1 as G,e as S,ai as Q,B as z}from"./index-Cw6WSGfP.js";import{H as Z}from"./hourglass-d_tFP0Ab.js";import{P as ee}from"./plus-BCI7Qmoy.js";import{D as se,a as te,b as ae,c as re,d as oe,e as ie}from"./dialog-DtG0Tqk0.js";import{I as le}from"./input-B7M3MPRI.js";import{T as ne}from"./textarea-BGhclJcN.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=U("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=U("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),B=e=>{const{session:a}=L(),{t}=W(),[n,o]=x.useState(new Set),[u,c]=x.useState(!0),d=x.useCallback(()=>v(null,null,function*(){if(!(a!=null&&a.user))return;c(!0);const{data:f,error:h}=yield j.from("user_media_list").select("media_id, media_type").eq("user_id",a.user.id).eq("list_type",e);if(h)g(t("error_fetching_list"));else{const b=new Set(f.map(p=>`${p.media_type}:${p.media_id}`));o(b)}c(!1)}),[a,e,t]);return x.useEffect(()=>{d()},[d]),{list:n,loading:u,addToList:(f,h)=>v(null,null,function*(){if(!(a!=null&&a.user)){g(t("must_be_logged_in"));return}const b=`${h}:${f}`;if(n.has(b))return;const{error:p}=yield j.from("user_media_list").insert({user_id:a.user.id,media_id:f,media_type:h,list_type:e});p?g(t("error_adding_to_list")):(o(_=>new Set(_).add(b)),C(t("added_to_list")))}),removeFromList:(f,h)=>v(null,null,function*(){if(!(a!=null&&a.user)){g(t("must_be_logged_in"));return}const b=`${h}:${f}`;if(!n.has(b))return;const{error:p}=yield j.from("user_media_list").delete().eq("user_id",a.user.id).eq("media_id",f).eq("media_type",h).eq("list_type",e);p?g(t("error_removing_from_list")):(o(_=>{const k=new Set(_);return k.delete(b),k}),C(t("removed_from_list")))}),isInList:(f,h)=>n.has(`${h}:${f}`),refetch:d}},ye=({item:e,showRequestButton:a=!0,onRequest:t,searchTerm:n,progress:o,playUrl:u,playbackPositionTicks:c,showRemoveButton:d,onRemove:i})=>{var R;const{t:l}=W(),{jellyfinUrl:m}=J(),{session:f}=L(),{addToList:h,removeFromList:b,isInList:p}=B("favorite"),{addToList:_,removeFromList:k,isInList:N}=B("watchlist"),y=e.title||e.name||"No title",I=e.release_date||e.first_air_date,V=I?new Date(I).getFullYear():"",$=(R=e.vote_average)!=null?R:null,q=e.isAvailable,E=e.media_type==="anime"?"tv":e.media_type,A=u||(n?`/media/${E}/${e.id}?fromSearch=${encodeURIComponent(n)}`:`/media/${E}/${e.id}`),M=(r=>r?r.startsWith("/")?`https://image.tmdb.org/t/p/w500${r}`:m&&r.startsWith("Items/")?`${m}/${r}`:r:null)(e.poster_path);let H="";if(e.playback_position_ticks&&e.playback_position_ticks>0){const r=Math.floor(e.playback_position_ticks/1e7),D=Math.floor(r/60),F=r%60;H=`${D}m ${F}s`}const O={initial:{opacity:0,y:20},animate:{opacity:1,y:0},hover:{y:-4,scale:1.01}};return s.jsx(w.div,{variants:O,initial:"initial",animate:"animate",whileHover:"hover",transition:{duration:.3,ease:"easeOut"},className:"group",children:s.jsxs(K,{className:"relative overflow-hidden rounded-xl bg-card border border-border/50 transition-all duration-300 h-full shadow-sm hover:shadow-md hover:shadow-black/5",children:[s.jsxs(P,{to:A,className:"block h-full","aria-label":y,children:[s.jsxs("div",{className:"relative aspect-media bg-muted flex items-center justify-center overflow-hidden",children:[M?s.jsx("img",{src:M,alt:y,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy",decoding:"async"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:s.jsx(X,{className:"h-12 w-12"})}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),o!==void 0&&o>0&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-muted/50",children:s.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${o}%`},"aria-hidden":"true"})})]}),s.jsxs("div",{className:"absolute inset-0 p-4 flex flex-col justify-end bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20",children:[s.jsx("h3",{className:"font-semibold text-xs line-clamp-2 mb-1.5 text-white transition-colors duration-300",children:y}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-white/90",children:[s.jsx("span",{className:"bg-black/30 backdrop-blur-sm px-1.5 py-0.5 rounded text-xs",children:V}),$!==null&&$>0&&s.jsxs("div",{className:"flex items-center gap-1 bg-black/30 backdrop-blur-sm px-1.5 py-0.5 rounded text-xs",children:[s.jsx(ce,{className:"h-2.5 w-2.5 text-yellow-400 fill-current"}),s.jsx("span",{className:"font-medium text-xs",children:$.toFixed(1)})]})]}),(e.playback_position_ticks||c)&&s.jsx("div",{className:"mt-1.5 inline-block bg-primary/90 backdrop-blur-sm text-xs text-primary-foreground px-1.5 py-0.5 rounded text-xs font-medium",children:l("resume_at",{time:H||(()=>{if(c&&c>0){const r=Math.floor(c/1e7),D=Math.floor(r/60),F=r%60;return`${D}m ${F}s`}return""})()})})]})]}),s.jsxs("div",{className:"absolute top-2 left-2 z-30",children:[q&&s.jsxs(T,{className:"bg-success text-success-foreground border-0 shadow-md text-xs px-1.5 py-0.5 hover:bg-success",children:[s.jsx(Y,{className:"h-2.5 w-2.5 mr-1"}),l("available")]}),e.isRequested&&!q&&s.jsxs(T,{className:"bg-warning text-warning-foreground border-0 shadow-md text-xs px-1.5 py-0.5 hover:bg-warning",children:[s.jsx(Z,{className:"h-2.5 w-2.5 mr-1"}),l("requested")]})]}),s.jsxs("div",{className:"absolute top-2 right-2 z-30 flex flex-col gap-1.5 opacity-0 group-hover:opacity-100 transition-all duration-300",children:[d&&i&&s.jsx(w.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:r=>{r.preventDefault(),r.stopPropagation(),i(e)},"aria-label":`Retirer ${y} de la liste`,className:"h-6 w-6 rounded-full bg-destructive/90 backdrop-blur-sm text-destructive-foreground flex items-center justify-center transition-all duration-200 hover:bg-destructive shadow-md",children:s.jsx(G,{className:"h-3 w-3"})}),a&&!q&&!e.isRequested&&s.jsx(w.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:r=>{r.preventDefault(),r.stopPropagation(),t&&t(e)},"aria-label":`${l("request")} ${y}`,className:"h-8 w-8 rounded-full bg-primary/90 backdrop-blur-sm text-primary-foreground flex items-center justify-center transition-all duration-200 hover:bg-primary shadow-md",children:s.jsx(ee,{className:"h-4 w-4"})}),f&&s.jsxs(s.Fragment,{children:[s.jsx(w.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:r=>{r.preventDefault(),r.stopPropagation(),p(e.id,e.media_type)?b(e.id,e.media_type):h(e.id,e.media_type)},"aria-label":p(e.id,e.media_type)?l("remove_from_favorites"):l("add_to_favorites"),className:S("h-8 w-8 rounded-full backdrop-blur-sm flex items-center justify-center transition-all duration-200 shadow-md",p(e.id,e.media_type)?"bg-destructive/90 text-destructive-foreground hover:bg-destructive":"bg-background/90 text-foreground hover:bg-background"),children:s.jsx(Q,{className:S("h-4 w-4 transition-all duration-200",p(e.id,e.media_type)&&"fill-current")})}),s.jsx(w.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:r=>{r.preventDefault(),r.stopPropagation(),N(e.id,e.media_type)?k(e.id,e.media_type):_(e.id,e.media_type)},"aria-label":N(e.id,e.media_type)?l("remove_from_watchlist"):l("add_to_watchlist"),className:S("h-8 w-8 rounded-full backdrop-blur-sm flex items-center justify-center transition-all duration-200 shadow-md",N(e.id,e.media_type)?"bg-primary/90 text-primary-foreground hover:bg-primary":"bg-background/90 text-foreground hover:bg-background"),children:s.jsx(de,{className:S("h-4 w-4 transition-all duration-200",N(e.id,e.media_type)&&"fill-current")})})]})]})]})})},we=e=>{const{session:a}=L(),[t,n]=x.useState(new Set),[o,u]=x.useState(!0);return x.useEffect(()=>{v(null,null,function*(){if(!(a!=null&&a.user)||e.length===0){u(!1);return}u(!0);const{data:d,error:i}=yield j.from("media_requests").select("tmdb_id").in("tmdb_id",e).eq("user_id",a.user.id);i?console.error("Error fetching request status:",i):n(new Set(d.map(l=>l.tmdb_id))),u(!1)})},[e,a]),{requestedIds:t,loading:o}},je=({open:e,onOpenChange:a,item:t,onSuccess:n})=>{const{session:o}=L(),[u,c]=x.useState(""),[d,i]=x.useState(!1);x.useEffect(()=>{e&&t&&c("")},[e,t]);const l=()=>v(null,null,function*(){if(!(o!=null&&o.user)){g("Vous devez être connecté pour faire une demande.");return}if(t){i(!0);try{const{error:m}=yield j.from("media_requests").insert({user_id:o.user.id,media_type:t.media_type,tmdb_id:t.id,title:t.title||t.name||"",poster_path:t.poster_path||null,overview:u||null,requested_at:new Date().toISOString()});if(m)throw m;C("Demande envoyée !"),a(!1),n==null||n()}catch(m){console.error(m),g(m.message||"Erreur lors de la demande.")}finally{i(!1)}}});return s.jsx(se,{open:e,onOpenChange:a,children:s.jsxs(te,{className:"sm:max-w-lg",children:[s.jsxs(ae,{children:[s.jsxs(re,{children:["Demander : ",(t==null?void 0:t.title)||(t==null?void 0:t.name)]}),s.jsx(oe,{children:"Vous pouvez ajouter une note ou un commentaire à la demande (optionnel)."})]}),s.jsxs("div",{className:"space-y-4 py-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-muted-foreground block mb-1",children:"Titre"}),s.jsx(le,{value:(t==null?void 0:t.title)||(t==null?void 0:t.name)||"",readOnly:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-muted-foreground block mb-1",children:"Notes (optionnel)"}),s.jsx(ne,{value:u,onChange:m=>c(m.target.value),rows:5})]})]}),s.jsxs(ie,{children:[s.jsx(z,{variant:"ghost",onClick:()=>a(!1),disabled:d,children:"Annuler"}),s.jsx(z,{onClick:l,disabled:d,children:d?"Envoi...":"Envoyer la demande"})]})]})})};export{de as B,ye as M,je as R,ce as S,B as a,we as u};
//# sourceMappingURL=RequestModal-Dh-rgp6A.js.map
