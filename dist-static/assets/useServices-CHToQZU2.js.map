{"version":3,"file":"useServices-CHToQZU2.js","sources":["../../src/hooks/useServices.ts"],"sourcesContent":["import { useState, useEffect, useCallback, useMemo } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { RealtimeChannel, RealtimePostgresChangesPayload } from '@supabase/supabase-js';\n\nexport interface Service {\n  id: string;\n  name: string;\n  description: string;\n  status: 'operational' | 'degraded' | 'downtime' | 'maintenance';\n  uptime_percentage: number;\n  created_at: string;\n  updated_at: string;\n  url: string | null;\n  position: number;\n  last_response_time_ms: number | null;\n  ip_address: string | null;\n  port: number | null;\n}\n\nexport const useServices = () => {\n  const [services, setServices] = useState<Service[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const fetchServices = useCallback(async () => {\n    setLoading(true);\n    const { data, error } = await supabase\n      .from('services')\n      .select('*')\n      .order('position');\n    \n    if (error) {\n      console.error('Erreur lors de la récupération des services:', error);\n      setServices([]);\n    } else {\n      setServices(data || []);\n    }\n    setLoading(false);\n  }, []);\n\n  useEffect(() => {\n    fetchServices();\n\n    const handleRealtimeUpdate = (payload: RealtimePostgresChangesPayload<{ [key: string]: any }>) => {\n      console.log('Realtime update received:', payload);\n      fetchServices(); // Re-fetch to get the correct order\n    };\n\n    const channel: RealtimeChannel = supabase\n      .channel('services-changes')\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'services',\n        },\n        handleRealtimeUpdate\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [fetchServices]);\n\n  // Fonction pour forcer le rafraîchissement\n  const refreshServices = useCallback(() => {\n    fetchServices();\n  }, [fetchServices]);\n\n  // Mémoisation des données calculées pour éviter les re-renders\n  const operationalServices = useMemo(() => \n    services.filter(s => s.status === 'operational'), \n    [services]\n  );\n\n  const problematicServices = useMemo(() => \n    services.filter(s => s.status === 'downtime' || s.status === 'degraded'), \n    [services]\n  );\n\n  const maintenanceServices = useMemo(() => \n    services.filter(s => s.status === 'maintenance'), \n    [services]\n  );\n\n  const averageUptime = useMemo(() => {\n    if (services.length === 0) return 0;\n    const total = services.reduce((sum, service) => sum + service.uptime_percentage, 0);\n    return Math.round(total / services.length);\n  }, [services]);\n\n  return { \n    services, \n    loading, \n    refreshServices,\n    operationalServices,\n    problematicServices,\n    maintenanceServices,\n    averageUptime\n  };\n};"],"names":["useServices","services","setServices","useState","loading","setLoading","fetchServices","useCallback","__async","data","error","supabase","useEffect","handleRealtimeUpdate","payload","channel","refreshServices","operationalServices","useMemo","problematicServices","maintenanceServices","averageUptime","total","sum","service"],"mappings":"yRAmBO,MAAMA,EAAc,IAAM,CAC/B,KAAM,CAACC,EAAUC,CAAW,EAAIC,EAAAA,SAAoB,CAAA,CAAE,EAChD,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EAErCG,EAAgBC,EAAAA,YAAY,IAAYC,EAAA,sBAC5CH,EAAW,EAAI,EACf,KAAM,CAAE,KAAAI,EAAM,MAAAC,CAAA,EAAU,MAAMC,EAC3B,KAAK,UAAU,EACf,OAAO,GAAG,EACV,MAAM,UAAU,EAEfD,GACF,QAAQ,MAAM,+CAAgDA,CAAK,EACnER,EAAY,CAAA,CAAE,GAEdA,EAAYO,GAAQ,EAAE,EAExBJ,EAAW,EAAK,CAClB,GAAG,CAAA,CAAE,EAELO,EAAAA,UAAU,IAAM,CACdN,EAAA,EAEA,MAAMO,EAAwBC,GAAoE,CAChG,QAAQ,IAAI,4BAA6BA,CAAO,EAChDR,EAAA,CACF,EAEMS,EAA2BJ,EAC9B,QAAQ,kBAAkB,EAC1B,GACC,mBACA,CACE,MAAO,IACP,OAAQ,SACR,MAAO,UAAA,EAETE,CAAA,EAED,UAAA,EAEH,MAAO,IAAM,CACXF,EAAS,cAAcI,CAAO,CAChC,CACF,EAAG,CAACT,CAAa,CAAC,EAGlB,MAAMU,EAAkBT,EAAAA,YAAY,IAAM,CACxCD,EAAA,CACF,EAAG,CAACA,CAAa,CAAC,EAGZW,EAAsBC,EAAAA,QAAQ,IAClCjB,EAAS,OAAO,GAAK,EAAE,SAAW,aAAa,EAC/C,CAACA,CAAQ,CAAA,EAGLkB,EAAsBD,EAAAA,QAAQ,IAClCjB,EAAS,OAAO,GAAK,EAAE,SAAW,YAAc,EAAE,SAAW,UAAU,EACvE,CAACA,CAAQ,CAAA,EAGLmB,EAAsBF,EAAAA,QAAQ,IAClCjB,EAAS,OAAO,GAAK,EAAE,SAAW,aAAa,EAC/C,CAACA,CAAQ,CAAA,EAGLoB,EAAgBH,EAAAA,QAAQ,IAAM,CAClC,GAAIjB,EAAS,SAAW,EAAG,MAAO,GAClC,MAAMqB,EAAQrB,EAAS,OAAO,CAACsB,EAAKC,IAAYD,EAAMC,EAAQ,kBAAmB,CAAC,EAClF,OAAO,KAAK,MAAMF,EAAQrB,EAAS,MAAM,CAC3C,EAAG,CAACA,CAAQ,CAAC,EAEb,MAAO,CACL,SAAAA,EACA,QAAAG,EACA,gBAAAY,EACA,oBAAAC,EACA,oBAAAE,EACA,oBAAAC,EACA,cAAAC,CAAA,CAEJ"}