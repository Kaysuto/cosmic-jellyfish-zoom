{"version":3,"file":"useUserListDetails-BSyEjQrH.js","sources":["../../src/hooks/useUserListDetails.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useSession } from '@/contexts/AuthContext';\nimport { showError } from '@/utils/toast';\nimport { useTranslation } from 'react-i18next';\nimport { MediaItem } from '@/components/catalog/MediaGrid';\n\ntype ListType = 'favorite' | 'watchlist';\n\nexport const useUserListDetails = (userId: string, listType: ListType) => {\n  const { session } = useSession();\n  const { t, i18n } = useTranslation();\n  const [list, setList] = useState<MediaItem[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const fetchListDetails = useCallback(async () => {\n    if (!userId) return;\n    setLoading(true);\n\n    const { data: listIds, error: idsError } = await supabase\n      .from('user_media_list')\n      .select('media_id, media_type')\n      .eq('user_id', userId)\n      .eq('list_type', listType);\n\n    if (idsError) {\n      showError(t('error_fetching_list'));\n      setLoading(false);\n      return;\n    }\n\n    if (listIds.length === 0) {\n      setList([]);\n      setLoading(false);\n      return;\n    }\n\n    const { data: detailsData, error: detailsError } = await supabase.functions.invoke('get-media-list-details', {\n      body: { mediaList: listIds, language: i18n.language },\n    });\n\n    if (detailsError) {\n      showError(t('error_fetching_list'));\n    } else {\n      // Fetch availability from catalog_items to ensure up-to-date availability\n      const tmdbIds = listIds.map(i => i.media_id);\n      const { data: catalog, error: catalogError } = await supabase\n        .from('catalog_items')\n        .select('tmdb_id, media_type, jellyfin_id')\n        .in('tmdb_id', tmdbIds);\n\n      const availabilityKey = (id: number, mediaType?: string) => `${id}:${mediaType || ''}`;\n      const availability = new Map<string, boolean>();\n      if (!catalogError && catalog) {\n        for (const row of catalog) {\n          availability.set(availabilityKey(row.tmdb_id, row.media_type), !!row.jellyfin_id);\n        }\n      }\n\n      const items = detailsData.map((item: any) => {\n        const mediaType = listIds.find(i => i.media_id === item.id)?.media_type;\n        const isAvailable = availability.get(availabilityKey(item.id, mediaType)) || false;\n        return { ...item, media_type: mediaType, isAvailable } as MediaItem;\n      });\n      setList(items);\n    }\n    setLoading(false);\n  }, [userId, listType, t, i18n.language]);\n\n  useEffect(() => {\n    fetchListDetails();\n  }, [fetchListDetails]);\n\n  return { list, loading, refetch: fetchListDetails };\n};"],"names":["useUserListDetails","userId","listType","session","useSession","t","i18n","useTranslation","list","setList","useState","loading","setLoading","fetchListDetails","useCallback","__async","listIds","idsError","supabase","showError","detailsData","detailsError","tmdbIds","catalog","catalogError","availabilityKey","id","mediaType","availability","row","items","item","_a","i","isAvailable","__spreadProps","__spreadValues","useEffect"],"mappings":"guBASO,MAAMA,EAAqB,CAACC,EAAgBC,IAAuB,CACxE,KAAM,CAAE,QAAAC,CAAA,EAAYC,EAAA,EACd,CAAE,EAAAC,EAAG,KAAAC,CAAA,EAASC,EAAA,EACd,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAsB,CAAA,CAAE,EAC1C,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EAErCG,EAAmBC,EAAAA,YAAY,IAAYC,EAAA,sBAC/C,GAAI,CAACd,EAAQ,OACbW,EAAW,EAAI,EAEf,KAAM,CAAE,KAAMI,EAAS,MAAOC,GAAa,MAAMC,EAC9C,KAAK,iBAAiB,EACtB,OAAO,sBAAsB,EAC7B,GAAG,UAAWjB,CAAM,EACpB,GAAG,YAAaC,CAAQ,EAE3B,GAAIe,EAAU,CACZE,EAAUd,EAAE,qBAAqB,CAAC,EAClCO,EAAW,EAAK,EAChB,MACF,CAEA,GAAII,EAAQ,SAAW,EAAG,CACxBP,EAAQ,CAAA,CAAE,EACVG,EAAW,EAAK,EAChB,MACF,CAEA,KAAM,CAAE,KAAMQ,EAAa,MAAOC,GAAiB,MAAMH,EAAS,UAAU,OAAO,yBAA0B,CAC3G,KAAM,CAAE,UAAWF,EAAS,SAAUV,EAAK,QAAA,CAAS,CACrD,EAED,GAAIe,EACFF,EAAUd,EAAE,qBAAqB,CAAC,MAC7B,CAEL,MAAMiB,EAAUN,EAAQ,IAAI,GAAK,EAAE,QAAQ,EACrC,CAAE,KAAMO,EAAS,MAAOC,CAAA,EAAiB,MAAMN,EAClD,KAAK,eAAe,EACpB,OAAO,kCAAkC,EACzC,GAAG,UAAWI,CAAO,EAElBG,EAAkB,CAACC,EAAYC,IAAuB,GAAGD,CAAE,IAAIC,GAAa,EAAE,GAC9EC,MAAmB,IACzB,GAAI,CAACJ,GAAgBD,EACnB,UAAWM,KAAON,EAChBK,EAAa,IAAIH,EAAgBI,EAAI,QAASA,EAAI,UAAU,EAAG,CAAC,CAACA,EAAI,WAAW,EAIpF,MAAMC,EAAQV,EAAY,IAAKW,GAAc,OAC3C,MAAMJ,GAAYK,EAAAhB,EAAQ,KAAKiB,GAAKA,EAAE,WAAaF,EAAK,EAAE,IAAxC,YAAAC,EAA2C,WACvDE,EAAcN,EAAa,IAAIH,EAAgBM,EAAK,GAAIJ,CAAS,CAAC,GAAK,GAC7E,OAAOQ,EAAAC,EAAA,GAAKL,GAAL,CAAW,WAAYJ,EAAW,YAAAO,CAAA,EAC3C,CAAC,EACDzB,EAAQqB,CAAK,CACf,CACAlB,EAAW,EAAK,CAClB,GAAG,CAACX,EAAQC,EAAUG,EAAGC,EAAK,QAAQ,CAAC,EAEvC+B,OAAAA,EAAAA,UAAU,IAAM,CACdxB,EAAA,CACF,EAAG,CAACA,CAAgB,CAAC,EAEd,CAAE,KAAAL,EAAM,QAAAG,EAAS,QAASE,CAAA,CACnC"}